(function(H,Ce){typeof exports=="object"&&typeof module<"u"?Ce(exports):typeof define=="function"&&define.amd?define(["exports"],Ce):(H=typeof globalThis<"u"?globalThis:H||self,Ce(H.helios={}))})(this,function(H){"use strict";const Ce=t=>+t;function Ir(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Tt="http://www.w3.org/1999/xhtml";const cn={svg:"http://www.w3.org/2000/svg",xhtml:Tt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ze(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),cn.hasOwnProperty(e)?{space:cn[e],local:t}:t}function Br(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Tt&&e.documentElement.namespaceURI===Tt?e.createElement(t):e.createElementNS(n,t)}}function Fr(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function dn(t){var e=Ze(t);return(e.local?Fr:Br)(e)}function Sr(){}function Nt(t){return t==null?Sr:function(){return this.querySelector(t)}}function Mr(t){typeof t!="function"&&(t=Nt(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,s=r[i]=new Array(o),u,f,l=0;l<o;++l)(u=a[l])&&(f=t.call(u,u.__data__,l,a))&&("__data__"in u&&(f.__data__=u.__data__),s[l]=f);return new $(r,this._parents)}function Rr(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Tr(){return[]}function gn(t){return t==null?Tr:function(){return this.querySelectorAll(t)}}function Nr(t){return function(){return Rr(t.apply(this,arguments))}}function Or(t){typeof t=="function"?t=Nr(t):t=gn(t);for(var e=this._groups,n=e.length,r=[],i=[],a=0;a<n;++a)for(var o=e[a],s=o.length,u,f=0;f<s;++f)(u=o[f])&&(r.push(t.call(u,u.__data__,f,o)),i.push(u));return new $(r,i)}function vn(t){return function(){return this.matches(t)}}function mn(t){return function(e){return e.matches(t)}}var Pr=Array.prototype.find;function zr(t){return function(){return Pr.call(this.children,t)}}function Dr(){return this.firstElementChild}function Lr(t){return this.select(t==null?Dr:zr(typeof t=="function"?t:mn(t)))}var Ur=Array.prototype.filter;function Qr(){return Array.from(this.children)}function Gr(t){return function(){return Ur.call(this.children,t)}}function Vr(t){return this.selectAll(t==null?Qr:Gr(typeof t=="function"?t:mn(t)))}function Wr(t){typeof t!="function"&&(t=vn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,s=r[i]=[],u,f=0;f<o;++f)(u=a[f])&&t.call(u,u.__data__,f,a)&&s.push(u);return new $(r,this._parents)}function pn(t){return new Array(t.length)}function Hr(){return new $(this._enter||this._groups.map(pn),this._parents)}function Ke(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Ke.prototype={constructor:Ke,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Yr(t){return function(){return t}}function qr(t,e,n,r,i,a){for(var o=0,s,u=e.length,f=a.length;o<f;++o)(s=e[o])?(s.__data__=a[o],r[o]=s):n[o]=new Ke(t,a[o]);for(;o<u;++o)(s=e[o])&&(i[o]=s)}function Xr(t,e,n,r,i,a,o){var s,u,f=new Map,l=e.length,h=a.length,c=new Array(l),d;for(s=0;s<l;++s)(u=e[s])&&(c[s]=d=o.call(u,u.__data__,s,e)+"",f.has(d)?i[s]=u:f.set(d,u));for(s=0;s<h;++s)d=o.call(t,a[s],s,a)+"",(u=f.get(d))?(r[s]=u,u.__data__=a[s],f.delete(d)):n[s]=new Ke(t,a[s]);for(s=0;s<l;++s)(u=e[s])&&f.get(c[s])===u&&(i[s]=u)}function jr(t){return t.__data__}function $r(t,e){if(!arguments.length)return Array.from(this,jr);var n=e?Xr:qr,r=this._parents,i=this._groups;typeof t!="function"&&(t=Yr(t));for(var a=i.length,o=new Array(a),s=new Array(a),u=new Array(a),f=0;f<a;++f){var l=r[f],h=i[f],c=h.length,d=Zr(t.call(l,l&&l.__data__,f,r)),v=d.length,g=s[f]=new Array(v),m=o[f]=new Array(v),y=u[f]=new Array(c);n(l,h,g,m,y,d,e);for(var w=0,x=0,p,A;w<v;++w)if(p=g[w]){for(w>=x&&(x=w+1);!(A=m[x])&&++x<v;);p._next=A||null}}return o=new $(o,r),o._enter=s,o._exit=u,o}function Zr(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Kr(){return new $(this._exit||this._groups.map(pn),this._parents)}function Jr(t,e,n){var r=this.enter(),i=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?a.remove():n(a),r&&i?r.merge(i).order():i}function ei(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,a=r.length,o=Math.min(i,a),s=new Array(i),u=0;u<o;++u)for(var f=n[u],l=r[u],h=f.length,c=s[u]=new Array(h),d,v=0;v<h;++v)(d=f[v]||l[v])&&(c[v]=d);for(;u<i;++u)s[u]=n[u];return new $(s,this._parents)}function ti(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,a=r[i],o;--i>=0;)(o=r[i])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function ni(t){t||(t=ri);function e(h,c){return h&&c?t(h.__data__,c.__data__):!h-!c}for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o=n[a],s=o.length,u=i[a]=new Array(s),f,l=0;l<s;++l)(f=o[l])&&(u[l]=f);u.sort(e)}return new $(i,this._parents).order()}function ri(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function ii(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function ai(){return Array.from(this)}function si(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null}function oi(){let t=0;for(const e of this)++t;return t}function li(){return!this.node()}function ui(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],a=0,o=i.length,s;a<o;++a)(s=i[a])&&t.call(s,s.__data__,a,i);return this}function fi(t){return function(){this.removeAttribute(t)}}function hi(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ci(t,e){return function(){this.setAttribute(t,e)}}function di(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function gi(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function vi(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function mi(t,e){var n=Ze(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?hi:fi:typeof e=="function"?n.local?vi:gi:n.local?di:ci)(n,e))}function _n(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function pi(t){return function(){this.style.removeProperty(t)}}function _i(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Ai(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function yi(t,e,n){return arguments.length>1?this.each((e==null?pi:typeof e=="function"?Ai:_i)(t,e,n??"")):Ie(this.node(),t)}function Ie(t,e){return t.style.getPropertyValue(e)||_n(t).getComputedStyle(t,null).getPropertyValue(e)}function bi(t){return function(){delete this[t]}}function xi(t,e){return function(){this[t]=e}}function wi(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Ei(t,e){return arguments.length>1?this.each((e==null?bi:typeof e=="function"?wi:xi)(t,e)):this.node()[t]}function An(t){return t.trim().split(/^|\s+/)}function Ot(t){return t.classList||new yn(t)}function yn(t){this._node=t,this._names=An(t.getAttribute("class")||"")}yn.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function bn(t,e){for(var n=Ot(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function xn(t,e){for(var n=Ot(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function ki(t){return function(){bn(this,t)}}function Ci(t){return function(){xn(this,t)}}function Ii(t,e){return function(){(e.apply(this,arguments)?bn:xn)(this,t)}}function Bi(t,e){var n=An(t+"");if(arguments.length<2){for(var r=Ot(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?Ii:e?ki:Ci)(n,e))}function Fi(){this.textContent=""}function Si(t){return function(){this.textContent=t}}function Mi(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Ri(t){return arguments.length?this.each(t==null?Fi:(typeof t=="function"?Mi:Si)(t)):this.node().textContent}function Ti(){this.innerHTML=""}function Ni(t){return function(){this.innerHTML=t}}function Oi(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Pi(t){return arguments.length?this.each(t==null?Ti:(typeof t=="function"?Oi:Ni)(t)):this.node().innerHTML}function zi(){this.nextSibling&&this.parentNode.appendChild(this)}function Di(){return this.each(zi)}function Li(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ui(){return this.each(Li)}function Qi(t){var e=typeof t=="function"?t:dn(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Gi(){return null}function Vi(t,e){var n=typeof t=="function"?t:dn(t),r=e==null?Gi:typeof e=="function"?e:Nt(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Wi(){var t=this.parentNode;t&&t.removeChild(this)}function Hi(){return this.each(Wi)}function Yi(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function qi(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Xi(t){return this.select(t?qi:Yi)}function ji(t){return arguments.length?this.property("__data__",t):this.node().__data__}function $i(t){return function(e){t.call(this,e,this.__data__)}}function Zi(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function Ki(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,a;n<i;++n)a=e[n],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function Ji(t,e,n){return function(){var r=this.__on,i,a=$i(e);if(r){for(var o=0,s=r.length;o<s;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),i.value=e;return}}this.addEventListener(t.type,a,n),i={type:t.type,name:t.name,value:e,listener:a,options:n},r?r.push(i):this.__on=[i]}}function ea(t,e,n){var r=Zi(t+""),i,a=r.length,o;if(arguments.length<2){var s=this.node().__on;if(s){for(var u=0,f=s.length,l;u<f;++u)for(i=0,l=s[u];i<a;++i)if((o=r[i]).type===l.type&&o.name===l.name)return l.value}return}for(s=e?Ji:Ki,i=0;i<a;++i)this.each(s(r[i],e,n));return this}function wn(t,e,n){var r=_n(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function ta(t,e){return function(){return wn(this,t,e)}}function na(t,e){return function(){return wn(this,t,e.apply(this,arguments))}}function ra(t,e){return this.each((typeof e=="function"?na:ta)(t,e))}function*ia(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length,o;i<a;++i)(o=r[i])&&(yield o)}var En=[null];function $(t,e){this._groups=t,this._parents=e}function Re(){return new $([[document.documentElement]],En)}function aa(){return this}$.prototype=Re.prototype={constructor:$,select:Mr,selectAll:Or,selectChild:Lr,selectChildren:Vr,filter:Wr,data:$r,enter:Hr,exit:Kr,join:Jr,merge:ei,selection:aa,order:ti,sort:ni,call:ii,nodes:ai,node:si,size:oi,empty:li,each:ui,attr:mi,style:yi,property:Ei,classed:Bi,text:Ri,html:Pi,raise:Di,lower:Ui,append:Qi,insert:Vi,remove:Hi,clone:Xi,datum:ji,on:ea,dispatch:ra,[Symbol.iterator]:ia};function Z(t){return typeof t=="string"?new $([[document.querySelector(t)]],[document.documentElement]):new $([[t]],En)}function sa(t){let e;for(;e=t.sourceEvent;)t=e;return t}function pe(t,e){if(t=sa(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}var oa={value:()=>{}};function Pt(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Je(n)}function Je(t){this._=t}function la(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Je.prototype=Pt.prototype={constructor:Je,on:function(t,e){var n=this._,r=la(t+"",n),i,a=-1,o=r.length;if(arguments.length<2){for(;++a<o;)if((i=(t=r[a]).type)&&(i=ua(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<o;)if(i=(t=r[a]).type)n[i]=kn(n[i],t.name,e);else if(e==null)for(i in n)n[i]=kn(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Je(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,a;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],r=0,i=a.length;r<i;++r)a[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,a=r.length;i<a;++i)r[i].value.apply(e,n)}};function ua(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function kn(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=oa,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}const zt={capture:!0,passive:!1};function Dt(t){t.preventDefault(),t.stopImmediatePropagation()}function fa(t){var e=t.document.documentElement,n=Z(t).on("dragstart.drag",Dt,zt);"onselectstart"in e?n.on("selectstart.drag",Dt,zt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function ha(t,e){var n=t.document.documentElement,r=Z(t).on("dragstart.drag",null);e&&(r.on("click.drag",Dt,zt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function Lt(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Cn(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Te(){}var Ne=.7,et=1/Ne,Be="\\s*([+-]?\\d+)\\s*",Oe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ae="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ca=/^#([0-9a-f]{3,8})$/,da=new RegExp(`^rgb\\(${Be},${Be},${Be}\\)$`),ga=new RegExp(`^rgb\\(${ae},${ae},${ae}\\)$`),va=new RegExp(`^rgba\\(${Be},${Be},${Be},${Oe}\\)$`),ma=new RegExp(`^rgba\\(${ae},${ae},${ae},${Oe}\\)$`),pa=new RegExp(`^hsl\\(${Oe},${ae},${ae}\\)$`),_a=new RegExp(`^hsla\\(${Oe},${ae},${ae},${Oe}\\)$`),In={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Lt(Te,Pe,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Bn,formatHex:Bn,formatHex8:Aa,formatHsl:ya,formatRgb:Fn,toString:Fn});function Bn(){return this.rgb().formatHex()}function Aa(){return this.rgb().formatHex8()}function ya(){return Nn(this).formatHsl()}function Fn(){return this.rgb().formatRgb()}function Pe(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=ca.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Sn(e):n===3?new X(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?tt(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?tt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=da.exec(t))?new X(e[1],e[2],e[3],1):(e=ga.exec(t))?new X(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=va.exec(t))?tt(e[1],e[2],e[3],e[4]):(e=ma.exec(t))?tt(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=pa.exec(t))?Tn(e[1],e[2]/100,e[3]/100,1):(e=_a.exec(t))?Tn(e[1],e[2]/100,e[3]/100,e[4]):In.hasOwnProperty(t)?Sn(In[t]):t==="transparent"?new X(NaN,NaN,NaN,0):null}function Sn(t){return new X(t>>16&255,t>>8&255,t&255,1)}function tt(t,e,n,r){return r<=0&&(t=e=n=NaN),new X(t,e,n,r)}function ba(t){return t instanceof Te||(t=Pe(t)),t?(t=t.rgb(),new X(t.r,t.g,t.b,t.opacity)):new X}function ze(t,e,n,r){return arguments.length===1?ba(t):new X(t,e,n,r??1)}function X(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Lt(X,ze,Cn(Te,{brighter(t){return t=t==null?et:Math.pow(et,t),new X(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Ne:Math.pow(Ne,t),new X(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new X(_e(this.r),_e(this.g),_e(this.b),nt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Mn,formatHex:Mn,formatHex8:xa,formatRgb:Rn,toString:Rn}));function Mn(){return`#${Ae(this.r)}${Ae(this.g)}${Ae(this.b)}`}function xa(){return`#${Ae(this.r)}${Ae(this.g)}${Ae(this.b)}${Ae((isNaN(this.opacity)?1:this.opacity)*255)}`}function Rn(){const t=nt(this.opacity);return`${t===1?"rgb(":"rgba("}${_e(this.r)}, ${_e(this.g)}, ${_e(this.b)}${t===1?")":`, ${t})`}`}function nt(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function _e(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Ae(t){return t=_e(t),(t<16?"0":"")+t.toString(16)}function Tn(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ee(t,e,n,r)}function Nn(t){if(t instanceof ee)return new ee(t.h,t.s,t.l,t.opacity);if(t instanceof Te||(t=Pe(t)),!t)return new ee;if(t instanceof ee)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),o=NaN,s=a-i,u=(a+i)/2;return s?(e===a?o=(n-r)/s+(n<r)*6:n===a?o=(r-e)/s+2:o=(e-n)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new ee(o,s,u,t.opacity)}function wa(t,e,n,r){return arguments.length===1?Nn(t):new ee(t,e,n,r??1)}function ee(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Lt(ee,wa,Cn(Te,{brighter(t){return t=t==null?et:Math.pow(et,t),new ee(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Ne:Math.pow(Ne,t),new ee(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new X(Ut(t>=240?t-240:t+120,i,r),Ut(t,i,r),Ut(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new ee(On(this.h),rt(this.s),rt(this.l),nt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=nt(this.opacity);return`${t===1?"hsl(":"hsla("}${On(this.h)}, ${rt(this.s)*100}%, ${rt(this.l)*100}%${t===1?")":`, ${t})`}`}}));function On(t){return t=(t||0)%360,t<0?t+360:t}function rt(t){return Math.max(0,Math.min(1,t||0))}function Ut(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Pn=t=>()=>t;function Ea(t,e){return function(n){return t+n*e}}function ka(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Ca(t){return(t=+t)==1?zn:function(e,n){return n-e?ka(e,n,t):Pn(isNaN(e)?n:e)}}function zn(t,e){var n=e-t;return n?Ea(t,n):Pn(isNaN(t)?e:t)}const Dn=function t(e){var n=Ca(e);function r(i,a){var o=n((i=ze(i)).r,(a=ze(a)).r),s=n(i.g,a.g),u=n(i.b,a.b),f=zn(i.opacity,a.opacity);return function(l){return i.r=o(l),i.g=s(l),i.b=u(l),i.opacity=f(l),i+""}}return r.gamma=t,r}(1);function ge(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var Qt=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Gt=new RegExp(Qt.source,"g");function Ia(t){return function(){return t}}function Ba(t){return function(e){return t(e)+""}}function Fa(t,e){var n=Qt.lastIndex=Gt.lastIndex=0,r,i,a,o=-1,s=[],u=[];for(t=t+"",e=e+"";(r=Qt.exec(t))&&(i=Gt.exec(e));)(a=i.index)>n&&(a=e.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(r=r[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,u.push({i:o,x:ge(r,i)})),n=Gt.lastIndex;return n<e.length&&(a=e.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?u[0]?Ba(u[0].x):Ia(e):(e=u.length,function(f){for(var l=0,h;l<e;++l)s[(h=u[l]).i]=h.x(f);return s.join("")})}var Ln=180/Math.PI,Vt={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Un(t,e,n,r,i,a){var o,s,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),t*r<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(e,t)*Ln,skewX:Math.atan(u)*Ln,scaleX:o,scaleY:s}}var it;function Sa(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Vt:Un(e.a,e.b,e.c,e.d,e.e,e.f)}function Ma(t){return t==null||(it||(it=document.createElementNS("http://www.w3.org/2000/svg","g")),it.setAttribute("transform",t),!(t=it.transform.baseVal.consolidate()))?Vt:(t=t.matrix,Un(t.a,t.b,t.c,t.d,t.e,t.f))}function Qn(t,e,n,r){function i(f){return f.length?f.pop()+" ":""}function a(f,l,h,c,d,v){if(f!==h||l!==c){var g=d.push("translate(",null,e,null,n);v.push({i:g-4,x:ge(f,h)},{i:g-2,x:ge(l,c)})}else(h||c)&&d.push("translate("+h+e+c+n)}function o(f,l,h,c){f!==l?(f-l>180?l+=360:l-f>180&&(f+=360),c.push({i:h.push(i(h)+"rotate(",null,r)-2,x:ge(f,l)})):l&&h.push(i(h)+"rotate("+l+r)}function s(f,l,h,c){f!==l?c.push({i:h.push(i(h)+"skewX(",null,r)-2,x:ge(f,l)}):l&&h.push(i(h)+"skewX("+l+r)}function u(f,l,h,c,d,v){if(f!==h||l!==c){var g=d.push(i(d)+"scale(",null,",",null,")");v.push({i:g-4,x:ge(f,h)},{i:g-2,x:ge(l,c)})}else(h!==1||c!==1)&&d.push(i(d)+"scale("+h+","+c+")")}return function(f,l){var h=[],c=[];return f=t(f),l=t(l),a(f.translateX,f.translateY,l.translateX,l.translateY,h,c),o(f.rotate,l.rotate,h,c),s(f.skewX,l.skewX,h,c),u(f.scaleX,f.scaleY,l.scaleX,l.scaleY,h,c),f=l=null,function(d){for(var v=-1,g=c.length,m;++v<g;)h[(m=c[v]).i]=m.x(d);return h.join("")}}}var Ra=Qn(Sa,"px, ","px)","deg)"),Ta=Qn(Ma,", ",")",")"),Na=1e-12;function Gn(t){return((t=Math.exp(t))+1/t)/2}function Oa(t){return((t=Math.exp(t))-1/t)/2}function Pa(t){return((t=Math.exp(2*t))-1)/(t+1)}const za=function t(e,n,r){function i(a,o){var s=a[0],u=a[1],f=a[2],l=o[0],h=o[1],c=o[2],d=l-s,v=h-u,g=d*d+v*v,m,y;if(g<Na)y=Math.log(c/f)/e,m=function(C){return[s+C*d,u+C*v,f*Math.exp(e*C*y)]};else{var w=Math.sqrt(g),x=(c*c-f*f+r*g)/(2*f*n*w),p=(c*c-f*f-r*g)/(2*c*n*w),A=Math.log(Math.sqrt(x*x+1)-x),_=Math.log(Math.sqrt(p*p+1)-p);y=(_-A)/e,m=function(C){var k=C*y,S=Gn(A),N=f/(n*w)*(S*Pa(e*k+A)-Oa(A));return[s+N*d,u+N*v,f*S/Gn(e*k+A)]}}return m.duration=y*1e3*e/Math.SQRT2,m}return i.rho=function(a){var o=Math.max(.001,+a),s=o*o,u=s*s;return t(o,s,u)},i}(Math.SQRT2,2,4);var Fe=0,De=0,Le=0,Vn=1e3,at,Ue,st=0,ye=0,ot=0,Qe=typeof performance=="object"&&performance.now?performance:Date,Wn=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Wt(){return ye||(Wn(Da),ye=Qe.now()+ot)}function Da(){ye=0}function lt(){this._call=this._time=this._next=null}lt.prototype=Hn.prototype={constructor:lt,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Wt():+n)+(e==null?0:+e),!this._next&&Ue!==this&&(Ue?Ue._next=this:at=this,Ue=this),this._call=t,this._time=n,Ht()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ht())}};function Hn(t,e,n){var r=new lt;return r.restart(t,e,n),r}function La(){Wt(),++Fe;for(var t=at,e;t;)(e=ye-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Fe}function Yn(){ye=(st=Qe.now())+ot,Fe=De=0;try{La()}finally{Fe=0,Qa(),ye=0}}function Ua(){var t=Qe.now(),e=t-st;e>Vn&&(ot-=e,st=t)}function Qa(){for(var t,e=at,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:at=n);Ue=t,Ht(r)}function Ht(t){if(!Fe){De&&(De=clearTimeout(De));var e=t-ye;e>24?(t<1/0&&(De=setTimeout(Yn,t-Qe.now()-ot)),Le&&(Le=clearInterval(Le))):(Le||(st=Qe.now(),Le=setInterval(Ua,Vn)),Fe=1,Wn(Yn))}}function qn(t,e,n){var r=new lt;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var Ga=Pt("start","end","cancel","interrupt"),Va=[],Xn=0,jn=1,Yt=2,ut=3,$n=4,qt=5,ft=6;function ht(t,e,n,r,i,a){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;Wa(t,n,{name:e,index:r,group:i,on:Ga,tween:Va,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Xn})}function Xt(t,e){var n=te(t,e);if(n.state>Xn)throw new Error("too late; already scheduled");return n}function se(t,e){var n=te(t,e);if(n.state>ut)throw new Error("too late; already running");return n}function te(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Wa(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=Hn(a,0,n.time);function a(f){n.state=jn,n.timer.restart(o,n.delay,n.time),n.delay<=f&&o(f-n.delay)}function o(f){var l,h,c,d;if(n.state!==jn)return u();for(l in r)if(d=r[l],d.name===n.name){if(d.state===ut)return qn(o);d.state===$n?(d.state=ft,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[l]):+l<e&&(d.state=ft,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[l])}if(qn(function(){n.state===ut&&(n.state=$n,n.timer.restart(s,n.delay,n.time),s(f))}),n.state=Yt,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Yt){for(n.state=ut,i=new Array(c=n.tween.length),l=0,h=-1;l<c;++l)(d=n.tween[l].value.call(t,t.__data__,n.index,n.group))&&(i[++h]=d);i.length=h+1}}function s(f){for(var l=f<n.duration?n.ease.call(null,f/n.duration):(n.timer.restart(u),n.state=qt,1),h=-1,c=i.length;++h<c;)i[h].call(t,l);n.state===qt&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=ft,n.timer.stop(),delete r[e];for(var f in r)return;delete t.__transition}}function ct(t,e){var n=t.__transition,r,i,a=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){a=!1;continue}i=r.state>Yt&&r.state<qt,r.state=ft,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}a&&delete t.__transition}}function Ha(t){return this.each(function(){ct(this,t)})}function Ya(t,e){var n,r;return function(){var i=se(this,t),a=i.tween;if(a!==n){r=n=a;for(var o=0,s=r.length;o<s;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function qa(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var a=se(this,t),o=a.tween;if(o!==r){i=(r=o).slice();for(var s={name:e,value:n},u=0,f=i.length;u<f;++u)if(i[u].name===e){i[u]=s;break}u===f&&i.push(s)}a.tween=i}}function Xa(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=te(this.node(),n).tween,i=0,a=r.length,o;i<a;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?Ya:qa)(n,t,e))}function jt(t,e,n){var r=t._id;return t.each(function(){var i=se(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return te(i,r).value[e]}}function Zn(t,e){var n;return(typeof e=="number"?ge:e instanceof Pe?Dn:(n=Pe(e))?(e=n,Dn):Fa)(t,e)}function ja(t){return function(){this.removeAttribute(t)}}function $a(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Za(t,e,n){var r,i=n+"",a;return function(){var o=this.getAttribute(t);return o===i?null:o===r?a:a=e(r=o,n)}}function Ka(t,e,n){var r,i=n+"",a;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?a:a=e(r=o,n)}}function Ja(t,e,n){var r,i,a;return function(){var o,s=n(this),u;return s==null?void this.removeAttribute(t):(o=this.getAttribute(t),u=s+"",o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,s)))}}function es(t,e,n){var r,i,a;return function(){var o,s=n(this),u;return s==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),u=s+"",o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,s)))}}function ts(t,e){var n=Ze(t),r=n==="transform"?Ta:Zn;return this.attrTween(t,typeof e=="function"?(n.local?es:Ja)(n,r,jt(this,"attr."+t,e)):e==null?(n.local?$a:ja)(n):(n.local?Ka:Za)(n,r,e))}function ns(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function rs(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function is(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&rs(t,a)),n}return i._value=e,i}function as(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&ns(t,a)),n}return i._value=e,i}function ss(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Ze(t);return this.tween(n,(r.local?is:as)(r,e))}function os(t,e){return function(){Xt(this,t).delay=+e.apply(this,arguments)}}function ls(t,e){return e=+e,function(){Xt(this,t).delay=e}}function us(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?os:ls)(e,t)):te(this.node(),e).delay}function fs(t,e){return function(){se(this,t).duration=+e.apply(this,arguments)}}function hs(t,e){return e=+e,function(){se(this,t).duration=e}}function cs(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?fs:hs)(e,t)):te(this.node(),e).duration}function ds(t,e){if(typeof e!="function")throw new Error;return function(){se(this,t).ease=e}}function gs(t){var e=this._id;return arguments.length?this.each(ds(e,t)):te(this.node(),e).ease}function vs(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;se(this,t).ease=n}}function ms(t){if(typeof t!="function")throw new Error;return this.each(vs(this._id,t))}function ps(t){typeof t!="function"&&(t=vn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,s=r[i]=[],u,f=0;f<o;++f)(u=a[f])&&t.call(u,u.__data__,f,a)&&s.push(u);return new le(r,this._parents,this._name,this._id)}function _s(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,a=Math.min(r,i),o=new Array(r),s=0;s<a;++s)for(var u=e[s],f=n[s],l=u.length,h=o[s]=new Array(l),c,d=0;d<l;++d)(c=u[d]||f[d])&&(h[d]=c);for(;s<r;++s)o[s]=e[s];return new le(o,this._parents,this._name,this._id)}function As(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function ys(t,e,n){var r,i,a=As(e)?Xt:se;return function(){var o=a(this,t),s=o.on;s!==r&&(i=(r=s).copy()).on(e,n),o.on=i}}function bs(t,e){var n=this._id;return arguments.length<2?te(this.node(),n).on.on(t):this.each(ys(n,t,e))}function xs(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function ws(){return this.on("end.remove",xs(this._id))}function Es(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Nt(t));for(var r=this._groups,i=r.length,a=new Array(i),o=0;o<i;++o)for(var s=r[o],u=s.length,f=a[o]=new Array(u),l,h,c=0;c<u;++c)(l=s[c])&&(h=t.call(l,l.__data__,c,s))&&("__data__"in l&&(h.__data__=l.__data__),f[c]=h,ht(f[c],e,n,c,f,te(l,n)));return new le(a,this._parents,e,n)}function ks(t){var e=this._name,n=this._id;typeof t!="function"&&(t=gn(t));for(var r=this._groups,i=r.length,a=[],o=[],s=0;s<i;++s)for(var u=r[s],f=u.length,l,h=0;h<f;++h)if(l=u[h]){for(var c=t.call(l,l.__data__,h,u),d,v=te(l,n),g=0,m=c.length;g<m;++g)(d=c[g])&&ht(d,e,n,g,c,v);a.push(c),o.push(l)}return new le(a,o,e,n)}var Cs=Re.prototype.constructor;function Is(){return new Cs(this._groups,this._parents)}function Bs(t,e){var n,r,i;return function(){var a=Ie(this,t),o=(this.style.removeProperty(t),Ie(this,t));return a===o?null:a===n&&o===r?i:i=e(n=a,r=o)}}function Kn(t){return function(){this.style.removeProperty(t)}}function Fs(t,e,n){var r,i=n+"",a;return function(){var o=Ie(this,t);return o===i?null:o===r?a:a=e(r=o,n)}}function Ss(t,e,n){var r,i,a;return function(){var o=Ie(this,t),s=n(this),u=s+"";return s==null&&(u=s=(this.style.removeProperty(t),Ie(this,t))),o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,s))}}function Ms(t,e){var n,r,i,a="style."+e,o="end."+a,s;return function(){var u=se(this,t),f=u.on,l=u.value[a]==null?s||(s=Kn(e)):void 0;(f!==n||i!==l)&&(r=(n=f).copy()).on(o,i=l),u.on=r}}function Rs(t,e,n){var r=(t+="")=="transform"?Ra:Zn;return e==null?this.styleTween(t,Bs(t,r)).on("end.style."+t,Kn(t)):typeof e=="function"?this.styleTween(t,Ss(t,r,jt(this,"style."+t,e))).each(Ms(this._id,t)):this.styleTween(t,Fs(t,r,e),n).on("end.style."+t,null)}function Ts(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Ns(t,e,n){var r,i;function a(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&Ts(t,o,n)),r}return a._value=e,a}function Os(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Ns(t,e,n??""))}function Ps(t){return function(){this.textContent=t}}function zs(t){return function(){var e=t(this);this.textContent=e??""}}function Ds(t){return this.tween("text",typeof t=="function"?zs(jt(this,"text",t)):Ps(t==null?"":t+""))}function Ls(t){return function(e){this.textContent=t.call(this,e)}}function Us(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&Ls(i)),e}return r._value=t,r}function Qs(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Us(t))}function Gs(){for(var t=this._name,e=this._id,n=Jn(),r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],s=o.length,u,f=0;f<s;++f)if(u=o[f]){var l=te(u,e);ht(u,t,n,f,o,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new le(r,this._parents,t,n)}function Vs(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(a,o){var s={value:o},u={value:function(){--i===0&&a()}};n.each(function(){var f=se(this,r),l=f.on;l!==t&&(e=(t=l).copy(),e._.cancel.push(s),e._.interrupt.push(s),e._.end.push(u)),f.on=e}),i===0&&a()})}var Ws=0;function le(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Jn(){return++Ws}var ue=Re.prototype;le.prototype={constructor:le,select:Es,selectAll:ks,selectChild:ue.selectChild,selectChildren:ue.selectChildren,filter:ps,merge:_s,selection:Is,transition:Gs,call:ue.call,nodes:ue.nodes,node:ue.node,size:ue.size,empty:ue.empty,each:ue.each,on:bs,attr:ts,attrTween:ss,style:Rs,styleTween:Os,text:Ds,textTween:Qs,remove:ws,tween:Xa,delay:us,duration:cs,ease:gs,easeVarying:ms,end:Vs,[Symbol.iterator]:ue[Symbol.iterator]};var Hs={time:null,delay:0,duration:250,ease:Ir};function Ys(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function qs(t){var e,n;t instanceof le?(e=t._id,t=t._name):(e=Jn(),(n=Hs).time=Wt(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],s=o.length,u,f=0;f<s;++f)(u=o[f])&&ht(u,t,e,f,o,n||Ys(u,e));return new le(r,this._parents,t,e)}Re.prototype.interrupt=Ha,Re.prototype.transition=qs;const dt=t=>()=>t;function Xs(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function fe(t,e,n){this.k=t,this.x=e,this.y=n}fe.prototype={constructor:fe,scale:function(t){return t===1?this:new fe(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new fe(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var be=new fe(1,0,0);fe.prototype;function $t(t){t.stopImmediatePropagation()}function Ge(t){t.preventDefault(),t.stopImmediatePropagation()}function js(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function $s(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function er(){return this.__zoom||be}function Zs(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Ks(){return navigator.maxTouchPoints||"ontouchstart"in this}function Js(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],a=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}function eo(){var t=js,e=$s,n=Js,r=Zs,i=Ks,a=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],s=250,u=za,f=Pt("start","zoom","end"),l,h,c,d=500,v=150,g=0,m=10;function y(b){b.property("__zoom",er).on("wheel.zoom",k,{passive:!1}).on("mousedown.zoom",S).on("dblclick.zoom",N).filter(i).on("touchstart.zoom",I).on("touchmove.zoom",O).on("touchend.zoom touchcancel.zoom",z).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(b,F,E,R){var B=b.selection?b.selection():b;B.property("__zoom",er),b!==B?A(b,F,E,R):B.interrupt().each(function(){_(this,arguments).event(R).start().zoom(null,typeof F=="function"?F.apply(this,arguments):F).end()})},y.scaleBy=function(b,F,E,R){y.scaleTo(b,function(){var B=this.__zoom.k,T=typeof F=="function"?F.apply(this,arguments):F;return B*T},E,R)},y.scaleTo=function(b,F,E,R){y.transform(b,function(){var B=e.apply(this,arguments),T=this.__zoom,M=E==null?p(B):typeof E=="function"?E.apply(this,arguments):E,P=T.invert(M),D=typeof F=="function"?F.apply(this,arguments):F;return n(x(w(T,D),M,P),B,o)},E,R)},y.translateBy=function(b,F,E,R){y.transform(b,function(){return n(this.__zoom.translate(typeof F=="function"?F.apply(this,arguments):F,typeof E=="function"?E.apply(this,arguments):E),e.apply(this,arguments),o)},null,R)},y.translateTo=function(b,F,E,R,B){y.transform(b,function(){var T=e.apply(this,arguments),M=this.__zoom,P=R==null?p(T):typeof R=="function"?R.apply(this,arguments):R;return n(be.translate(P[0],P[1]).scale(M.k).translate(typeof F=="function"?-F.apply(this,arguments):-F,typeof E=="function"?-E.apply(this,arguments):-E),T,o)},R,B)};function w(b,F){return F=Math.max(a[0],Math.min(a[1],F)),F===b.k?b:new fe(F,b.x,b.y)}function x(b,F,E){var R=F[0]-E[0]*b.k,B=F[1]-E[1]*b.k;return R===b.x&&B===b.y?b:new fe(b.k,R,B)}function p(b){return[(+b[0][0]+ +b[1][0])/2,(+b[0][1]+ +b[1][1])/2]}function A(b,F,E,R){b.on("start.zoom",function(){_(this,arguments).event(R).start()}).on("interrupt.zoom end.zoom",function(){_(this,arguments).event(R).end()}).tween("zoom",function(){var B=this,T=arguments,M=_(B,T).event(R),P=e.apply(B,T),D=E==null?p(P):typeof E=="function"?E.apply(B,T):E,L=Math.max(P[1][0]-P[0][0],P[1][1]-P[0][1]),U=B.__zoom,Q=typeof F=="function"?F.apply(B,T):F,G=u(U.invert(D).concat(L/U.k),Q.invert(D).concat(L/Q.k));return function(V){if(V===1)V=Q;else{var W=G(V),j=L/W[2];V=new fe(j,D[0]-W[0]*j,D[1]-W[1]*j)}M.zoom(null,V)}})}function _(b,F,E){return!E&&b.__zooming||new C(b,F)}function C(b,F){this.that=b,this.args=F,this.active=0,this.sourceEvent=null,this.extent=e.apply(b,F),this.taps=0}C.prototype={event:function(b){return b&&(this.sourceEvent=b),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(b,F){return this.mouse&&b!=="mouse"&&(this.mouse[1]=F.invert(this.mouse[0])),this.touch0&&b!=="touch"&&(this.touch0[1]=F.invert(this.touch0[0])),this.touch1&&b!=="touch"&&(this.touch1[1]=F.invert(this.touch1[0])),this.that.__zoom=F,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(b){var F=Z(this.that).datum();f.call(b,this.that,new Xs(b,{sourceEvent:this.sourceEvent,target:y,type:b,transform:this.that.__zoom,dispatch:f}),F)}};function k(b,...F){if(!t.apply(this,arguments))return;var E=_(this,F).event(b),R=this.__zoom,B=Math.max(a[0],Math.min(a[1],R.k*Math.pow(2,r.apply(this,arguments)))),T=pe(b);if(E.wheel)(E.mouse[0][0]!==T[0]||E.mouse[0][1]!==T[1])&&(E.mouse[1]=R.invert(E.mouse[0]=T)),clearTimeout(E.wheel);else{if(R.k===B)return;E.mouse=[T,R.invert(T)],ct(this),E.start()}Ge(b),E.wheel=setTimeout(M,v),E.zoom("mouse",n(x(w(R,B),E.mouse[0],E.mouse[1]),E.extent,o));function M(){E.wheel=null,E.end()}}function S(b,...F){if(c||!t.apply(this,arguments))return;var E=b.currentTarget,R=_(this,F,!0).event(b),B=Z(b.view).on("mousemove.zoom",D,!0).on("mouseup.zoom",L,!0),T=pe(b,E),M=b.clientX,P=b.clientY;fa(b.view),$t(b),R.mouse=[T,this.__zoom.invert(T)],ct(this),R.start();function D(U){if(Ge(U),!R.moved){var Q=U.clientX-M,G=U.clientY-P;R.moved=Q*Q+G*G>g}R.event(U).zoom("mouse",n(x(R.that.__zoom,R.mouse[0]=pe(U,E),R.mouse[1]),R.extent,o))}function L(U){B.on("mousemove.zoom mouseup.zoom",null),ha(U.view,R.moved),Ge(U),R.event(U).end()}}function N(b,...F){if(t.apply(this,arguments)){var E=this.__zoom,R=pe(b.changedTouches?b.changedTouches[0]:b,this),B=E.invert(R),T=E.k*(b.shiftKey?.5:2),M=n(x(w(E,T),R,B),e.apply(this,F),o);Ge(b),s>0?Z(this).transition().duration(s).call(A,M,R,b):Z(this).call(y.transform,M,R,b)}}function I(b,...F){if(t.apply(this,arguments)){var E=b.touches,R=E.length,B=_(this,F,b.changedTouches.length===R).event(b),T,M,P,D;for($t(b),M=0;M<R;++M)P=E[M],D=pe(P,this),D=[D,this.__zoom.invert(D),P.identifier],B.touch0?!B.touch1&&B.touch0[2]!==D[2]&&(B.touch1=D,B.taps=0):(B.touch0=D,T=!0,B.taps=1+!!l);l&&(l=clearTimeout(l)),T&&(B.taps<2&&(h=D[0],l=setTimeout(function(){l=null},d)),ct(this),B.start())}}function O(b,...F){if(this.__zooming){var E=_(this,F).event(b),R=b.changedTouches,B=R.length,T,M,P,D;for(Ge(b),T=0;T<B;++T)M=R[T],P=pe(M,this),E.touch0&&E.touch0[2]===M.identifier?E.touch0[0]=P:E.touch1&&E.touch1[2]===M.identifier&&(E.touch1[0]=P);if(M=E.that.__zoom,E.touch1){var L=E.touch0[0],U=E.touch0[1],Q=E.touch1[0],G=E.touch1[1],V=(V=Q[0]-L[0])*V+(V=Q[1]-L[1])*V,W=(W=G[0]-U[0])*W+(W=G[1]-U[1])*W;M=w(M,Math.sqrt(V/W)),P=[(L[0]+Q[0])/2,(L[1]+Q[1])/2],D=[(U[0]+G[0])/2,(U[1]+G[1])/2]}else if(E.touch0)P=E.touch0[0],D=E.touch0[1];else return;E.zoom("touch",n(x(M,P,D),E.extent,o))}}function z(b,...F){if(this.__zooming){var E=_(this,F).event(b),R=b.changedTouches,B=R.length,T,M;for($t(b),c&&clearTimeout(c),c=setTimeout(function(){c=null},d),T=0;T<B;++T)M=R[T],E.touch0&&E.touch0[2]===M.identifier?delete E.touch0:E.touch1&&E.touch1[2]===M.identifier&&delete E.touch1;if(E.touch1&&!E.touch0&&(E.touch0=E.touch1,delete E.touch1),E.touch0)E.touch0[1]=this.__zoom.invert(E.touch0[0]);else if(E.end(),E.taps===2&&(M=pe(M,this),Math.hypot(h[0]-M[0],h[1]-M[1])<m)){var P=Z(this).on("dblclick.zoom");P&&P.apply(this,arguments)}}}return y.wheelDelta=function(b){return arguments.length?(r=typeof b=="function"?b:dt(+b),y):r},y.filter=function(b){return arguments.length?(t=typeof b=="function"?b:dt(!!b),y):t},y.touchable=function(b){return arguments.length?(i=typeof b=="function"?b:dt(!!b),y):i},y.extent=function(b){return arguments.length?(e=typeof b=="function"?b:dt([[+b[0][0],+b[0][1]],[+b[1][0],+b[1][1]]]),y):e},y.scaleExtent=function(b){return arguments.length?(a[0]=+b[0],a[1]=+b[1],y):[a[0],a[1]]},y.translateExtent=function(b){return arguments.length?(o[0][0]=+b[0][0],o[1][0]=+b[1][0],o[0][1]=+b[0][1],o[1][1]=+b[1][1],y):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},y.constrain=function(b){return arguments.length?(n=b,y):n},y.duration=function(b){return arguments.length?(s=+b,y):s},y.interpolate=function(b){return arguments.length?(u=b,y):u},y.on=function(){var b=f.on.apply(f,arguments);return b===f?y:b},y.clickDistance=function(b){return arguments.length?(g=(b=+b)*b,y):Math.sqrt(g)},y.tapDistance=function(b){return arguments.length?(m=+b,y):m},y}var to=1e-6,ve=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function no(){var t=new ve(9);return ve!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ro(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],f=e[7],l=e[8],h=e[9],c=e[10],d=e[11],v=e[12],g=e[13],m=e[14],y=e[15],w=n*s-r*o,x=n*u-i*o,p=n*f-a*o,A=r*u-i*s,_=r*f-a*s,C=i*f-a*u,k=l*g-h*v,S=l*m-c*v,N=l*y-d*v,I=h*m-c*g,O=h*y-d*g,z=c*y-d*m,b=w*z-x*O+p*I+A*N-_*S+C*k;return b?(b=1/b,t[0]=(s*z-u*O+f*I)*b,t[1]=(u*N-o*z-f*S)*b,t[2]=(o*O-s*N+f*k)*b,t[3]=(i*O-r*z-a*I)*b,t[4]=(n*z-i*N+a*S)*b,t[5]=(r*N-n*O-a*k)*b,t[6]=(g*C-m*_+y*A)*b,t[7]=(m*p-v*C-y*x)*b,t[8]=(v*_-g*p+y*w)*b,t):null}function Ve(){var t=new ve(16);return ve!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Zt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Kt(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],f=e[6],l=e[7],h=e[8],c=e[9],d=e[10],v=e[11],g=e[12],m=e[13],y=e[14],w=e[15],x=n[0],p=n[1],A=n[2],_=n[3];return t[0]=x*r+p*s+A*h+_*g,t[1]=x*i+p*u+A*c+_*m,t[2]=x*a+p*f+A*d+_*y,t[3]=x*o+p*l+A*v+_*w,x=n[4],p=n[5],A=n[6],_=n[7],t[4]=x*r+p*s+A*h+_*g,t[5]=x*i+p*u+A*c+_*m,t[6]=x*a+p*f+A*d+_*y,t[7]=x*o+p*l+A*v+_*w,x=n[8],p=n[9],A=n[10],_=n[11],t[8]=x*r+p*s+A*h+_*g,t[9]=x*i+p*u+A*c+_*m,t[10]=x*a+p*f+A*d+_*y,t[11]=x*o+p*l+A*v+_*w,x=n[12],p=n[13],A=n[14],_=n[15],t[12]=x*r+p*s+A*h+_*g,t[13]=x*i+p*u+A*c+_*m,t[14]=x*a+p*f+A*d+_*y,t[15]=x*o+p*l+A*v+_*w,t}function tr(t,e,n){var r=n[0],i=n[1],a=n[2],o,s,u,f,l,h,c,d,v,g,m,y;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*a+e[12],t[13]=e[1]*r+e[5]*i+e[9]*a+e[13],t[14]=e[2]*r+e[6]*i+e[10]*a+e[14],t[15]=e[3]*r+e[7]*i+e[11]*a+e[15]):(o=e[0],s=e[1],u=e[2],f=e[3],l=e[4],h=e[5],c=e[6],d=e[7],v=e[8],g=e[9],m=e[10],y=e[11],t[0]=o,t[1]=s,t[2]=u,t[3]=f,t[4]=l,t[5]=h,t[6]=c,t[7]=d,t[8]=v,t[9]=g,t[10]=m,t[11]=y,t[12]=o*r+l*i+v*a+e[12],t[13]=s*r+h*i+g*a+e[13],t[14]=u*r+c*i+m*a+e[14],t[15]=f*r+d*i+y*a+e[15]),t}function nr(t,e,n,r){var i=r[0],a=r[1],o=r[2],s=Math.hypot(i,a,o),u,f,l,h,c,d,v,g,m,y,w,x,p,A,_,C,k,S,N,I,O,z,b,F;return s<to?null:(s=1/s,i*=s,a*=s,o*=s,u=Math.sin(n),f=Math.cos(n),l=1-f,h=e[0],c=e[1],d=e[2],v=e[3],g=e[4],m=e[5],y=e[6],w=e[7],x=e[8],p=e[9],A=e[10],_=e[11],C=i*i*l+f,k=a*i*l+o*u,S=o*i*l-a*u,N=i*a*l-o*u,I=a*a*l+f,O=o*a*l+i*u,z=i*o*l+a*u,b=a*o*l-i*u,F=o*o*l+f,t[0]=h*C+g*k+x*S,t[1]=c*C+m*k+p*S,t[2]=d*C+y*k+A*S,t[3]=v*C+w*k+_*S,t[4]=h*N+g*I+x*O,t[5]=c*N+m*I+p*O,t[6]=d*N+y*I+A*O,t[7]=v*N+w*I+_*O,t[8]=h*z+g*b+x*F,t[9]=c*z+m*b+p*F,t[10]=d*z+y*b+A*F,t[11]=v*z+w*b+_*F,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function io(t,e,n,r,i){var a=1/Math.tan(e/2),o;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var ao=io;function so(t,e,n,r,i,a,o){var s=1/(e-n),u=1/(r-i),f=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*f,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(o+a)*f,t[15]=1,t}var oo=so;function gt(){var t=new ve(3);return ve!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}(function(){var t=gt();return function(e,n,r,i,a,o){var s,u;for(n||(n=3),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();function rr(){var t=new ve(4);return ve!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function lo(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,t}(function(){var t=rr();return function(e,n,r,i,a,o){var s,u;for(n||(n=4),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();function uo(t,e){let n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=null;for(let i=0;i<n.length;++i){try{r=t.getContext(n[i],e)}catch{}if(r)break}return r}function J(t,e,n){let r;return r=t.createShader(n),t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.log("ERROR with script: ",e),console.log(t.getShaderInfoLog(r)),null)}function Se(t,e,n,r,i){let a=i.createProgram();if(i.attachShader(a,t),i.attachShader(a,e),i.linkProgram(a),!i.getProgramParameter(a,i.LINK_STATUS)){alert("Shader Compilation Error."+i.getProgramInfoLog(a));return}if(this.ID=a,this.uniforms=new Object,this.attributes=new Object,n)for(let o=0;o<n.length;o++)this.uniforms[n[o]]=i.getUniformLocation(this.ID,n[o]);if(this.attributes.enable=function(o){i.enableVertexAttribArray(this[o])},this.attributes.disable=function(o){i.disableVertexAttribArray(this[o])},r)for(let o=0;o<r.length;o++)this.attributes[r[o]]=i.getAttribLocation(this.ID,r[o]);this.use=function(o){o.useProgram(this.ID)}}function ir(t,e=!0,n=!0){let r=[-1,1,0,-1,-1,0,1,1,0,1,-1,0],i=[0,0,1,0,0,1,0,0,1,0,0,1],a=[0,1,0,1,0,0,1,1,0,0,0,0],o={};return n&&(o.texCoordObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o.texCoordObject),t.bufferData(t.ARRAY_BUFFER,new Float32Array(a),t.STATIC_DRAW)),e&&(o.normalObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o.normalObject),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW)),o.vertexObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o.vertexObject),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),o.numIndices=4,o}function ar(t){return t*Math.PI/180}function Jt(t,e,n,r){if(r<=n)return n;const i=Math.floor(n+(r-n)/2),a=e-t[i].value,o=e-t[i+1].value;return a<0?Jt(t,e,n,i-1):o<0?i:Jt(t,e,i+1,r)}const fo=(t,e,n)=>{const r=(t-e)/(n-e);return[1-r,r]};function ho(t){return t.value!==void 0&&t.mapped!==void 0}function co(t){return t.length>0&&ho(t[0])}function sr(t,e,n,r){return[t*e[0]+n*r[0],t*e[1]+n*r[1],t*e[2]+n*r[2]]}function or(t){return t||fo}function go(t,e,n){return!Array.isArray(t)||t.length<1?po:co(t)?vo(t,e,or(n),sr):mo(t,e,or(n),sr)}function vo(t,e,n,r){const i=t.sort((a,o)=>a.value<o.value?-1:1);return function(a){const o=e(a),s=Jt(i,o,0,i.length-1);if(s==0&&o<i[0].value)return i[s].mapped;if(s==i.length-1)return i[s].mapped;const[u,f]=n(o,i[s].value,i[s+1].value);return r(u,i[s].mapped,f,i[s+1].mapped)}}function mo(t,e,n,r){return function(i){const a=e(i),o=(t.length-1)*a;if(o<=0)return t[0];if(o>=t.length-1)return t[t.length-1];const s=Math.floor(o),[u,f]=n(o,s,s+1);return r(u,t[s],f,t[s+1])}}function po(t){return[0,0,0]}function _o(t,e){let[n,r]=t;const[i,a]=e;return Math.abs(n-r)<Number.EPSILON&&(r=n+1),function(o){return i+(a-i)*((o-n)/(r-n))}}const Ao=[[.001462,466e-6,.013866],[.002267,.00127,.01857],[.003299,.002249,.024239],[.004547,.003392,.030909],[.006006,.004692,.038558],[.007676,.006136,.046836],[.009561,.007713,.055143],[.011663,.009417,.06346],[.013995,.011225,.071862],[.016561,.013136,.080282],[.019373,.015133,.088767],[.022447,.017199,.097327],[.025793,.019331,.10593],[.029432,.021503,.114621],[.033385,.023702,.123397],[.037668,.025921,.132232],[.042253,.028139,.141141],[.046915,.030324,.150164],[.051644,.032474,.159254],[.056449,.034569,.168414],[.06134,.03659,.177642],[.066331,.038504,.186962],[.071429,.040294,.196354],[.076637,.041905,.205799],[.081962,.043328,.215289],[.087411,.044556,.224813],[.09299,.045583,.234358],[.098702,.046402,.243904],[.104551,.047008,.25343],[.110536,.047399,.262912],[.116656,.047574,.272321],[.122908,.047536,.281624],[.129285,.047293,.290788],[.135778,.046856,.299776],[.142378,.046242,.308553],[.149073,.045468,.317085],[.15585,.044559,.325338],[.162689,.043554,.333277],[.169575,.042489,.340874],[.176493,.041402,.348111],[.183429,.040329,.354971],[.190367,.039309,.361447],[.197297,.0384,.367535],[.204209,.037632,.373238],[.211095,.03703,.378563],[.217949,.036615,.383522],[.224763,.036405,.388129],[.231538,.036405,.3924],[.238273,.036621,.396353],[.244967,.037055,.400007],[.25162,.037705,.403378],[.258234,.038571,.406485],[.26481,.039647,.409345],[.271347,.040922,.411976],[.27785,.042353,.414392],[.284321,.043933,.416608],[.290763,.045644,.418637],[.297178,.04747,.420491],[.303568,.049396,.422182],[.309935,.051407,.423721],[.316282,.05349,.425116],[.32261,.055634,.426377],[.328921,.057827,.427511],[.335217,.06006,.428524],[.3415,.062325,.429425],[.347771,.064616,.430217],[.354032,.066925,.430906],[.360284,.069247,.431497],[.366529,.071579,.431994],[.372768,.073915,.4324],[.379001,.076253,.432719],[.385228,.078591,.432955],[.391453,.080927,.433109],[.397674,.083257,.433183],[.403894,.08558,.433179],[.410113,.087896,.433098],[.416331,.090203,.432943],[.422549,.092501,.432714],[.428768,.09479,.432412],[.434987,.097069,.432039],[.441207,.099338,.431594],[.447428,.101597,.43108],[.453651,.103848,.430498],[.459875,.106089,.429846],[.4661,.108322,.429125],[.472328,.110547,.428334],[.478558,.112764,.427475],[.484789,.114974,.426548],[.491022,.117179,.425552],[.497257,.119379,.424488],[.503493,.121575,.423356],[.50973,.123769,.422156],[.515967,.12596,.420887],[.522206,.12815,.419549],[.528444,.130341,.418142],[.534683,.132534,.416667],[.54092,.134729,.415123],[.547157,.136929,.413511],[.553392,.139134,.411829],[.559624,.141346,.410078],[.565854,.143567,.408258],[.572081,.145797,.406369],[.578304,.148039,.404411],[.584521,.150294,.402385],[.590734,.152563,.40029],[.59694,.154848,.398125],[.603139,.157151,.395891],[.60933,.159474,.393589],[.615513,.161817,.391219],[.621685,.164184,.388781],[.627847,.166575,.386276],[.633998,.168992,.383704],[.640135,.171438,.381065],[.64626,.173914,.378359],[.652369,.176421,.375586],[.658463,.178962,.372748],[.66454,.181539,.369846],[.670599,.184153,.366879],[.676638,.186807,.363849],[.682656,.189501,.360757],[.688653,.192239,.357603],[.694627,.195021,.354388],[.700576,.197851,.351113],[.7065,.200728,.347777],[.712396,.203656,.344383],[.718264,.206636,.340931],[.724103,.20967,.337424],[.729909,.212759,.333861],[.735683,.215906,.330245],[.741423,.219112,.326576],[.747127,.222378,.322856],[.752794,.225706,.319085],[.758422,.229097,.315266],[.76401,.232554,.311399],[.769556,.236077,.307485],[.775059,.239667,.303526],[.780517,.243327,.299523],[.785929,.247056,.295477],[.791293,.250856,.29139],[.796607,.254728,.287264],[.801871,.258674,.283099],[.807082,.262692,.278898],[.812239,.266786,.274661],[.817341,.270954,.27039],[.822386,.275197,.266085],[.827372,.279517,.26175],[.832299,.283913,.257383],[.837165,.288385,.252988],[.841969,.292933,.248564],[.846709,.297559,.244113],[.851384,.30226,.239636],[.855992,.307038,.235133],[.860533,.311892,.230606],[.865006,.316822,.226055],[.869409,.321827,.221482],[.873741,.326906,.216886],[.878001,.33206,.212268],[.882188,.337287,.207628],[.886302,.342586,.202968],[.890341,.347957,.198286],[.894305,.353399,.193584],[.898192,.358911,.18886],[.902003,.364492,.184116],[.905735,.37014,.17935],[.90939,.375856,.174563],[.912966,.381636,.169755],[.916462,.387481,.164924],[.919879,.393389,.16007],[.923215,.399359,.155193],[.92647,.405389,.150292],[.929644,.411479,.145367],[.932737,.417627,.140417],[.935747,.423831,.13544],[.938675,.430091,.130438],[.941521,.436405,.125409],[.944285,.442772,.120354],[.946965,.449191,.115272],[.949562,.45566,.110164],[.952075,.462178,.105031],[.954506,.468744,.099874],[.956852,.475356,.094695],[.959114,.482014,.089499],[.961293,.488716,.084289],[.963387,.495462,.079073],[.965397,.502249,.073859],[.967322,.509078,.068659],[.969163,.515946,.063488],[.970919,.522853,.058367],[.97259,.529798,.053324],[.974176,.53678,.048392],[.975677,.543798,.043618],[.977092,.55085,.03905],[.978422,.557937,.034931],[.979666,.565057,.031409],[.980824,.572209,.028508],[.981895,.579392,.02625],[.982881,.586606,.024661],[.983779,.593849,.02377],[.984591,.601122,.023606],[.985315,.608422,.024202],[.985952,.61575,.025592],[.986502,.623105,.027814],[.986964,.630485,.030908],[.987337,.63789,.034916],[.987622,.64532,.039886],[.987819,.652773,.045581],[.987926,.66025,.05175],[.987945,.667748,.058329],[.987874,.675267,.065257],[.987714,.682807,.072489],[.987464,.690366,.07999],[.987124,.697944,.087731],[.986694,.70554,.095694],[.986175,.713153,.103863],[.985566,.720782,.112229],[.984865,.728427,.120785],[.984075,.736087,.129527],[.983196,.743758,.138453],[.982228,.751442,.147565],[.981173,.759135,.156863],[.980032,.766837,.166353],[.978806,.774545,.176037],[.977497,.782258,.185923],[.976108,.789974,.196018],[.974638,.797692,.206332],[.973088,.805409,.216877],[.971468,.813122,.227658],[.969783,.820825,.238686],[.968041,.828515,.249972],[.966243,.836191,.261534],[.964394,.843848,.273391],[.962517,.851476,.285546],[.960626,.859069,.29801],[.95872,.866624,.31082],[.956834,.874129,.323974],[.954997,.881569,.337475],[.953215,.888942,.351369],[.951546,.896226,.365627],[.950018,.903409,.380271],[.948683,.910473,.395289],[.947594,.917399,.410665],[.946809,.924168,.426373],[.946392,.930761,.442367],[.946403,.937159,.458592],[.946903,.943348,.47497],[.947937,.949318,.491426],[.949545,.955063,.50786],[.95174,.960587,.524203],[.954529,.965896,.540361],[.957896,.971003,.556275],[.961812,.975924,.571925],[.966249,.980678,.587206],[.971162,.985282,.602154],[.976511,.989753,.61676],[.982257,.994109,.631017],[.988362,.998364,.644924]];let yo=class{constructor(e,n,r,i){for(const[a,o]of Object.entries(e))a=="Color"||a=="Size"||a=="Position"||a=="OutlineColor"||a=="OutlineWidth"||(this[a]=o);this._network=i,this.ID=n,this.index=r}set color(e){let n=this.index;this._network.colors[n*4+0]=e[0],this._network.colors[n*4+1]=e[1],this._network.colors[n*4+2]=e[2],e.length>3&&(this._network.colors[n*4+3]=e[3])}get color(){let e=this.index;return[this._network.colors[e*4+0],this._network.colors[e*4+1],this._network.colors[e*4+2],this._network.colors[e*4+3]]}set opacity(e){let n=this.index;this._network.colors[n*4+3]=e}get opacity(){let e=this.index;return this._network.colors[e*4+3]}set size(e){this._network.sizes[this.index]=e}get size(){return this._network.sizes[this.index]}set outlineColor(e){let n=this.index;this._network.outlineColors[n*4+0]=e[0],this._network.outlineColors[n*4+1]=e[1],this._network.outlineColors[n*4+2]=e[2],e.length>3&&(this._network.outlineColors[n*4+3]=e[3])}get outlineColor(){let e=this.index;return[this._network.outlineColors[e*4+0],this._network.outlineColors[e*4+1],this._network.outlineColors[e*4+2],this._network.outlineColors[e*4+3]]}set outlineWidth(e){this._network.outlineWidths[this.index]=e}get outlineWidth(){return this._network.outlineWidths[this.index]}get network(){return this._network}set position(e){let n=this.index;this._network.positions[n*3+0]=e[0],this._network.positions[n*3+1]=e[1],this._network.positions[n*3+2]=e[2]}get position(){let e=this.index;return[this._network.positions[e*3+0],this._network.positions[e*3+1],this._network.positions[e*3+2]]}};class bo{constructor(e,n,r=!1){this.ID2index=new Object,this.indexedNodes=[],this.index2Node=this.indexedNodes,this.directed=r;for(const[o,s]of Object.entries(e))if(!this.ID2index.hasOwnProperty(o)){let u=this.indexedNodes.length;this.ID2index[o]=u,s.index=u,s.ID=o,this.indexedNodes.push(s),s.neighbors=[],s.edges=[]}this.indexedEdges=new Int32Array(n.length*2);for(let o=0;o<n.length;o++){const s=n[o];let u=this.ID2index[s.source],f=this.ID2index[s.target];this.indexedEdges[o*2]=u,this.indexedEdges[o*2+1]=f}this.positions=new Float32Array(3*this.indexedNodes.length),this.colors=new Float32Array(4*this.indexedNodes.length),this.sizes=new Float32Array(this.indexedNodes.length),this.outlineColors=new Float32Array(4*this.indexedNodes.length);for(let o=0;o<this.indexedNodes.length;o++)this.colors[o*4+3]=1,this.outlineColors[o*4+3]=1;this.outlineWidths=new Float32Array(this.indexedNodes.length),this.edgePositions=null,this.edgeColors=null,this.edgeSizes=null,this.nodes={};let i=_o([0,this.indexedNodes.length],[0,1]),a=go(Ao,i);for(let o=0;o<this.indexedNodes.length;o++){let s=this.indexedNodes[o];if(s.hasOwnProperty("Position")?(this.positions[o*3]=s.Position[0],this.positions[o*3+1]=s.Position[1],this.positions[o*3+2]=s.Position[2]):s.hasOwnProperty("posx")&&s.hasOwnProperty("posy")?(this.positions[o*3]=s.posx,this.positions[o*3+1]=s.posy,s.hasOwnProperty("posz")?this.positions[o*3+2]=s.posz:this.positions[o*3+2]=0):(this.positions[o*3+0]=(Math.random()-.5)*2*200,this.positions[o*3+1]=(Math.random()-.5)*2*200,this.positions[o*3+2]=(Math.random()-.5)*2*200),s.hasOwnProperty("Color"))o==0&&console.log("NODE COLOR:",s.Color),this.colors[o*4+0]=s.Color[0],this.colors[o*4+1]=s.Color[1],this.colors[o*4+2]=s.Color[2],s.Color.length>3?this.colors[o*4+3]=s.Color[3]:this.colors[o*4+3]=1;else{let f=a(o);this.colors[o*4+0]=f[0],this.colors[o*4+1]=f[1],this.colors[o*4+2]=f[2],f.length>3?this.colors[o*4+3]=f[3]:this.colors[o*4+3]=1}s.hasOwnProperty("Size")?this.sizes[o]=s.Size:this.sizes[o]=1,s.hasOwnProperty("OutlineColor")?(this.outlineColors[o*4+0]=s.OutlineColor[0],this.outlineColors[o*4+1]=s.OutlineColor[1],this.outlineColors[o*4+2]=s.OutlineColor[2],s.OutlineColor.length>3?this.outlineColors[o*4+3]=s.OutlineColor[3]:this.outlineColors[o*4+3]=1):(this.outlineColors[o*4+0]=1,this.outlineColors[o*4+1]=1,this.outlineColors[o*4+2]=1,this.outlineColors[o*4+3]=1),s.hasOwnProperty("OutlineWidth")?this.outlineWidths[o]=s.OutlineWidth:this.outlineWidths[o]=0;let u=new yo(s,s.ID,o,this);this.indexedNodes[o]=u,this.nodes[s.ID]=u}for(let o=0;o<n.length;o++){const s=n[o];let u=this.ID2index[s.source],f=this.ID2index[s.target],l=this.indexedNodes[u],h=this.indexedNodes[f];l.neighbors.push(h),l.edges.push(o),this.directed||(h.neighbors.push(l),h.edges.push(o))}}get nodeCount(){return this.indexedNodes.length}updateEdgePositions(){this.edgePositions==null&&(this.edgePositions=new Float32Array(3*this.indexedEdges.length));const e=this.indexedEdges.length,n=this.positions,r=this.edgePositions,i=this.indexedEdges;for(let a=0;a<e/2;a++){const o=i[a*2]*3,s=i[a*2+1]*3,u=a*6,f=u+3;r[u]=n[o],r[u+1]=n[o+1],r[u+2]=n[o+2],r[f]=n[s],r[f+1]=n[s+1],r[f+2]=n[s+2]}}updateEdgeColors(e=!0){this.edgeColors==null&&(this.edgeColors=new Float32Array(4*this.indexedEdges.length));const n=this.indexedEdges.length,r=this.edgeColors,i=this.colors,a=this.indexedEdges;for(let o=0;o<n/2;o++){const s=a[o*2]*4,u=a[o*2+1]*4,f=o*8,l=f+4;r[f]=i[s],r[f+1]=i[s+1],r[f+2]=i[s+2],r[l]=i[u],r[l+1]=i[u+1],r[l+2]=i[u+2],e&&(r[f+3]=i[s+3],r[l+3]=i[u+3])}}updateEdgeSizes(){this.edgeSizes==null&&(this.edgeSizes=new Float32Array(this.indexedEdges.length));const e=this.indexedEdges.length,n=this.edgeSizes,r=this.sizes,i=this.indexedEdges;for(let a=0;a<e/2;a++){const o=i[a*2],s=i[a*2+1];n[a*2]=r[o],n[a*2+1]=r[s]}}updateEdgeOpacity(){this.edgeColors==null&&(this.edgeColors=new Float32Array(4*this.indexedEdges.length));const e=this.indexedEdges.length,n=this.edgeColors,r=this.colors,i=this.indexedEdges;for(let a=0;a<e/2;a++){const o=i[a*2]*4,s=i[a*2+1]*4;n[a*8+3]=r[o+3],n[a*8+7]=r[s+3]}}}class xo{constructor(e,{FPS:n=60,throttle:r=!0,maxQueueLength:i=10}){this.helios=e,this.needsRender=!1,this.needsUpdateNodesGeometry=!1,this.needsUpdateEdgesGeometry=!1,this._FPS=n,this._throttle=r,this._maxQueueLength=i,this._started=!1,this._paused=!0,this._lastFPS=0,this._averageFPS=0,this._tasks={},this._executionCount=0,this._lastTimestamp=null,this._currentTimestamp=null,this._lastExecutionTimestamp=null,this._lastRequestFrameID=0,this._timeout=null,this._times=[],this._lastRepeatInterval=0,this._shouldCleanup=!1}FPS(e){return e===void 0?this.FPS:(this.FPS=e,this)}schedule({name:e="default",callback:n=null,delay:r=0,repeat:i=!1,maxRepeatCount:a=1/0,maxRepeatTime:o=1/0,repeatInterval:s=0,synchronized:u=!0,immediateUpdates:f=!1,updateNodesGeometry:l=!1,updateEdgesGeometry:h=!1,afterRedraw:c=!1,redraw:d=!0,replace:v=!0}){let g={name:e,callback:n,delay:r,repeat:i,maxRepeatCount:a,maxRepeatTime:o,repeatInterval:s,synchronized:u,immediateUpdates:f,updateNodesGeometry:l,updateEdgesGeometry:h,afterRedraw:c,redraw:d,replace:v,executionCount:0,lastTimestamp:window.performance.now(),lastExecutionTime:0,shouldBeRemoved:!1,cancel:function(){this.shouldBeRemoved=!0,this.synchronized||clearTimeout(this._timeout)}};return e in this._tasks||(this._tasks[e]=[]),v&&this._clearTask(e),u||this.runAsyncTask(g,g.delay),this._addTaskToQueue(g,e),this._paused&&this._started&&this._updateTimeout(),this}runAsyncTask(e,n=0){this._executionCount+=1,e.timeout=setTimeout(()=>{if(e.shouldBeRemoved)return;let r=window.performance.now(),i=r-e.lastTimestamp;if(e.callback?.(i,e),e.executionCount+=1,e.immediateUpdates?this._updateHelios(e.needsRender,e.needsUpdateNodesGeometry,e.needsUpdateEdgesGeometry):(e.redraw&&(this.needsRender=!0),e.updateNodesGeometry&&(this.needsUpdateNodesGeometry=!0),e.updateEdgesGeometry&&(this.needsUpdateEdgesGeometry=!0)),e.repeat){let a=window.performance.now();e.lastExecutionTime=a-r,e.lastTimestamp=r;let o=e.repeatInterval-(a-r);o<0&&(o=0),e.executionCount>=e.maxRepeatCount?e.shouldBeRemoved=!0:this.runAsyncTask(e,o)}else e.shouldBeRemoved=!0;this._started&&this._paused&&this._updateTimeout()},n)}_executeTask(e,n,r){if(e.callback?.(n,e),e===void 0)return!1;if(e.executionCount+=1,e.repeat&&e.executionCount<e.maxRepeatCount){let i=window.performance.now();e.lastExecutionTime=i-r,e.lastTimestamp=r}else e.shouldBeRemoved=!0;return!0}runSyncTasks(){if(this._shouldCleanup)return;this._executionCount+=1;let e=[],n=window.performance.now();for(let r of Object.keys(this._tasks).sort()){let i=this._tasks[r];for(let a=0;a<i.length;a++){if((i[a].synchronized||!i[a].immediateUpdates)&&(i[a].redraw&&(this.needsRender=!0),i[a].updateNodesGeometry&&(this.needsUpdateNodesGeometry=!0),i[a].updateEdgesGeometry&&(this.needsUpdateEdgesGeometry=!0)),!i[a]?.shouldBeRemoved){let o=window.performance.now(),s=o-i[a].lastTimestamp+i[a].lastExecutionTime;s<0&&(s=0);let u=!1;if(i[a].executionCount==0?s>=i[a].delay&&(u=!0):s>=i[a].repeatInterval&&(u=!0),u){if(i[a].afterRedraw)e.push({task:i[a],elapsedTime:s,currentTimestamp:o});else if(!this._executeTask(i[a],s,o))break}}i[a]?.shouldBeRemoved&&(i.splice(a,1),a--)}i.length==0&&delete this._tasks[r]}this._updateHelios(this.needsRender,this.needsUpdateNodesGeometry,this.needsUpdateEdgesGeometry,!0,e),this._lastTimestamp=n}_updateHelios(e,n,r,i,a){e===void 0&&(e=this.needsRender),n===void 0&&(n=this.needsUpdateNodesGeometry),r===void 0&&(r=this.needsUpdateEdgesGeometry),n&&(this.helios.updateNodesGeometry(),this.needsUpdateNodesGeometry=!1),r&&(this.helios.updateEdgesGeometry(),this.needsUpdateEdgesGeometry=!1),cancelAnimationFrame(this.lastRequestFrameID),this.lastRequestFrameID=requestAnimationFrame(()=>{if(this._shouldCleanup)return;const o=window.performance.now();for(;this._times.length>0&&this._times[0]<=o-1e3;)this._times.shift();this._times.push(o),this._averageFPS=this._times.length,e&&(this.helios.redraw(),this.needsRender=!1),(a?.length||0)>0&&a.forEach(s=>{s.task._timeout=setTimeout(()=>{this._executeTask(s.task,s.elapsedTime,s.currentTimestamp)},0)}),i&&(this._lastExecutionTimestamp=window.performance.now(),this._updateTimeout())})}_addTaskToQueue(e,n){let r=this._tasks[n];r.push(e),r.length>this._maxQueueLength&&(r[0].timeout&&(r[0].shouldBeRemoved=!0,clearTimeout(e.taskQueue[0])),r.shift(),console.warn(`One task was discarded because of too many tasks in the ${n} queue. (maxQueueLength = ${this._maxQueueLength})`))}_clearTask(e){if(e in this._tasks){let n=this._tasks[e];for(let r=0;r<n.length;r++){let i=n[r];i.timeout&&(i.shouldBeRemoved=!0,clearTimeout(i.timeout))}n.length=0}}unschedule(e){return e in this._tasks&&(this._clearTask(e),delete this._tasks[e]),this._updateTimeout(),this}hasTask(e){return e in this._tasks}start(){return this._started=!0,this._updateTimeout(),this}stop(){return this._shouldCleanup=!0,clearTimeout(this._timeout),this.paused=!1,this.started=!1,this._lastTimestamp=null,this._lastExecutionTime=0,this}_updateTimeout(){if(clearTimeout(this._timeout),this._started)if(Object.keys(this._tasks).length===0)this.paused=!0;else{this.paused=!1;let e=0,n=window.performance.now();this._lastTimestamp!=null&&this._throttle&&(e=1e3/this._FPS-(n-this._lastTimestamp),e<0&&(e=0)),this._lastFPS=1e3/(n-this._lastTimestamp),this._timeout=setTimeout(()=>{this.runSyncTasks()},e)}}}function wo(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function vt(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var lr={exports:{}};/*!

  pica
  https://github.com/nodeca/pica

  */(function(t,e){(function(n){t.exports=n()})(function(){return function(){function n(r,i,a){function o(f,l){if(!i[f]){if(!r[f]){var h=typeof vt=="function"&&vt;if(!l&&h)return h(f,!0);if(s)return s(f,!0);var c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c}var d=i[f]={exports:{}};r[f][0].call(d.exports,function(v){var g=r[f][1][v];return o(g||v)},d,d.exports,n,r,i,a)}return i[f].exports}for(var s=typeof vt=="function"&&vt,u=0;u<a.length;u++)o(a[u]);return o}return n}()({1:[function(n,r,i){var a=n("multimath"),o=n("./mm_unsharp_mask"),s=n("./mm_resize");function u(f){var l=f||[],h={js:l.indexOf("js")>=0,wasm:l.indexOf("wasm")>=0};a.call(this,h),this.features={js:h.js,wasm:h.wasm&&this.has_wasm()},this.use(o),this.use(s)}u.prototype=Object.create(a.prototype),u.prototype.constructor=u,u.prototype.resizeAndUnsharp=function(l,h){var c=this.resize(l,h);return l.unsharpAmount&&this.unsharp_mask(c,l.toWidth,l.toHeight,l.unsharpAmount,l.unsharpRadius,l.unsharpThreshold),c},r.exports=u},{"./mm_resize":4,"./mm_unsharp_mask":9,multimath:19}],2:[function(n,r,i){function a(h){return h<0?0:h>255?255:h}function o(h){return h>=0?h:0}function s(h,c,d,v,g,m){var y,w,x,p,A,_,C,k,S,N,I,O=0,z=0;for(S=0;S<v;S++){for(A=0,N=0;N<g;N++){for(_=m[A++],C=m[A++],k=O+_*4|0,y=w=x=p=0;C>0;C--)I=m[A++],p=p+I*h[k+3]|0,x=x+I*h[k+2]|0,w=w+I*h[k+1]|0,y=y+I*h[k]|0,k=k+4|0;c[z+3]=o(p>>7),c[z+2]=o(x>>7),c[z+1]=o(w>>7),c[z]=o(y>>7),z=z+v*4|0}z=(S+1)*4|0,O=(S+1)*d*4|0}}function u(h,c,d,v,g,m){var y,w,x,p,A,_,C,k,S,N,I,O=0,z=0;for(S=0;S<v;S++){for(A=0,N=0;N<g;N++){for(_=m[A++],C=m[A++],k=O+_*4|0,y=w=x=p=0;C>0;C--)I=m[A++],p=p+I*h[k+3]|0,x=x+I*h[k+2]|0,w=w+I*h[k+1]|0,y=y+I*h[k]|0,k=k+4|0;y>>=7,w>>=7,x>>=7,p>>=7,c[z+3]=a(p+8192>>14),c[z+2]=a(x+8192>>14),c[z+1]=a(w+8192>>14),c[z]=a(y+8192>>14),z=z+v*4|0}z=(S+1)*4|0,O=(S+1)*d*4|0}}function f(h,c,d,v,g,m){var y,w,x,p,A,_,C,k,S,N,I,O,z=0,b=0;for(N=0;N<v;N++){for(_=0,I=0;I<g;I++){for(C=m[_++],k=m[_++],S=z+C*4|0,y=w=x=p=0;k>0;k--)O=m[_++],A=h[S+3],p=p+O*A|0,x=x+O*h[S+2]*A|0,w=w+O*h[S+1]*A|0,y=y+O*h[S]*A|0,S=S+4|0;x=x/255|0,w=w/255|0,y=y/255|0,c[b+3]=o(p>>7),c[b+2]=o(x>>7),c[b+1]=o(w>>7),c[b]=o(y>>7),b=b+v*4|0}b=(N+1)*4|0,z=(N+1)*d*4|0}}function l(h,c,d,v,g,m){var y,w,x,p,A,_,C,k,S,N,I,O=0,z=0;for(S=0;S<v;S++){for(A=0,N=0;N<g;N++){for(_=m[A++],C=m[A++],k=O+_*4|0,y=w=x=p=0;C>0;C--)I=m[A++],p=p+I*h[k+3]|0,x=x+I*h[k+2]|0,w=w+I*h[k+1]|0,y=y+I*h[k]|0,k=k+4|0;y>>=7,w>>=7,x>>=7,p>>=7,p=a(p+8192>>14),p>0&&(y=y*255/p|0,w=w*255/p|0,x=x*255/p|0),c[z+3]=p,c[z+2]=a(x+8192>>14),c[z+1]=a(w+8192>>14),c[z]=a(y+8192>>14),z=z+v*4|0}z=(S+1)*4|0,O=(S+1)*d*4|0}}r.exports={convolveHor:s,convolveVert:u,convolveHorWithPre:f,convolveVertWithPre:l}},{}],3:[function(n,r,i){r.exports="AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEYA2AGf39/f39/AGAAAGAIf39/f39/f38AAg8BA2VudgZtZW1vcnkCAAADBwYBAAAAAAIGBgF/AEEACweUAQgRX193YXNtX2NhbGxfY3RvcnMAAAtjb252b2x2ZUhvcgABDGNvbnZvbHZlVmVydAACEmNvbnZvbHZlSG9yV2l0aFByZQADE2NvbnZvbHZlVmVydFdpdGhQcmUABApjb252b2x2ZUhWAAUMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAKyA4GAwABC4wDARB/AkAgA0UNACAERQ0AIANBAnQhFQNAQQAhE0EAIQsDQCALQQJqIQcCfyALQQF0IAVqIgYuAQIiC0UEQEEAIQhBACEGQQAhCUEAIQogBwwBCyASIAYuAQBqIQhBACEJQQAhCiALIRRBACEOIAchBkEAIQ8DQCAFIAZBAXRqLgEAIhAgACAIQQJ0aigCACIRQRh2bCAPaiEPIBFB/wFxIBBsIAlqIQkgEUEQdkH/AXEgEGwgDmohDiARQQh2Qf8BcSAQbCAKaiEKIAhBAWohCCAGQQFqIQYgFEEBayIUDQALIAlBB3UhCCAKQQd1IQYgDkEHdSEJIA9BB3UhCiAHIAtqCyELIAEgDEEBdCIHaiAIQQAgCEEAShs7AQAgASAHQQJyaiAGQQAgBkEAShs7AQAgASAHQQRyaiAJQQAgCUEAShs7AQAgASAHQQZyaiAKQQAgCkEAShs7AQAgDCAVaiEMIBNBAWoiEyAERw0ACyANQQFqIg0gAmwhEiANQQJ0IQwgAyANRw0ACwsL2gMBD38CQCADRQ0AIARFDQAgAkECdCEUA0AgCyEMQQAhE0EAIQIDQCACQQJqIQYCfyACQQF0IAVqIgcuAQIiAkUEQEEAIQhBACEHQQAhCkEAIQkgBgwBCyAHLgEAQQJ0IBJqIQhBACEJIAIhCkEAIQ0gBiEHQQAhDkEAIQ8DQCAFIAdBAXRqLgEAIhAgACAIQQF0IhFqLwEAbCAJaiEJIAAgEUEGcmovAQAgEGwgDmohDiAAIBFBBHJqLwEAIBBsIA9qIQ8gACARQQJyai8BACAQbCANaiENIAhBBGohCCAHQQFqIQcgCkEBayIKDQALIAlBB3UhCCANQQd1IQcgDkEHdSEKIA9BB3UhCSACIAZqCyECIAEgDEECdGogB0GAQGtBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobQQh0QYD+A3EgCUGAQGtBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobQRB0QYCA/AdxIApBgEBrQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBgEBrQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG3I2AgAgAyAMaiEMIBNBAWoiEyAERw0ACyAUIAtBAWoiC2whEiADIAtHDQALCwuSAwEQfwJAIANFDQAgBEUNACADQQJ0IRUDQEEAIRNBACEGA0AgBkECaiEIAn8gBkEBdCAFaiIGLgECIgdFBEBBACEJQQAhDEEAIQ1BACEOIAgMAQsgEiAGLgEAaiEJQQAhDkEAIQ1BACEMIAchFEEAIQ8gCCEGA0AgBSAGQQF0ai4BACAAIAlBAnRqKAIAIhBBGHZsIhEgD2ohDyARIBBBEHZB/wFxbCAMaiEMIBEgEEEIdkH/AXFsIA1qIQ0gESAQQf8BcWwgDmohDiAJQQFqIQkgBkEBaiEGIBRBAWsiFA0ACyAPQQd1IQkgByAIagshBiABIApBAXQiCGogDkH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEECcmogDUH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEEEcmogDEH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEEGcmogCUEAIAlBAEobOwEAIAogFWohCiATQQFqIhMgBEcNAAsgC0EBaiILIAJsIRIgC0ECdCEKIAMgC0cNAAsLC4IEAQ9/AkAgA0UNACAERQ0AIAJBAnQhFANAIAshDEEAIRJBACEHA0AgB0ECaiEKAn8gB0EBdCAFaiICLgECIhNFBEBBACEIQQAhCUEAIQYgCiEHQQAMAQsgAi4BAEECdCARaiEJQQAhByATIQJBACENIAohBkEAIQ5BACEPA0AgBSAGQQF0ai4BACIIIAAgCUEBdCIQai8BAGwgB2ohByAAIBBBBnJqLwEAIAhsIA5qIQ4gACAQQQRyai8BACAIbCAPaiEPIAAgEEECcmovAQAgCGwgDWohDSAJQQRqIQkgBkEBaiEGIAJBAWsiAg0ACyAHQQd1IQggDUEHdSEJIA9BB3UhBiAKIBNqIQcgDkEHdQtBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKGyIKQf8BcQRAIAlB/wFsIAJtIQkgCEH/AWwgAm0hCCAGQf8BbCACbSEGCyABIAxBAnRqIAlBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKG0EIdEGA/gNxIAZBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKG0EQdEGAgPwHcSAKQRh0ciAIQYBAa0EOdSICQf8BIAJB/wFIGyICQQAgAkEAShtycjYCACADIAxqIQwgEkEBaiISIARHDQALIBQgC0EBaiILbCERIAMgC0cNAAsLC0AAIAcEQEEAIAIgAyAEIAUgABADIAJBACAEIAUgBiABEAQPC0EAIAIgAyAEIAUgABABIAJBACAEIAUgBiABEAIL"},{}],4:[function(n,r,i){r.exports={name:"resize",fn:n("./resize"),wasm_fn:n("./resize_wasm"),wasm_src:n("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(n,r,i){var a=n("./resize_filter_gen"),o=n("./convolve"),s=o.convolveHor,u=o.convolveVert,f=o.convolveHorWithPre,l=o.convolveVertWithPre;function h(d,v,g){for(var m=3,y=v*g*4|0;m<y;){if(d[m]!==255)return!0;m=m+4|0}return!1}function c(d,v,g){for(var m=3,y=v*g*4|0;m<y;)d[m]=255,m=m+4|0}r.exports=function(v){var g=v.src,m=v.width,y=v.height,w=v.toWidth,x=v.toHeight,p=v.scaleX||v.toWidth/v.width,A=v.scaleY||v.toHeight/v.height,_=v.offsetX||0,C=v.offsetY||0,k=v.dest||new Uint8Array(w*x*4),S=typeof v.filter>"u"?"mks2013":v.filter,N=a(S,m,w,p,_),I=a(S,y,x,A,C),O=new Uint16Array(w*y*4);return h(g,m,y)?(f(g,O,m,y,w,N),l(O,k,y,w,x,I)):(s(g,O,m,y,w,N),u(O,k,y,w,x,I),c(k,w,x)),k}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(n,r,i){var a=n("./resize_filter_info"),o=14;function s(u){return Math.round(u*((1<<o)-1))}r.exports=function(f,l,h,c,d){var v=a.filter[f].fn,g=1/c,m=Math.min(1,c),y=a.filter[f].win/m,w,x,p,A,_,C,k,S,N,I,O,z,b,F,E,R,B,T=Math.floor((y+1)*2),M=new Int16Array((T+2)*h),P=0,D=!M.subarray||!M.set;for(w=0;w<h;w++){for(x=(w+.5)*g+d,p=Math.max(0,Math.floor(x-y)),A=Math.min(l-1,Math.ceil(x+y)),_=A-p+1,C=new Float32Array(_),k=new Int16Array(_),S=0,N=p,I=0;N<=A;N++,I++)O=v((N+.5-x)*m),S+=O,C[I]=O;for(z=0,I=0;I<C.length;I++)b=C[I]/S,z+=b,k[I]=s(b);for(k[h>>1]+=s(1-z),F=0;F<k.length&&k[F]===0;)F++;if(F<k.length){for(E=k.length-1;E>0&&k[E]===0;)E--;if(R=p+F,B=E-F+1,M[P++]=R,M[P++]=B,!D)M.set(k.subarray(F,E+1),P),P+=B;else for(I=F;I<=E;I++)M[P++]=k[I]}else M[P++]=0,M[P++]=0}return M}},{"./resize_filter_info":7}],7:[function(n,r,i){var a={box:{win:.5,fn:function(s){return s<0&&(s=-s),s<.5?1:0}},hamming:{win:1,fn:function(s){if(s<0&&(s=-s),s>=1)return 0;if(s<11920929e-14)return 1;var u=s*Math.PI;return Math.sin(u)/u*(.54+.46*Math.cos(u/1))}},lanczos2:{win:2,fn:function(s){if(s<0&&(s=-s),s>=2)return 0;if(s<11920929e-14)return 1;var u=s*Math.PI;return Math.sin(u)/u*Math.sin(u/2)/(u/2)}},lanczos3:{win:3,fn:function(s){if(s<0&&(s=-s),s>=3)return 0;if(s<11920929e-14)return 1;var u=s*Math.PI;return Math.sin(u)/u*Math.sin(u/3)/(u/3)}},mks2013:{win:2.5,fn:function(s){return s<0&&(s=-s),s>=2.5?0:s>=1.5?-.125*(s-2.5)*(s-2.5):s>=.5?.25*(4*s*s-11*s+7):1.0625-1.75*s*s}}};r.exports={filter:a,f2q:{box:0,hamming:1,lanczos2:2,lanczos3:3},q2f:["box","hamming","lanczos2","lanczos3"]}},{}],8:[function(n,r,i){var a=n("./resize_filter_gen");function o(h,c,d){for(var v=3,g=c*d*4|0;v<g;){if(h[v]!==255)return!0;v=v+4|0}return!1}function s(h,c,d){for(var v=3,g=c*d*4|0;v<g;)h[v]=255,v=v+4|0}function u(h){return new Uint8Array(h.buffer,0,h.byteLength)}var f=!0;try{f=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1}catch{}function l(h,c,d){if(f){c.set(u(h),d);return}for(var v=d,g=0;g<h.length;g++){var m=h[g];c[v++]=m&255,c[v++]=m>>8&255}}r.exports=function(c){var d=c.src,v=c.width,g=c.height,m=c.toWidth,y=c.toHeight,w=c.scaleX||c.toWidth/c.width,x=c.scaleY||c.toHeight/c.height,p=c.offsetX||0,A=c.offsetY||0,_=c.dest||new Uint8Array(m*y*4),C=typeof c.filter>"u"?"mks2013":c.filter,k=a(C,v,m,w,p),S=a(C,g,y,x,A),N=0,I=Math.max(d.byteLength,_.byteLength),O=this.__align(N+I),z=g*m*4*2,b=this.__align(O+z),F=this.__align(b+k.byteLength),E=F+S.byteLength,R=this.__instance("resize",E),B=new Uint8Array(this.__memory.buffer),T=new Uint32Array(this.__memory.buffer),M=new Uint32Array(d.buffer);T.set(M),l(k,B,b),l(S,B,F);var P=R.exports.convolveHV||R.exports._convolveHV;o(d,v,g)?P(b,F,O,v,g,m,y,1):(P(b,F,O,v,g,m,y,0),s(_,m,y));var D=new Uint32Array(_.buffer);return D.set(new Uint32Array(this.__memory.buffer,0,y*m)),_}},{"./resize_filter_gen":6}],9:[function(n,r,i){r.exports={name:"unsharp_mask",fn:n("./unsharp_mask"),wasm_fn:n("./unsharp_mask_wasm"),wasm_src:n("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(n,r,i){var a=n("glur/mono16");function o(s,u,f){for(var l=u*f,h=new Uint16Array(l),c,d,v,g,m=0;m<l;m++)c=s[4*m],d=s[4*m+1],v=s[4*m+2],g=c>=d&&c>=v?c:d>=v&&d>=c?d:v,h[m]=g<<8;return h}r.exports=function(u,f,l,h,c,d){var v,g,m,y,w;if(!(h===0||c<.5)){c>2&&(c=2);var x=o(u,f,l),p=new Uint16Array(x);a(p,f,l,c);for(var A=h/100*4096+.5|0,_=d<<8,C=f*l,k=0;k<C;k++)v=x[k],y=v-p[k],Math.abs(y)>=_&&(g=v+(A*y+2048>>12),g=g>65280?65280:g,g=g<0?0:g,v=v!==0?v:1,m=(g<<12)/v|0,w=k*4,u[w]=u[w]*m+2048>>12,u[w+1]=u[w+1]*m+2048>>12,u[w+2]=u[w+2]*m+2048>>12)}}},{"glur/mono16":18}],11:[function(n,r,i){r.exports=function(o,s,u,f,l,h){if(!(f===0||l<.5)){l>2&&(l=2);var c=s*u,d=c*4,v=c*2,g=c*2,m=Math.max(s,u)*4,y=8*4,w=0,x=d,p=x+v,A=p+g,_=A+g,C=_+m,k=this.__instance("unsharp_mask",d+v+g*2+m+y,{exp:Math.exp}),S=new Uint32Array(o.buffer),N=new Uint32Array(this.__memory.buffer);N.set(S);var I=k.exports.hsv_v16||k.exports._hsv_v16;I(w,x,s,u),I=k.exports.blurMono16||k.exports._blurMono16,I(x,p,A,_,C,s,u,l),I=k.exports.unsharp||k.exports._unsharp,I(w,w,x,p,s,u,f,h),S.set(new Uint32Array(this.__memory.buffer,0,c))}}},{}],12:[function(n,r,i){r.exports="AGFzbQEAAAAADAZkeWxpbmsAAAAAAAE0B2AAAGAEf39/fwBgBn9/f39/fwBgCH9/f39/f39/AGAIf39/f39/f30AYAJ9fwBgAXwBfAIZAgNlbnYDZXhwAAYDZW52Bm1lbW9yeQIAAAMHBgAFAgQBAwYGAX8AQQALB4oBCBFfX3dhc21fY2FsbF9jdG9ycwABFl9fYnVpbGRfZ2F1c3NpYW5fY29lZnMAAg5fX2dhdXNzMTZfbGluZQADCmJsdXJNb25vMTYABAdoc3ZfdjE2AAUHdW5zaGFycAAGDF9fZHNvX2hhbmRsZQMAGF9fd2FzbV9hcHBseV9kYXRhX3JlbG9jcwABCsUMBgMAAQvWAQEHfCABRNuGukOCGvs/IAC7oyICRAAAAAAAAADAohAAIgW2jDgCFCABIAKaEAAiAyADoCIGtjgCECABRAAAAAAAAPA/IAOhIgQgBKIgAyACIAKgokQAAAAAAADwP6AgBaGjIgS2OAIAIAEgBSAEmqIiB7Y4AgwgASADIAJEAAAAAAAA8D+gIASioiIItjgCCCABIAMgAkQAAAAAAADwv6AgBKKiIgK2OAIEIAEgByAIoCAFRAAAAAAAAPA/IAahoCIDo7Y4AhwgASAEIAKgIAOjtjgCGAuGBQMGfwl8An0gAyoCDCEVIAMqAgghFiADKgIUuyERIAMqAhC7IRACQCAEQQFrIghBAEgiCQRAIAIhByAAIQYMAQsgAiAALwEAuCIPIAMqAhi7oiIMIBGiIg0gDCAQoiAPIAMqAgS7IhOiIhQgAyoCALsiEiAPoqCgoCIOtjgCACACQQRqIQcgAEECaiEGIAhFDQAgCEEBIAhBAUgbIgpBf3MhCwJ/IAQgCmtBAXFFBEAgDiENIAgMAQsgAiANIA4gEKIgFCASIAAvAQK4Ig+ioKCgIg22OAIEIAJBCGohByAAQQRqIQYgDiEMIARBAmsLIQIgC0EAIARrRg0AA0AgByAMIBGiIA0gEKIgDyAToiASIAYvAQC4Ig6ioKCgIgy2OAIAIAcgDSARoiAMIBCiIA4gE6IgEiAGLwECuCIPoqCgoCINtjgCBCAHQQhqIQcgBkEEaiEGIAJBAkohACACQQJrIQIgAA0ACwsCQCAJDQAgASAFIAhsQQF0aiIAAn8gBkECay8BACICuCINIBW7IhKiIA0gFrsiE6KgIA0gAyoCHLuiIgwgEKKgIAwgEaKgIg8gB0EEayIHKgIAu6AiDkQAAAAAAADwQWMgDkQAAAAAAAAAAGZxBEAgDqsMAQtBAAs7AQAgCEUNACAGQQRrIQZBACAFa0EBdCEBA0ACfyANIBKiIAJB//8DcbgiDSAToqAgDyIOIBCioCAMIBGioCIPIAdBBGsiByoCALugIgxEAAAAAAAA8EFjIAxEAAAAAAAAAABmcQRAIAyrDAELQQALIQMgBi8BACECIAAgAWoiACADOwEAIAZBAmshBiAIQQFKIQMgDiEMIAhBAWshCCADDQALCwvRAgIBfwd8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIglEAAAAAAAAAMCiEAAiDLaMOAIUIAQgCZoQACIKIAqgIg22OAIQIAREAAAAAAAA8D8gCqEiCyALoiAKIAkgCaCiRAAAAAAAAPA/oCAMoaMiC7Y4AgAgBCAMIAuaoiIOtjgCDCAEIAogCUQAAAAAAADwP6AgC6KiIg+2OAIIIAQgCiAJRAAAAAAAAPC/oCALoqIiCbY4AgQgBCAOIA+gIAxEAAAAAAAA8D8gDaGgIgqjtjgCHCAEIAsgCaAgCqO2OAIYIAYEQANAIAAgBSAIbEEBdGogAiAIQQF0aiADIAQgBSAGEAMgCEEBaiIIIAZHDQALCyAFRQ0AQQAhCANAIAIgBiAIbEEBdGogASAIQQF0aiADIAQgBiAFEAMgCEEBaiIIIAVHDQALCwtxAQN/IAIgA2wiBQRAA0AgASAAKAIAIgRBEHZB/wFxIgIgAiAEQQh2Qf8BcSIDIAMgBEH/AXEiBEkbIAIgA0sbIgYgBiAEIAIgBEsbIAMgBEsbQQh0OwEAIAFBAmohASAAQQRqIQAgBUEBayIFDQALCwuZAgIDfwF8IAQgBWwhBAJ/IAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6AiC5lEAAAAAAAA4EFjBEAgC6oMAQtBgICAgHgLIQUgBARAIAdBCHQhCUEAIQYDQCAJIAIgBkEBdCIHai8BACIBIAMgB2ovAQBrIgcgB0EfdSIIaiAIc00EQCAAIAZBAnQiCGoiCiAFIAdsQYAQakEMdSABaiIHQYD+AyAHQYD+A0gbIgdBACAHQQBKG0EMdCABQQEgARtuIgEgCi0AAGxBgBBqQQx2OgAAIAAgCEEBcmoiByABIActAABsQYAQakEMdjoAACAAIAhBAnJqIgcgASAHLQAAbEGAEGpBDHY6AAALIAZBAWoiBiAERw0ACwsL"},{}],13:[function(n,r,i){var a=100;function o(s,u){this.create=s,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=u||2e3}o.prototype.acquire=function(){var s=this,u;return this.available.length!==0?u=this.available.pop():(u=this.create(),u.id=this.lastId++,u.release=function(){return s.release(u)}),this.acquired[u.id]=u,u},o.prototype.release=function(s){var u=this;delete this.acquired[s.id],s.lastUsed=Date.now(),this.available.push(s),this.timeoutId===0&&(this.timeoutId=setTimeout(function(){return u.gc()},a))},o.prototype.gc=function(){var s=this,u=Date.now();this.available=this.available.filter(function(f){return u-f.lastUsed>s.idle?(f.destroy(),!1):!0}),this.available.length!==0?this.timeoutId=setTimeout(function(){return s.gc()},a):this.timeoutId=0},r.exports=o},{}],14:[function(n,r,i){var a=2;r.exports=function(s,u,f,l,h,c){var d=f/s,v=l/u,g=(2*c+a+1)/h;if(g>.5)return[[f,l]];var m=Math.ceil(Math.log(Math.min(d,v))/Math.log(g));if(m<=1)return[[f,l]];for(var y=[],w=0;w<m;w++){var x=Math.round(Math.pow(Math.pow(s,m-w-1)*Math.pow(f,w+1),1/m)),p=Math.round(Math.pow(Math.pow(u,m-w-1)*Math.pow(l,w+1),1/m));y.push([x,p])}return y}},{}],15:[function(n,r,i){var a=1e-5;function o(u){var f=Math.round(u);return Math.abs(u-f)<a?f:Math.floor(u)}function s(u){var f=Math.round(u);return Math.abs(u-f)<a?f:Math.ceil(u)}r.exports=function(f){var l=f.toWidth/f.width,h=f.toHeight/f.height,c=o(f.srcTileSize*l)-2*f.destTileBorder,d=o(f.srcTileSize*h)-2*f.destTileBorder;if(c<1||d<1)throw new Error("Internal error in pica: target tile width/height is too small.");var v,g,m,y,w,x,p=[],A;for(y=0;y<f.toHeight;y+=d)for(m=0;m<f.toWidth;m+=c)v=m-f.destTileBorder,v<0&&(v=0),w=m+c+f.destTileBorder-v,v+w>=f.toWidth&&(w=f.toWidth-v),g=y-f.destTileBorder,g<0&&(g=0),x=y+d+f.destTileBorder-g,g+x>=f.toHeight&&(x=f.toHeight-g),A={toX:v,toY:g,toWidth:w,toHeight:x,toInnerX:m,toInnerY:y,toInnerWidth:c,toInnerHeight:d,offsetX:v/l-o(v/l),offsetY:g/h-o(g/h),scaleX:l,scaleY:h,x:o(v/l),y:o(g/h),width:s(w/l),height:s(x/h)},p.push(A);return p}},{}],16:[function(n,r,i){function a(o){return Object.prototype.toString.call(o)}r.exports.isCanvas=function(s){var u=a(s);return u==="[object HTMLCanvasElement]"||u==="[object OffscreenCanvas]"||u==="[object Canvas]"},r.exports.isImage=function(s){return a(s)==="[object HTMLImageElement]"},r.exports.isImageBitmap=function(s){return a(s)==="[object ImageBitmap]"},r.exports.limiter=function(s){var u=0,f=[];function l(){u<s&&f.length&&(u++,f.shift()())}return function(c){return new Promise(function(d,v){f.push(function(){c().then(function(g){d(g),u--,l()},function(g){v(g),u--,l()})}),l()})}},r.exports.cib_quality_name=function(s){switch(s){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},r.exports.cib_support=function(s){return Promise.resolve().then(function(){if(typeof createImageBitmap>"u")return!1;var u=s(100,100);return createImageBitmap(u,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(f){var l=f.width===10;return f.close(),u=null,l})}).catch(function(){return!1})},r.exports.worker_offscreen_canvas_support=function(){return new Promise(function(s,u){if(typeof OffscreenCanvas>"u"){s(!1);return}function f(c){if(typeof createImageBitmap>"u"){c.postMessage(!1);return}Promise.resolve().then(function(){var d=new OffscreenCanvas(10,10),v=d.getContext("2d");return v.rect(0,0,1,1),createImageBitmap(d,0,0,1,1)}).then(function(){return c.postMessage(!0)},function(){return c.postMessage(!1)})}var l=btoa("(".concat(f.toString(),")(self);")),h=new Worker("data:text/javascript;base64,".concat(l));h.onmessage=function(c){return s(c.data)},h.onerror=u}).then(function(s){return s},function(){return!1})},r.exports.can_use_canvas=function(s){var u=!1;try{var f=s(2,1),l=f.getContext("2d"),h=l.createImageData(2,1);h.data[0]=12,h.data[1]=23,h.data[2]=34,h.data[3]=255,h.data[4]=45,h.data[5]=56,h.data[6]=67,h.data[7]=255,l.putImageData(h,0,0),h=null,h=l.getImageData(0,0,2,1),h.data[0]===12&&h.data[1]===23&&h.data[2]===34&&h.data[3]===255&&h.data[4]===45&&h.data[5]===56&&h.data[6]===67&&h.data[7]===255&&(u=!0)}catch{}return u},r.exports.cib_can_use_region=function(){return new Promise(function(s){if(typeof Image>"u"||typeof createImageBitmap>"u"){s(!1);return}var u=new Image;u.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",u.onload=function(){createImageBitmap(u,0,0,u.width,u.height).then(function(f){f.width===u.width&&f.height===u.height?s(!0):s(!1)},function(){return s(!1)})},u.onerror=function(){return s(!1)}})}},{}],17:[function(n,r,i){r.exports=function(){var a=n("./mathlib"),o;onmessage=function(u){var f=u.data.opts;if(!f.src&&f.srcBitmap){var l=new OffscreenCanvas(f.width,f.height),h=l.getContext("2d");h.drawImage(f.srcBitmap,0,0),f.src=h.getImageData(0,0,f.width,f.height).data,l.width=l.height=0,l=null,f.srcBitmap.close(),f.srcBitmap=null}o||(o=new a(u.data.features));var c=o.resizeAndUnsharp(f);postMessage({data:c},[c.buffer])}}},{"./mathlib":1}],18:[function(n,r,i){var a,o,s,u,f,l,h,c;function d(m){m<.5&&(m=.5);var y=Math.exp(.726*.726)/m,w=Math.exp(-y),x=Math.exp(-2*y),p=(1-w)*(1-w)/(1+2*y*w-x);return a=p,o=p*(y-1)*w,s=p*(y+1)*w,u=-p*x,f=2*w,l=-x,h=(a+o)/(1-f-l),c=(s+u)/(1-f-l),new Float32Array([a,o,s,u,f,l,h,c])}function v(m,y,w,x,p,A){var _,C,k,S,N,I,O,z,b,F,E,R,B,T;for(b=0;b<A;b++){for(I=b*p,O=b,z=0,_=m[I],N=_*x[6],S=N,E=x[0],R=x[1],B=x[4],T=x[5],F=0;F<p;F++)C=m[I],k=C*E+_*R+S*B+N*T,N=S,S=k,_=C,w[z]=S,z++,I++;for(I--,z--,O+=A*(p-1),_=m[I],N=_*x[7],S=N,C=_,E=x[2],R=x[3],F=p-1;F>=0;F--)k=C*E+_*R+S*B+N*T,N=S,S=k,_=C,C=m[I],y[O]=w[z]+S,I--,z--,O-=A}}function g(m,y,w,x){if(x){var p=new Uint16Array(m.length),A=new Float32Array(Math.max(y,w)),_=d(x);v(m,p,A,_,y,w),v(p,m,A,_,w,y)}}r.exports=g},{}],19:[function(n,r,i){var a=n("object-assign"),o=n("./lib/base64decode"),s=n("./lib/wa_detect"),u={js:!0,wasm:!0};function f(l){if(!(this instanceof f))return new f(l);var h=a({},u,l||{});if(this.options=h,this.__cache={},this.__init_promise=null,this.__modules=h.modules||{},this.__memory=null,this.__wasm={},this.__isLE=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1,!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}f.prototype.has_wasm=s,f.prototype.use=function(l){return this.__modules[l.name]=l,this.options.wasm&&this.has_wasm()&&l.wasm_fn?this[l.name]=l.wasm_fn:this[l.name]=l.fn,this},f.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error(`mathlib: only "wasm" was enabled, but it's not supported`));var l=this;return this.__init_promise=Promise.all(Object.keys(l.__modules).map(function(h){var c=l.__modules[h];return!l.options.wasm||!l.has_wasm()||!c.wasm_fn||l.__wasm[h]?null:WebAssembly.compile(l.__base64decode(c.wasm_src)).then(function(d){l.__wasm[h]=d})})).then(function(){return l}),this.__init_promise},f.prototype.__base64decode=o,f.prototype.__reallocate=function(h){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(h/(64*1024))}),this.__memory;var c=this.__memory.buffer.byteLength;return c<h&&this.__memory.grow(Math.ceil((h-c)/(64*1024))),this.__memory},f.prototype.__instance=function(h,c,d){if(c&&this.__reallocate(c),!this.__wasm[h]){var v=this.__modules[h];this.__wasm[h]=new WebAssembly.Module(this.__base64decode(v.wasm_src))}if(!this.__cache[h]){var g={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[h]=new WebAssembly.Instance(this.__wasm[h],{env:a(g,d||{})})}return this.__cache[h]},f.prototype.__align=function(h,c){c=c||8;var d=h%c;return h+(d?c-d:0)},r.exports=f},{"./lib/base64decode":20,"./lib/wa_detect":21,"object-assign":22}],20:[function(n,r,i){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";r.exports=function(s){for(var u=s.replace(/[\r\n=]/g,""),f=u.length,l=new Uint8Array(f*3>>2),h=0,c=0,d=0;d<f;d++)d%4===0&&d&&(l[c++]=h>>16&255,l[c++]=h>>8&255,l[c++]=h&255),h=h<<6|a.indexOf(u.charAt(d));var v=f%4*6;return v===0?(l[c++]=h>>16&255,l[c++]=h>>8&255,l[c++]=h&255):v===18?(l[c++]=h>>10&255,l[c++]=h>>2&255):v===12&&(l[c++]=h>>4&255),l}},{}],21:[function(n,r,i){var a;r.exports=function(){if(typeof a<"u"||(a=!1,typeof WebAssembly>"u"))return a;try{var s=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),u=new WebAssembly.Module(s),f=new WebAssembly.Instance(u,{});return f.exports.test(4)!==0&&(a=!0),a}catch{}return a}},{}],22:[function(n,r,i){var a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function u(l){if(l==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(l)}function f(){try{if(!Object.assign)return!1;var l=new String("abc");if(l[5]="de",Object.getOwnPropertyNames(l)[0]==="5")return!1;for(var h={},c=0;c<10;c++)h["_"+String.fromCharCode(c)]=c;var d=Object.getOwnPropertyNames(h).map(function(g){return h[g]});if(d.join("")!=="0123456789")return!1;var v={};return"abcdefghijklmnopqrst".split("").forEach(function(g){v[g]=g}),Object.keys(Object.assign({},v)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}r.exports=f()?Object.assign:function(l,h){for(var c,d=u(l),v,g=1;g<arguments.length;g++){c=Object(arguments[g]);for(var m in c)o.call(c,m)&&(d[m]=c[m]);if(a){v=a(c);for(var y=0;y<v.length;y++)s.call(c,v[y])&&(d[v[y]]=c[v[y]])}}return d}},{}],23:[function(n,r,i){var a=arguments[3],o=arguments[4],s=arguments[5],u=JSON.stringify;r.exports=function(f,l){for(var h,c=Object.keys(s),d=0,v=c.length;d<v;d++){var g=c[d],m=s[g].exports;if(m===f||m&&m.default===f){h=g;break}}if(!h){h=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var y={},d=0,v=c.length;d<v;d++){var g=c[d];y[g]=g}o[h]=["function(require,module,exports){"+f+"(self); }",y]}var w=Math.floor(Math.pow(16,8)*Math.random()).toString(16),x={};x[h]=h,o[w]=["function(require,module,exports){var f = require("+u(h)+");(f.default ? f.default : f)(self);}",x];var p={};A(w);function A(I){p[I]=!0;for(var O in o[I][1]){var z=o[I][1][O];p[z]||A(z)}}var _="("+a+")({"+Object.keys(p).map(function(I){return u(I)+":["+o[I][0]+","+u(o[I][1])+"]"}).join(",")+"},{},["+u(w)+"])",C=window.URL||window.webkitURL||window.mozURL||window.msURL,k=new Blob([_],{type:"text/javascript"});if(l&&l.bare)return k;var S=C.createObjectURL(k),N=new Worker(S);return N.objectURL=S,N}},{}],"/index.js":[function(n,r,i){function a(E,R){return l(E)||f(E,R)||s(E,R)||o()}function o(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function s(E,R){if(E){if(typeof E=="string")return u(E,R);var B=Object.prototype.toString.call(E).slice(8,-1);if(B==="Object"&&E.constructor&&(B=E.constructor.name),B==="Map"||B==="Set")return Array.from(E);if(B==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(B))return u(E,R)}}function u(E,R){(R==null||R>E.length)&&(R=E.length);for(var B=0,T=new Array(R);B<R;B++)T[B]=E[B];return T}function f(E,R){var B=E==null?null:typeof Symbol<"u"&&E[Symbol.iterator]||E["@@iterator"];if(B!=null){var T=[],M=!0,P=!1,D,L;try{for(B=B.call(E);!(M=(D=B.next()).done)&&(T.push(D.value),!(R&&T.length===R));M=!0);}catch(U){P=!0,L=U}finally{try{!M&&B.return!=null&&B.return()}finally{if(P)throw L}}return T}}function l(E){if(Array.isArray(E))return E}var h=n("object-assign"),c=n("webworkify"),d=n("./lib/mathlib"),v=n("./lib/pool"),g=n("./lib/utils"),m=n("./lib/worker"),y=n("./lib/stepper"),w=n("./lib/tiler"),x=n("./lib/mm_resize/resize_filter_info"),p={},A=!1;try{typeof navigator<"u"&&navigator.userAgent&&(A=navigator.userAgent.indexOf("Safari")>=0)}catch{}var _=1;typeof navigator<"u"&&(_=Math.min(navigator.hardwareConcurrency||1,4));var C={tile:1024,concurrency:_,features:["js","wasm","ww"],idle:2e3,createCanvas:function(R,B){var T=document.createElement("canvas");return T.width=R,T.height=B,T}},k={filter:"mks2013",unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},S=!1,N=!1,I=!1,O=!1,z=!1;function b(){return{value:c(m),destroy:function(){if(this.value.terminate(),typeof window<"u"){var R=window.URL||window.webkitURL||window.mozURL||window.msURL;R&&R.revokeObjectURL&&this.value.objectURL&&R.revokeObjectURL(this.value.objectURL)}}}}function F(E){if(!(this instanceof F))return new F(E);this.options=h({},C,E||{});var R="lk_".concat(this.options.concurrency);this.__limit=p[R]||g.limiter(this.options.concurrency),p[R]||(p[R]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}F.prototype.init=function(){var E=this;if(this.__initPromise)return this.__initPromise;if(typeof ImageData<"u"&&typeof Uint8ClampedArray<"u")try{new ImageData(new Uint8ClampedArray(400),10,10),S=!0}catch{}typeof ImageBitmap<"u"&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?N=!0:this.debug("ImageBitmap does not support .close(), disabled"));var R=this.options.features.slice();if(R.indexOf("all")>=0&&(R=["cib","wasm","js","ww"]),this.__requested_features=R,this.__mathlib=new d(R),R.indexOf("ww")>=0&&typeof window<"u"&&"Worker"in window)try{var B=n("webworkify")(function(){});B.terminate(),this.features.ww=!0;var T="wp_".concat(JSON.stringify(this.options));p[T]?this.__workersPool=p[T]:(this.__workersPool=new v(b,this.options.idle),p[T]=this.__workersPool)}catch{}var M=this.__mathlib.init().then(function(U){h(E.features,U.features)}),P;N?P=g.cib_support(this.options.createCanvas).then(function(U){if(E.features.cib&&R.indexOf("cib")<0){E.debug("createImageBitmap() resize supported, but disabled by config");return}R.indexOf("cib")>=0&&(E.features.cib=U)}):P=Promise.resolve(!1),I=g.can_use_canvas(this.options.createCanvas);var D;N&&S&&R.indexOf("ww")!==-1?D=g.worker_offscreen_canvas_support():D=Promise.resolve(!1),D=D.then(function(U){O=U});var L=g.cib_can_use_region().then(function(U){z=U});return this.__initPromise=Promise.all([M,P,D,L]).then(function(){return E}),this.__initPromise},F.prototype.__invokeResize=function(E,R){var B=this;return R.__mathCache=R.__mathCache||{},Promise.resolve().then(function(){return B.features.ww?new Promise(function(T,M){var P=B.__workersPool.acquire();R.cancelToken&&R.cancelToken.catch(function(L){return M(L)}),P.value.onmessage=function(L){P.release(),L.data.err?M(L.data.err):T(L.data)};var D=[];E.src&&D.push(E.src.buffer),E.srcBitmap&&D.push(E.srcBitmap),P.value.postMessage({opts:E,features:B.__requested_features,preload:{wasm_nodule:B.__mathlib.__}},D)}):{data:B.__mathlib.resizeAndUnsharp(E,R.__mathCache)}})},F.prototype.__extractTileData=function(E,R,B,T,M){if(this.features.ww&&O&&(g.isCanvas(R)||z))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(T.srcImageBitmap||R,E.x,E.y,E.width,E.height).then(function(L){return M.srcBitmap=L,M});if(g.isCanvas(R))return T.srcCtx||(T.srcCtx=R.getContext("2d")),this.debug("Get tile pixel data"),M.src=T.srcCtx.getImageData(E.x,E.y,E.width,E.height).data,M;this.debug("Draw tile imageBitmap/image to temporary canvas");var P=this.options.createCanvas(E.width,E.height),D=P.getContext("2d");return D.globalCompositeOperation="copy",D.drawImage(T.srcImageBitmap||R,E.x,E.y,E.width,E.height,0,0,E.width,E.height),this.debug("Get tile pixel data"),M.src=D.getImageData(0,0,E.width,E.height).data,P.width=P.height=0,M},F.prototype.__landTileData=function(E,R,B){var T;if(this.debug("Convert raw rgba tile result to ImageData"),R.bitmap)return B.toCtx.drawImage(R.bitmap,E.toX,E.toY),null;if(S)T=new ImageData(new Uint8ClampedArray(R.data),E.toWidth,E.toHeight);else if(T=B.toCtx.createImageData(E.toWidth,E.toHeight),T.data.set)T.data.set(R.data);else for(var M=T.data.length-1;M>=0;M--)T.data[M]=R.data[M];return this.debug("Draw tile"),A?B.toCtx.putImageData(T,E.toX,E.toY,E.toInnerX-E.toX,E.toInnerY-E.toY,E.toInnerWidth+1e-5,E.toInnerHeight+1e-5):B.toCtx.putImageData(T,E.toX,E.toY,E.toInnerX-E.toX,E.toInnerY-E.toY,E.toInnerWidth,E.toInnerHeight),null},F.prototype.__tileAndResize=function(E,R,B){var T=this,M={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null},P=function(L){return T.__limit(function(){if(B.canceled)return B.cancelToken;var U={width:L.width,height:L.height,toWidth:L.toWidth,toHeight:L.toHeight,scaleX:L.scaleX,scaleY:L.scaleY,offsetX:L.offsetX,offsetY:L.offsetY,filter:B.filter,unsharpAmount:B.unsharpAmount,unsharpRadius:B.unsharpRadius,unsharpThreshold:B.unsharpThreshold};return T.debug("Invoke resize math"),Promise.resolve(U).then(function(Q){return T.__extractTileData(L,E,B,M,Q)}).then(function(Q){return T.debug("Invoke resize math"),T.__invokeResize(Q,B)}).then(function(Q){return B.canceled?B.cancelToken:(M.srcImageData=null,T.__landTileData(L,Q,M))})})};return Promise.resolve().then(function(){if(M.toCtx=R.getContext("2d"),g.isCanvas(E))return null;if(g.isImageBitmap(E))return M.srcImageBitmap=E,M.isImageBitmapReused=!0,null;if(g.isImage(E))return N?(T.debug("Decode image via createImageBitmap"),createImageBitmap(E).then(function(D){M.srcImageBitmap=D}).catch(function(D){return null})):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(B.canceled)return B.cancelToken;T.debug("Calculate tiles");var D=w({width:B.width,height:B.height,srcTileSize:T.options.tile,toWidth:B.toWidth,toHeight:B.toHeight,destTileBorder:B.__destTileBorder}),L=D.map(function(Q){return P(Q)});function U(Q){Q.srcImageBitmap&&(Q.isImageBitmapReused||Q.srcImageBitmap.close(),Q.srcImageBitmap=null)}return T.debug("Process tiles"),Promise.all(L).then(function(){return T.debug("Finished!"),U(M),R},function(Q){throw U(M),Q})})},F.prototype.__processStages=function(E,R,B,T){var M=this;if(T.canceled)return T.cancelToken;var P=E.shift(),D=a(P,2),L=D[0],U=D[1],Q=E.length===0,G;Q||x.q2f.indexOf(T.filter)<0?G=T.filter:T.filter==="box"?G="box":G="hamming",T=h({},T,{toWidth:L,toHeight:U,filter:G});var V;return Q||(V=this.options.createCanvas(L,U)),this.__tileAndResize(R,Q?B:V,T).then(function(){return Q?B:(T.width=L,T.height=U,M.__processStages(E,V,B,T))}).then(function(W){return V&&(V.width=V.height=0),W})},F.prototype.__resizeViaCreateImageBitmap=function(E,R,B){var T=this,M=R.getContext("2d");return this.debug("Resize via createImageBitmap()"),createImageBitmap(E,{resizeWidth:B.toWidth,resizeHeight:B.toHeight,resizeQuality:g.cib_quality_name(x.f2q[B.filter])}).then(function(P){if(B.canceled)return B.cancelToken;if(!B.unsharpAmount)return M.drawImage(P,0,0),P.close(),M=null,T.debug("Finished!"),R;T.debug("Unsharp result");var D=T.options.createCanvas(B.toWidth,B.toHeight),L=D.getContext("2d");L.drawImage(P,0,0),P.close();var U=L.getImageData(0,0,B.toWidth,B.toHeight);return T.__mathlib.unsharp_mask(U.data,B.toWidth,B.toHeight,B.unsharpAmount,B.unsharpRadius,B.unsharpThreshold),M.putImageData(U,0,0),D.width=D.height=0,U=L=D=M=null,T.debug("Finished!"),R})},F.prototype.resize=function(E,R,B){var T=this;this.debug("Start resize...");var M=h({},k);if(isNaN(B)?B&&(M=h(M,B)):M=h(M,{quality:B}),M.toWidth=R.width,M.toHeight=R.height,M.width=E.naturalWidth||E.width,M.height=E.naturalHeight||E.height,Object.prototype.hasOwnProperty.call(M,"quality")){if(M.quality<0||M.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(M.quality));M.filter=x.q2f[M.quality]}if(R.width===0||R.height===0)return Promise.reject(new Error("Invalid output size: ".concat(R.width,"x").concat(R.height)));M.unsharpRadius>2&&(M.unsharpRadius=2),M.canceled=!1,M.cancelToken&&(M.cancelToken=M.cancelToken.then(function(D){throw M.canceled=!0,D},function(D){throw M.canceled=!0,D}));var P=3;return M.__destTileBorder=Math.ceil(Math.max(P,2.5*M.unsharpRadius|0)),this.init().then(function(){if(M.canceled)return M.cancelToken;if(T.features.cib){if(x.q2f.indexOf(M.filter)>=0)return T.__resizeViaCreateImageBitmap(E,R,M);T.debug("cib is enabled, but not supports provided filter, fallback to manual math")}if(!I){var D=new Error("Pica: cannot use getImageData on canvas, make sure fingerprinting protection isn't enabled");throw D.code="ERR_GET_IMAGE_DATA",D}var L=y(M.width,M.height,M.toWidth,M.toHeight,T.options.tile,M.__destTileBorder);return T.__processStages(L,E,R,M)})},F.prototype.resizeBuffer=function(E){var R=this,B=h({},k,E);if(Object.prototype.hasOwnProperty.call(B,"quality")){if(B.quality<0||B.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(B.quality));B.filter=x.q2f[B.quality]}return this.init().then(function(){return R.__mathlib.resizeAndUnsharp(B)})},F.prototype.toBlob=function(E,R,B){return R=R||"image/png",new Promise(function(T){if(E.toBlob){E.toBlob(function(U){return T(U)},R,B);return}if(E.convertToBlob){T(E.convertToBlob({type:R,quality:B}));return}for(var M=atob(E.toDataURL(R,B).split(",")[1]),P=M.length,D=new Uint8Array(P),L=0;L<P;L++)D[L]=M.charCodeAt(L);T(new Blob([D],{type:R}))})},F.prototype.debug=function(){},r.exports=F},{"./lib/mathlib":1,"./lib/mm_resize/resize_filter_info":7,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":22,webworkify:23}]},{},[])("/index.js")})})(lr);var Eo=lr.exports;const ko=wo(Eo);let Co=function(){var t=function(e){};(function(e,n){typeof H=="object"&&typeof module<"u"?n(H):typeof define=="function"&&define.amd?define(["exports"],n):n((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{})})(this,function(e){var n={value:()=>{}};function r(){for(var u,f=0,l=arguments.length,h={};f<l;++f){if(!(u=arguments[f]+"")||u in h||/[\s.]/.test(u))throw new Error("illegal type: "+u);h[u]=[]}return new i(h)}function i(u){this._=u}function a(u,f){return u.trim().split(/^|\s+/).map(function(l){var h="",c=l.indexOf(".");if(c>=0&&(h=l.slice(c+1),l=l.slice(0,c)),l&&!f.hasOwnProperty(l))throw new Error("unknown type: "+l);return{type:l,name:h}})}function o(u,f){for(var l,h=0,c=u.length;h<c;++h)if((l=u[h]).name===f)return l.value}function s(u,f,l){for(var h=0,c=u.length;h<c;++h)if(u[h].name===f){u[h]=n,u=u.slice(0,h).concat(u.slice(h+1));break}return l!=null&&u.push({name:f,value:l}),u}i.prototype=r.prototype={constructor:i,on:function(u,f){var l,h=this._,c=a(u+"",h),d=-1,v=c.length;if(!(arguments.length<2)){if(f!=null&&typeof f!="function")throw new Error("invalid callback: "+f);for(;++d<v;)if(l=(u=c[d]).type)h[l]=s(h[l],u.name,f);else if(f==null)for(l in h)h[l]=s(h[l],u.name,null);return this}for(;++d<v;)if((l=(u=c[d]).type)&&(l=o(h[l],u.name)))return l},copy:function(){var u={},f=this._;for(var l in f)u[l]=f[l].slice();return new i(u)},call:function(u,f){if((l=arguments.length-2)>0)for(var l,h,c=new Array(l),d=0;d<l;++d)c[d]=arguments[d+2];if(!this._.hasOwnProperty(u))throw new Error("unknown type: "+u);for(d=0,l=(h=this._[u]).length;d<l;++d)h[d].value.apply(f,c)},apply:function(u,f,l){if(!this._.hasOwnProperty(u))throw new Error("unknown type: "+u);for(var h=this._[u],c=0,d=h.length;c<d;++c)h[c].value.apply(f,l)}},e.dispatch=r,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,n){typeof H=="object"&&typeof module<"u"?n(H):typeof define=="function"&&define.amd?define(["exports"],n):n((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{})}(this,function(e){function n(l,h,c,d){if(isNaN(h)||isNaN(c))return l;var v,g,m,y,w,x,p,A,_,C=l._root,k={data:d},S=l._x0,N=l._y0,I=l._x1,O=l._y1;if(!C)return l._root=k,l;for(;C.length;)if((x=h>=(g=(S+I)/2))?S=g:I=g,(p=c>=(m=(N+O)/2))?N=m:O=m,v=C,!(C=C[A=p<<1|x]))return v[A]=k,l;if(y=+l._x.call(null,C.data),w=+l._y.call(null,C.data),h===y&&c===w)return k.next=C,v?v[A]=k:l._root=k,l;do v=v?v[A]=new Array(4):l._root=new Array(4),(x=h>=(g=(S+I)/2))?S=g:I=g,(p=c>=(m=(N+O)/2))?N=m:O=m;while((A=p<<1|x)==(_=(w>=m)<<1|y>=g));return v[_]=C,v[A]=k,l}function r(l,h,c,d,v){this.node=l,this.x0=h,this.y0=c,this.x1=d,this.y1=v}function i(l){return l[0]}function a(l){return l[1]}function o(l,h,c){var d=new s(h??i,c??a,NaN,NaN,NaN,NaN);return l==null?d:d.addAll(l)}function s(l,h,c,d,v,g){this._x=l,this._y=h,this._x0=c,this._y0=d,this._x1=v,this._y1=g,this._root=void 0}function u(l){for(var h={data:l.data},c=h;l=l.next;)c=c.next={data:l.data};return h}var f=o.prototype=s.prototype;f.copy=function(){var l,h,c=new s(this._x,this._y,this._x0,this._y0,this._x1,this._y1),d=this._root;if(!d)return c;if(!d.length)return c._root=u(d),c;for(l=[{source:d,target:c._root=new Array(4)}];d=l.pop();)for(var v=0;v<4;++v)(h=d.source[v])&&(h.length?l.push({source:h,target:d.target[v]=new Array(4)}):d.target[v]=u(h));return c},f.add=function(l){const h=+this._x.call(null,l),c=+this._y.call(null,l);return n(this.cover(h,c),h,c,l)},f.addAll=function(l){var h,c,d,v,g=l.length,m=new Array(g),y=new Array(g),w=1/0,x=1/0,p=-1/0,A=-1/0;for(c=0;c<g;++c)isNaN(d=+this._x.call(null,h=l[c]))||isNaN(v=+this._y.call(null,h))||(m[c]=d,y[c]=v,d<w&&(w=d),d>p&&(p=d),v<x&&(x=v),v>A&&(A=v));if(w>p||x>A)return this;for(this.cover(w,x).cover(p,A),c=0;c<g;++c)n(this,m[c],y[c],l[c]);return this},f.cover=function(l,h){if(isNaN(l=+l)||isNaN(h=+h))return this;var c=this._x0,d=this._y0,v=this._x1,g=this._y1;if(isNaN(c))v=(c=Math.floor(l))+1,g=(d=Math.floor(h))+1;else{for(var m,y,w=v-c||1,x=this._root;c>l||l>=v||d>h||h>=g;)switch(y=(h<d)<<1|l<c,(m=new Array(4))[y]=x,x=m,w*=2,y){case 0:v=c+w,g=d+w;break;case 1:c=v-w,g=d+w;break;case 2:v=c+w,d=g-w;break;case 3:c=v-w,d=g-w}this._root&&this._root.length&&(this._root=x)}return this._x0=c,this._y0=d,this._x1=v,this._y1=g,this},f.data=function(){var l=[];return this.visit(function(h){if(!h.length)do l.push(h.data);while(h=h.next)}),l},f.extent=function(l){return arguments.length?this.cover(+l[0][0],+l[0][1]).cover(+l[1][0],+l[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},f.find=function(l,h,c){var d,v,g,m,y,w,x,p=this._x0,A=this._y0,_=this._x1,C=this._y1,k=[],S=this._root;for(S&&k.push(new r(S,p,A,_,C)),c==null?c=1/0:(p=l-c,A=h-c,_=l+c,C=h+c,c*=c);w=k.pop();)if(!(!(S=w.node)||(v=w.x0)>_||(g=w.y0)>C||(m=w.x1)<p||(y=w.y1)<A))if(S.length){var N=(v+m)/2,I=(g+y)/2;k.push(new r(S[3],N,I,m,y),new r(S[2],v,I,N,y),new r(S[1],N,g,m,I),new r(S[0],v,g,N,I)),(x=(h>=I)<<1|l>=N)&&(w=k[k.length-1],k[k.length-1]=k[k.length-1-x],k[k.length-1-x]=w)}else{var O=l-+this._x.call(null,S.data),z=h-+this._y.call(null,S.data),b=O*O+z*z;if(b<c){var F=Math.sqrt(c=b);p=l-F,A=h-F,_=l+F,C=h+F,d=S.data}}return d},f.remove=function(l){if(isNaN(g=+this._x.call(null,l))||isNaN(m=+this._y.call(null,l)))return this;var h,c,d,v,g,m,y,w,x,p,A,_,C=this._root,k=this._x0,S=this._y0,N=this._x1,I=this._y1;if(!C)return this;if(C.length)for(;;){if((x=g>=(y=(k+N)/2))?k=y:N=y,(p=m>=(w=(S+I)/2))?S=w:I=w,h=C,!(C=C[A=p<<1|x]))return this;if(!C.length)break;(h[A+1&3]||h[A+2&3]||h[A+3&3])&&(c=h,_=A)}for(;C.data!==l;)if(d=C,!(C=C.next))return this;return(v=C.next)&&delete C.next,d?(v?d.next=v:delete d.next,this):h?(v?h[A]=v:delete h[A],(C=h[0]||h[1]||h[2]||h[3])&&C===(h[3]||h[2]||h[1]||h[0])&&!C.length&&(c?c[_]=C:this._root=C),this):(this._root=v,this)},f.removeAll=function(l){for(var h=0,c=l.length;h<c;++h)this.remove(l[h]);return this},f.root=function(){return this._root},f.size=function(){var l=0;return this.visit(function(h){if(!h.length)do++l;while(h=h.next)}),l},f.visit=function(l){var h,c,d,v,g,m,y=[],w=this._root;for(w&&y.push(new r(w,this._x0,this._y0,this._x1,this._y1));h=y.pop();)if(!l(w=h.node,d=h.x0,v=h.y0,g=h.x1,m=h.y1)&&w.length){var x=(d+g)/2,p=(v+m)/2;(c=w[3])&&y.push(new r(c,x,p,g,m)),(c=w[2])&&y.push(new r(c,d,p,x,m)),(c=w[1])&&y.push(new r(c,x,v,g,p)),(c=w[0])&&y.push(new r(c,d,v,x,p))}return this},f.visitAfter=function(l){var h,c=[],d=[];for(this._root&&c.push(new r(this._root,this._x0,this._y0,this._x1,this._y1));h=c.pop();){var v=h.node;if(v.length){var g,m=h.x0,y=h.y0,w=h.x1,x=h.y1,p=(m+w)/2,A=(y+x)/2;(g=v[0])&&c.push(new r(g,m,y,p,A)),(g=v[1])&&c.push(new r(g,p,y,w,A)),(g=v[2])&&c.push(new r(g,m,A,p,x)),(g=v[3])&&c.push(new r(g,p,A,w,x))}d.push(h)}for(;h=d.pop();)l(h.node,h.x0,h.y0,h.x1,h.y1);return this},f.x=function(l){return arguments.length?(this._x=l,this):this._x},f.y=function(l){return arguments.length?(this._y=l,this):this._y},e.quadtree=o,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,n){typeof H=="object"&&typeof module<"u"?n(H):typeof define=="function"&&define.amd?define(["exports"],n):n((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{})}(this,function(e){var n,r,i=0,a=0,o=0,s=0,u=0,f=0,l=typeof performance=="object"&&performance.now?performance:Date,h=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(p){setTimeout(p,17)};function c(){return u||(h(d),u=l.now()+f)}function d(){u=0}function v(){this._call=this._time=this._next=null}function g(p,A,_){var C=new v;return C.restart(p,A,_),C}function m(){c(),++i;for(var p,A=n;A;)(p=u-A._time)>=0&&A._call.call(void 0,p),A=A._next;--i}function y(){u=(s=l.now())+f,i=a=0;try{m()}finally{i=0,function(){for(var p,A,_=n,C=1/0;_;)_._call?(C>_._time&&(C=_._time),p=_,_=_._next):(A=_._next,_._next=null,_=p?p._next=A:n=A);r=p,x(C)}(),u=0}}function w(){var p=l.now(),A=p-s;A>1e3&&(f-=A,s=p)}function x(p){i||(a&&(a=clearTimeout(a)),p-u>24?(p<1/0&&(a=setTimeout(y,p-l.now()-f)),o&&(o=clearInterval(o))):(o||(s=l.now(),o=setInterval(w,1e3)),i=1,h(y)))}v.prototype=g.prototype={constructor:v,restart:function(p,A,_){if(typeof p!="function")throw new TypeError("callback is not a function");_=(_==null?c():+_)+(A==null?0:+A),this._next||r===this||(r?r._next=this:n=this,r=this),this._call=p,this._time=_,x()},stop:function(){this._call&&(this._call=null,this._time=1/0,x())}},e.interval=function(p,A,_){var C=new v,k=A;return A==null?(C.restart(p,A,_),C):(C._restart=C.restart,C.restart=function(S,N,I){N=+N,I=I==null?c():+I,C._restart(function O(z){z+=k,C._restart(O,k+=N,I),S(z)},N,I)},C.restart(p,A,_),C)},e.now=c,e.timeout=function(p,A,_){var C=new v;return A=A==null?0:+A,C.restart(k=>{C.stop(),p(k+A)},A,_),C},e.timer=g,e.timerFlush=m,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,n){typeof H=="object"&&typeof module<"u"?n(H,t(),t(),t()):typeof define=="function"&&define.amd?define(["exports","d3-quadtree","d3-dispatch","d3-timer"],n):n((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{},e.d3,e.d3,e.d3)}(this,function(e,n,r,i){function a(g){return function(){return g}}function o(g){return 1e-6*(g()-.5)}function s(g){return g.x+g.vx}function u(g){return g.y+g.vy}function f(g){return g.index}function l(g,m){var y=g.get(m);if(!y)throw new Error("node not found: "+m);return y}const h=4294967296;function c(g){return g.x}function d(g){return g.y}var v=Math.PI*(3-Math.sqrt(5));e.forceCenter=function(g,m){var y,w=1;function x(){var p,A,_=y.length,C=0,k=0;for(p=0;p<_;++p)C+=(A=y[p]).x,k+=A.y;for(C=(C/_-g)*w,k=(k/_-m)*w,p=0;p<_;++p)(A=y[p]).x-=C,A.y-=k}return g==null&&(g=0),m==null&&(m=0),x.initialize=function(p){y=p},x.x=function(p){return arguments.length?(g=+p,x):g},x.y=function(p){return arguments.length?(m=+p,x):m},x.strength=function(p){return arguments.length?(w=+p,x):w},x},e.forceCollide=function(g){var m,y,w,x=1,p=1;function A(){for(var k,S,N,I,O,z,b,F=m.length,E=0;E<p;++E)for(S=n.quadtree(m,s,u).visitAfter(_),k=0;k<F;++k)N=m[k],z=y[N.index],b=z*z,I=N.x+N.vx,O=N.y+N.vy,S.visit(R);function R(B,T,M,P,D){var L=B.data,U=B.r,Q=z+U;if(!L)return T>I+Q||P<I-Q||M>O+Q||D<O-Q;if(L.index>N.index){var G=I-L.x-L.vx,V=O-L.y-L.vy,W=G*G+V*V;W<Q*Q&&(G===0&&(W+=(G=o(w))*G),V===0&&(W+=(V=o(w))*V),W=(Q-(W=Math.sqrt(W)))/W*x,N.vx+=(G*=W)*(Q=(U*=U)/(b+U)),N.vy+=(V*=W)*Q,L.vx-=G*(Q=1-Q),L.vy-=V*Q)}}}function _(k){if(k.data)return k.r=y[k.data.index];for(var S=k.r=0;S<4;++S)k[S]&&k[S].r>k.r&&(k.r=k[S].r)}function C(){if(m){var k,S,N=m.length;for(y=new Array(N),k=0;k<N;++k)S=m[k],y[S.index]=+g(S,k,m)}}return typeof g!="function"&&(g=a(g==null?1:+g)),A.initialize=function(k,S){m=k,w=S,C()},A.iterations=function(k){return arguments.length?(p=+k,A):p},A.strength=function(k){return arguments.length?(x=+k,A):x},A.radius=function(k){return arguments.length?(g=typeof k=="function"?k:a(+k),C(),A):g},A},e.forceLink=function(g){var m,y,w,x,p,A,_=f,C=function(b){return 1/Math.min(x[b.source.index],x[b.target.index])},k=a(30),S=1;function N(b){for(var F=0,E=g.length;F<S;++F)for(var R,B,T,M,P,D,L,U=0;U<E;++U)B=(R=g[U]).source,M=(T=R.target).x+T.vx-B.x-B.vx||o(A),P=T.y+T.vy-B.y-B.vy||o(A),M*=D=((D=Math.sqrt(M*M+P*P))-y[U])/D*b*m[U],P*=D,T.vx-=M*(L=p[U]),T.vy-=P*L,B.vx+=M*(L=1-L),B.vy+=P*L}function I(){if(w){var b,F,E=w.length,R=g.length,B=new Map(w.map((T,M)=>[_(T,M,w),T]));for(b=0,x=new Array(E);b<R;++b)(F=g[b]).index=b,typeof F.source!="object"&&(F.source=l(B,F.source)),typeof F.target!="object"&&(F.target=l(B,F.target)),x[F.source.index]=(x[F.source.index]||0)+1,x[F.target.index]=(x[F.target.index]||0)+1;for(b=0,p=new Array(R);b<R;++b)F=g[b],p[b]=x[F.source.index]/(x[F.source.index]+x[F.target.index]);m=new Array(R),O(),y=new Array(R),z()}}function O(){if(w)for(var b=0,F=g.length;b<F;++b)m[b]=+C(g[b],b,g)}function z(){if(w)for(var b=0,F=g.length;b<F;++b)y[b]=+k(g[b],b,g)}return g==null&&(g=[]),N.initialize=function(b,F){w=b,A=F,I()},N.links=function(b){return arguments.length?(g=b,I(),N):g},N.id=function(b){return arguments.length?(_=b,N):_},N.iterations=function(b){return arguments.length?(S=+b,N):S},N.strength=function(b){return arguments.length?(C=typeof b=="function"?b:a(+b),O(),N):C},N.distance=function(b){return arguments.length?(k=typeof b=="function"?b:a(+b),z(),N):k},N},e.forceManyBody=function(){var g,m,y,w,x,p=a(-30),A=1,_=1/0,C=.81;function k(O){var z,b=g.length,F=n.quadtree(g,c,d).visitAfter(N);for(w=O,z=0;z<b;++z)m=g[z],F.visit(I)}function S(){if(g){var O,z,b=g.length;for(x=new Array(b),O=0;O<b;++O)z=g[O],x[z.index]=+p(z,O,g)}}function N(O){var z,b,F,E,R,B=0,T=0;if(O.length){for(F=E=R=0;R<4;++R)(z=O[R])&&(b=Math.abs(z.value))&&(B+=z.value,T+=b,F+=b*z.x,E+=b*z.y);O.x=F/T,O.y=E/T}else{(z=O).x=z.data.x,z.y=z.data.y;do B+=x[z.data.index];while(z=z.next)}O.value=B}function I(O,z,b,F){if(!O.value)return!0;var E=O.x-m.x,R=O.y-m.y,B=F-z,T=E*E+R*R;if(B*B/C<T)return T<_&&(E===0&&(T+=(E=o(y))*E),R===0&&(T+=(R=o(y))*R),T<A&&(T=Math.sqrt(A*T)),m.vx+=E*O.value*w/T,m.vy+=R*O.value*w/T),!0;if(!(O.length||T>=_)){(O.data!==m||O.next)&&(E===0&&(T+=(E=o(y))*E),R===0&&(T+=(R=o(y))*R),T<A&&(T=Math.sqrt(A*T)));do O.data!==m&&(B=x[O.data.index]*w/T,m.vx+=E*B,m.vy+=R*B);while(O=O.next)}}return k.initialize=function(O,z){g=O,y=z,S()},k.strength=function(O){return arguments.length?(p=typeof O=="function"?O:a(+O),S(),k):p},k.distanceMin=function(O){return arguments.length?(A=O*O,k):Math.sqrt(A)},k.distanceMax=function(O){return arguments.length?(_=O*O,k):Math.sqrt(_)},k.theta=function(O){return arguments.length?(C=O*O,k):Math.sqrt(C)},k},e.forceRadial=function(g,m,y){var w,x,p,A=a(.1);function _(k){for(var S=0,N=w.length;S<N;++S){var I=w[S],O=I.x-m||1e-6,z=I.y-y||1e-6,b=Math.sqrt(O*O+z*z),F=(p[S]-b)*x[S]*k/b;I.vx+=O*F,I.vy+=z*F}}function C(){if(w){var k,S=w.length;for(x=new Array(S),p=new Array(S),k=0;k<S;++k)p[k]=+g(w[k],k,w),x[k]=isNaN(p[k])?0:+A(w[k],k,w)}}return typeof g!="function"&&(g=a(+g)),m==null&&(m=0),y==null&&(y=0),_.initialize=function(k){w=k,C()},_.strength=function(k){return arguments.length?(A=typeof k=="function"?k:a(+k),C(),_):A},_.radius=function(k){return arguments.length?(g=typeof k=="function"?k:a(+k),C(),_):g},_.x=function(k){return arguments.length?(m=+k,_):m},_.y=function(k){return arguments.length?(y=+k,_):y},_},e.forceSimulation=function(g){var m,y=1,w=.001,x=1-Math.pow(w,1/300),p=0,A=.6,_=new Map,C=i.timer(N),k=r.dispatch("tick","end"),S=function(){let b=1;return()=>(b=(1664525*b+1013904223)%h)/h}();function N(){I(),k.call("tick",m),y<w&&(C.stop(),k.call("end",m))}function I(b){var F,E,R=g.length;b===void 0&&(b=1);for(var B=0;B<b;++B)for(y+=(p-y)*x,_.forEach(function(T){T(y)}),F=0;F<R;++F)(E=g[F]).fx==null?E.x+=E.vx*=A:(E.x=E.fx,E.vx=0),E.fy==null?E.y+=E.vy*=A:(E.y=E.fy,E.vy=0);return m}function O(){for(var b,F=0,E=g.length;F<E;++F){if((b=g[F]).index=F,b.fx!=null&&(b.x=b.fx),b.fy!=null&&(b.y=b.fy),isNaN(b.x)||isNaN(b.y)){var R=10*Math.sqrt(.5+F),B=F*v;b.x=R*Math.cos(B),b.y=R*Math.sin(B)}(isNaN(b.vx)||isNaN(b.vy))&&(b.vx=b.vy=0)}}function z(b){return b.initialize&&b.initialize(g,S),b}return g==null&&(g=[]),O(),m={tick:I,restart:function(){return C.restart(N),m},stop:function(){return C.stop(),m},nodes:function(b){return arguments.length?(g=b,O(),_.forEach(z),m):g},alpha:function(b){return arguments.length?(y=+b,m):y},alphaMin:function(b){return arguments.length?(w=+b,m):w},alphaDecay:function(b){return arguments.length?(x=+b,m):+x},alphaTarget:function(b){return arguments.length?(p=+b,m):p},velocityDecay:function(b){return arguments.length?(A=1-b,m):1-A},randomSource:function(b){return arguments.length?(S=b,_.forEach(z),m):S},force:function(b,F){return arguments.length>1?(F==null?_.delete(b):_.set(b,z(F)),m):_.get(b)},find:function(b,F,E){var R,B,T,M,P,D=0,L=g.length;for(E==null?E=1/0:E*=E,D=0;D<L;++D)(T=(R=b-(M=g[D]).x)*R+(B=F-M.y)*B)<E&&(P=M,E=T);return P},on:function(b,F){return arguments.length>1?(k.on(b,F),m):k.on(b)}}},e.forceX=function(g){var m,y,w,x=a(.1);function p(_){for(var C,k=0,S=m.length;k<S;++k)(C=m[k]).vx+=(w[k]-C.x)*y[k]*_}function A(){if(m){var _,C=m.length;for(y=new Array(C),w=new Array(C),_=0;_<C;++_)y[_]=isNaN(w[_]=+g(m[_],_,m))?0:+x(m[_],_,m)}}return typeof g!="function"&&(g=a(g==null?0:+g)),p.initialize=function(_){m=_,A()},p.strength=function(_){return arguments.length?(x=typeof _=="function"?_:a(+_),A(),p):x},p.x=function(_){return arguments.length?(g=typeof _=="function"?_:a(+_),A(),p):g},p},e.forceY=function(g){var m,y,w,x=a(.1);function p(_){for(var C,k=0,S=m.length;k<S;++k)(C=m[k]).vy+=(w[k]-C.y)*y[k]*_}function A(){if(m){var _,C=m.length;for(y=new Array(C),w=new Array(C),_=0;_<C;++_)y[_]=isNaN(w[_]=+g(m[_],_,m))?0:+x(m[_],_,m)}}return typeof g!="function"&&(g=a(g==null?0:+g)),p.initialize=function(_){m=_,A()},p.strength=function(_){return arguments.length?(x=typeof _=="function"?_:a(+_),A(),p):x},p.y=function(_){return arguments.length?(g=typeof _=="function"?_:a(+_),A(),p):g},p},Object.defineProperty(e,"__esModule",{value:!0})}),function(e,n){typeof H=="object"&&typeof module<"u"?n(H):typeof define=="function"&&define.amd?define(["exports"],n):n((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{})}(this,function(e){function n(f,l,h){if(isNaN(l))return f;var c,d,v,g,m,y,w=f._root,x={data:h},p=f._x0,A=f._x1;if(!w)return f._root=x,f;for(;w.length;)if((g=l>=(d=(p+A)/2))?p=d:A=d,c=w,!(w=w[m=+g]))return c[m]=x,f;if(l===(v=+f._x.call(null,w.data)))return x.next=w,c?c[m]=x:f._root=x,f;do c=c?c[m]=new Array(2):f._root=new Array(2),(g=l>=(d=(p+A)/2))?p=d:A=d;while((m=+g)==(y=+(v>=d)));return c[y]=w,c[m]=x,f}function r(f,l,h){this.node=f,this.x0=l,this.x1=h}function i(f){return f[0]}function a(f,l){var h=new o(l??i,NaN,NaN);return f==null?h:h.addAll(f)}function o(f,l,h){this._x=f,this._x0=l,this._x1=h,this._root=void 0}function s(f){for(var l={data:f.data},h=l;f=f.next;)h=h.next={data:f.data};return l}var u=a.prototype=o.prototype;u.copy=function(){var f,l,h=new o(this._x,this._x0,this._x1),c=this._root;if(!c)return h;if(!c.length)return h._root=s(c),h;for(f=[{source:c,target:h._root=new Array(2)}];c=f.pop();)for(var d=0;d<2;++d)(l=c.source[d])&&(l.length?f.push({source:l,target:c.target[d]=new Array(2)}):c.target[d]=s(l));return h},u.add=function(f){var l=+this._x.call(null,f);return n(this.cover(l),l,f)},u.addAll=function(f){var l,h,c=f.length,d=new Array(c),v=1/0,g=-1/0;for(l=0;l<c;++l)isNaN(h=+this._x.call(null,f[l]))||(d[l]=h,h<v&&(v=h),h>g&&(g=h));if(v>g)return this;for(this.cover(v).cover(g),l=0;l<c;++l)n(this,d[l],f[l]);return this},u.cover=function(f){if(isNaN(f=+f))return this;var l=this._x0,h=this._x1;if(isNaN(l))h=(l=Math.floor(f))+1;else{for(var c,d,v=h-l||1,g=this._root;l>f||f>=h;)switch(d=+(f<l),(c=new Array(2))[d]=g,g=c,v*=2,d){case 0:h=l+v;break;case 1:l=h-v}this._root&&this._root.length&&(this._root=g)}return this._x0=l,this._x1=h,this},u.data=function(){var f=[];return this.visit(function(l){if(!l.length)do f.push(l.data);while(l=l.next)}),f},u.extent=function(f){return arguments.length?this.cover(+f[0][0]).cover(+f[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]},u.find=function(f,l){var h,c,d,v,g,m=this._x0,y=this._x1,w=[],x=this._root;for(x&&w.push(new r(x,m,y)),l==null?l=1/0:(m=f-l,y=f+l);v=w.pop();)if(!(!(x=v.node)||(c=v.x0)>y||(d=v.x1)<m))if(x.length){var p=(c+d)/2;w.push(new r(x[1],p,d),new r(x[0],c,p)),(g=+(f>=p))&&(v=w[w.length-1],w[w.length-1]=w[w.length-1-g],w[w.length-1-g]=v)}else{var A=Math.abs(f-+this._x.call(null,x.data));A<l&&(l=A,m=f-A,y=f+A,h=x.data)}return h},u.remove=function(f){if(isNaN(v=+this._x.call(null,f)))return this;var l,h,c,d,v,g,m,y,w,x=this._root,p=this._x0,A=this._x1;if(!x)return this;if(x.length)for(;;){if((m=v>=(g=(p+A)/2))?p=g:A=g,l=x,!(x=x[y=+m]))return this;if(!x.length)break;l[y+1&1]&&(h=l,w=y)}for(;x.data!==f;)if(c=x,!(x=x.next))return this;return(d=x.next)&&delete x.next,c?(d?c.next=d:delete c.next,this):l?(d?l[y]=d:delete l[y],(x=l[0]||l[1])&&x===(l[1]||l[0])&&!x.length&&(h?h[w]=x:this._root=x),this):(this._root=d,this)},u.removeAll=function(f){for(var l=0,h=f.length;l<h;++l)this.remove(f[l]);return this},u.root=function(){return this._root},u.size=function(){var f=0;return this.visit(function(l){if(!l.length)do++f;while(l=l.next)}),f},u.visit=function(f){var l,h,c,d,v=[],g=this._root;for(g&&v.push(new r(g,this._x0,this._x1));l=v.pop();)if(!f(g=l.node,c=l.x0,d=l.x1)&&g.length){var m=(c+d)/2;(h=g[1])&&v.push(new r(h,m,d)),(h=g[0])&&v.push(new r(h,c,m))}return this},u.visitAfter=function(f){var l,h=[],c=[];for(this._root&&h.push(new r(this._root,this._x0,this._x1));l=h.pop();){var d=l.node;if(d.length){var v,g=l.x0,m=l.x1,y=(g+m)/2;(v=d[0])&&h.push(new r(v,g,y)),(v=d[1])&&h.push(new r(v,y,m))}c.push(l)}for(;l=c.pop();)f(l.node,l.x0,l.x1);return this},u.x=function(f){return arguments.length?(this._x=f,this):this._x},e.binarytree=a,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,n){typeof H=="object"&&typeof module<"u"?n(H):typeof define=="function"&&define.amd?define(["exports"],n):n((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{})}(this,function(e){function n(h,c,d,v,g){if(isNaN(c)||isNaN(d)||isNaN(v))return h;var m,y,w,x,p,A,_,C,k,S,N,I,O=h._root,z={data:g},b=h._x0,F=h._y0,E=h._z0,R=h._x1,B=h._y1,T=h._z1;if(!O)return h._root=z,h;for(;O.length;)if((C=c>=(y=(b+R)/2))?b=y:R=y,(k=d>=(w=(F+B)/2))?F=w:B=w,(S=v>=(x=(E+T)/2))?E=x:T=x,m=O,!(O=O[N=S<<2|k<<1|C]))return m[N]=z,h;if(p=+h._x.call(null,O.data),A=+h._y.call(null,O.data),_=+h._z.call(null,O.data),c===p&&d===A&&v===_)return z.next=O,m?m[N]=z:h._root=z,h;do m=m?m[N]=new Array(8):h._root=new Array(8),(C=c>=(y=(b+R)/2))?b=y:R=y,(k=d>=(w=(F+B)/2))?F=w:B=w,(S=v>=(x=(E+T)/2))?E=x:T=x;while((N=S<<2|k<<1|C)==(I=(_>=x)<<2|(A>=w)<<1|p>=y));return m[I]=O,m[N]=z,h}function r(h,c,d,v,g,m,y){this.node=h,this.x0=c,this.y0=d,this.z0=v,this.x1=g,this.y1=m,this.z1=y}function i(h){return h[0]}function a(h){return h[1]}function o(h){return h[2]}function s(h,c,d,v){var g=new u(c??i,d??a,v??o,NaN,NaN,NaN,NaN,NaN,NaN);return h==null?g:g.addAll(h)}function u(h,c,d,v,g,m,y,w,x){this._x=h,this._y=c,this._z=d,this._x0=v,this._y0=g,this._z0=m,this._x1=y,this._y1=w,this._z1=x,this._root=void 0}function f(h){for(var c={data:h.data},d=c;h=h.next;)d=d.next={data:h.data};return c}var l=s.prototype=u.prototype;l.copy=function(){var h,c,d=new u(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),v=this._root;if(!v)return d;if(!v.length)return d._root=f(v),d;for(h=[{source:v,target:d._root=new Array(8)}];v=h.pop();)for(var g=0;g<8;++g)(c=v.source[g])&&(c.length?h.push({source:c,target:v.target[g]=new Array(8)}):v.target[g]=f(c));return d},l.add=function(h){var c=+this._x.call(null,h),d=+this._y.call(null,h),v=+this._z.call(null,h);return n(this.cover(c,d,v),c,d,v,h)},l.addAll=function(h){var c,d,v,g,m,y=h.length,w=new Array(y),x=new Array(y),p=new Array(y),A=1/0,_=1/0,C=1/0,k=-1/0,S=-1/0,N=-1/0;for(d=0;d<y;++d)isNaN(v=+this._x.call(null,c=h[d]))||isNaN(g=+this._y.call(null,c))||isNaN(m=+this._z.call(null,c))||(w[d]=v,x[d]=g,p[d]=m,v<A&&(A=v),v>k&&(k=v),g<_&&(_=g),g>S&&(S=g),m<C&&(C=m),m>N&&(N=m));if(A>k||_>S||C>N)return this;for(this.cover(A,_,C).cover(k,S,N),d=0;d<y;++d)n(this,w[d],x[d],p[d],h[d]);return this},l.cover=function(h,c,d){if(isNaN(h=+h)||isNaN(c=+c)||isNaN(d=+d))return this;var v=this._x0,g=this._y0,m=this._z0,y=this._x1,w=this._y1,x=this._z1;if(isNaN(v))y=(v=Math.floor(h))+1,w=(g=Math.floor(c))+1,x=(m=Math.floor(d))+1;else{for(var p,A,_=y-v||1,C=this._root;v>h||h>=y||g>c||c>=w||m>d||d>=x;)switch(A=(d<m)<<2|(c<g)<<1|h<v,(p=new Array(8))[A]=C,C=p,_*=2,A){case 0:y=v+_,w=g+_,x=m+_;break;case 1:v=y-_,w=g+_,x=m+_;break;case 2:y=v+_,g=w-_,x=m+_;break;case 3:v=y-_,g=w-_,x=m+_;break;case 4:y=v+_,w=g+_,m=x-_;break;case 5:v=y-_,w=g+_,m=x-_;break;case 6:y=v+_,g=w-_,m=x-_;break;case 7:v=y-_,g=w-_,m=x-_}this._root&&this._root.length&&(this._root=C)}return this._x0=v,this._y0=g,this._z0=m,this._x1=y,this._y1=w,this._z1=x,this},l.data=function(){var h=[];return this.visit(function(c){if(!c.length)do h.push(c.data);while(c=c.next)}),h},l.extent=function(h){return arguments.length?this.cover(+h[0][0],+h[0][1],+h[0][2]).cover(+h[1][0],+h[1][1],+h[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},l.find=function(h,c,d,v){var g,m,y,w,x,p,A,_,C,k=this._x0,S=this._y0,N=this._z0,I=this._x1,O=this._y1,z=this._z1,b=[],F=this._root;for(F&&b.push(new r(F,k,S,N,I,O,z)),v==null?v=1/0:(k=h-v,S=c-v,N=d-v,I=h+v,O=c+v,z=d+v,v*=v);_=b.pop();)if(!(!(F=_.node)||(m=_.x0)>I||(y=_.y0)>O||(w=_.z0)>z||(x=_.x1)<k||(p=_.y1)<S||(A=_.z1)<N))if(F.length){var E=(m+x)/2,R=(y+p)/2,B=(w+A)/2;b.push(new r(F[7],E,R,B,x,p,A),new r(F[6],m,R,B,E,p,A),new r(F[5],E,y,B,x,R,A),new r(F[4],m,y,B,E,R,A),new r(F[3],E,R,w,x,p,B),new r(F[2],m,R,w,E,p,B),new r(F[1],E,y,w,x,R,B),new r(F[0],m,y,w,E,R,B)),(C=(d>=B)<<2|(c>=R)<<1|h>=E)&&(_=b[b.length-1],b[b.length-1]=b[b.length-1-C],b[b.length-1-C]=_)}else{var T=h-+this._x.call(null,F.data),M=c-+this._y.call(null,F.data),P=d-+this._z.call(null,F.data),D=T*T+M*M+P*P;if(D<v){var L=Math.sqrt(v=D);k=h-L,S=c-L,N=d-L,I=h+L,O=c+L,z=d+L,g=F.data}}return g},l.remove=function(h){if(isNaN(m=+this._x.call(null,h))||isNaN(y=+this._y.call(null,h))||isNaN(w=+this._z.call(null,h)))return this;var c,d,v,g,m,y,w,x,p,A,_,C,k,S,N,I=this._root,O=this._x0,z=this._y0,b=this._z0,F=this._x1,E=this._y1,R=this._z1;if(!I)return this;if(I.length)for(;;){if((_=m>=(x=(O+F)/2))?O=x:F=x,(C=y>=(p=(z+E)/2))?z=p:E=p,(k=w>=(A=(b+R)/2))?b=A:R=A,c=I,!(I=I[S=k<<2|C<<1|_]))return this;if(!I.length)break;(c[S+1&7]||c[S+2&7]||c[S+3&7]||c[S+4&7]||c[S+5&7]||c[S+6&7]||c[S+7&7])&&(d=c,N=S)}for(;I.data!==h;)if(v=I,!(I=I.next))return this;return(g=I.next)&&delete I.next,v?(g?v.next=g:delete v.next,this):c?(g?c[S]=g:delete c[S],(I=c[0]||c[1]||c[2]||c[3]||c[4]||c[5]||c[6]||c[7])&&I===(c[7]||c[6]||c[5]||c[4]||c[3]||c[2]||c[1]||c[0])&&!I.length&&(d?d[N]=I:this._root=I),this):(this._root=g,this)},l.removeAll=function(h){for(var c=0,d=h.length;c<d;++c)this.remove(h[c]);return this},l.root=function(){return this._root},l.size=function(){var h=0;return this.visit(function(c){if(!c.length)do++h;while(c=c.next)}),h},l.visit=function(h){var c,d,v,g,m,y,w,x,p=[],A=this._root;for(A&&p.push(new r(A,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));c=p.pop();)if(!h(A=c.node,v=c.x0,g=c.y0,m=c.z0,y=c.x1,w=c.y1,x=c.z1)&&A.length){var _=(v+y)/2,C=(g+w)/2,k=(m+x)/2;(d=A[7])&&p.push(new r(d,_,C,k,y,w,x)),(d=A[6])&&p.push(new r(d,v,C,k,_,w,x)),(d=A[5])&&p.push(new r(d,_,g,k,y,C,x)),(d=A[4])&&p.push(new r(d,v,g,k,_,C,x)),(d=A[3])&&p.push(new r(d,_,C,m,y,w,k)),(d=A[2])&&p.push(new r(d,v,C,m,_,w,k)),(d=A[1])&&p.push(new r(d,_,g,m,y,C,k)),(d=A[0])&&p.push(new r(d,v,g,m,_,C,k))}return this},l.visitAfter=function(h){var c,d=[],v=[];for(this._root&&d.push(new r(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));c=d.pop();){var g=c.node;if(g.length){var m,y=c.x0,w=c.y0,x=c.z0,p=c.x1,A=c.y1,_=c.z1,C=(y+p)/2,k=(w+A)/2,S=(x+_)/2;(m=g[0])&&d.push(new r(m,y,w,x,C,k,S)),(m=g[1])&&d.push(new r(m,C,w,x,p,k,S)),(m=g[2])&&d.push(new r(m,y,k,x,C,A,S)),(m=g[3])&&d.push(new r(m,C,k,x,p,A,S)),(m=g[4])&&d.push(new r(m,y,w,S,C,k,_)),(m=g[5])&&d.push(new r(m,C,w,S,p,k,_)),(m=g[6])&&d.push(new r(m,y,k,S,C,A,_)),(m=g[7])&&d.push(new r(m,C,k,S,p,A,_))}v.push(c)}for(;c=v.pop();)h(c.node,c.x0,c.y0,c.z0,c.x1,c.y1,c.z1);return this},l.x=function(h){return arguments.length?(this._x=h,this):this._x},l.y=function(h){return arguments.length?(this._y=h,this):this._y},l.z=function(h){return arguments.length?(this._z=h,this):this._z},e.octree=s,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,n){typeof H=="object"&&typeof module<"u"?n(H,t(),t(),t(),t(),t()):typeof define=="function"&&define.amd?define(["exports","d3-binarytree","d3-quadtree","d3-octree","d3-dispatch","d3-timer"],n):n((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{},e.d3,e.d3,e.d3,e.d3,e.d3)}(this,function(e,n,r,i,a,o){function s(p){return function(){return p}}function u(p){return 1e-6*(p()-.5)}function f(p){return p.x+p.vx}function l(p){return p.y+p.vy}function h(p){return p.z+p.vz}function c(p){return p.index}function d(p,A){var _=p.get(A);if(!_)throw new Error("node not found: "+A);return _}const v=4294967296;function g(p){return p.x}function m(p){return p.y}function y(p){return p.z}var w=Math.PI*(3-Math.sqrt(5)),x=20*Math.PI/(9+Math.sqrt(221));e.forceCenter=function(p,A,_){var C,k=1;function S(){var N,I,O=C.length,z=0,b=0,F=0;for(N=0;N<O;++N)z+=(I=C[N]).x||0,b+=I.y||0,F+=I.z||0;for(z=(z/O-p)*k,b=(b/O-A)*k,F=(F/O-_)*k,N=0;N<O;++N)I=C[N],z&&(I.x-=z),b&&(I.y-=b),F&&(I.z-=F)}return p==null&&(p=0),A==null&&(A=0),_==null&&(_=0),S.initialize=function(N){C=N},S.x=function(N){return arguments.length?(p=+N,S):p},S.y=function(N){return arguments.length?(A=+N,S):A},S.z=function(N){return arguments.length?(_=+N,S):_},S.strength=function(N){return arguments.length?(k=+N,S):k},S},e.forceCollide=function(p){var A,_,C,k,S=1,N=1;function I(){for(var b,F,E,R,B,T,M,P,D=A.length,L=0;L<N;++L)for(F=(_===1?n.binarytree(A,f):_===2?r.quadtree(A,f,l):_===3?i.octree(A,f,l,h):null).visitAfter(O),b=0;b<D;++b)E=A[b],M=C[E.index],P=M*M,R=E.x+E.vx,_>1&&(B=E.y+E.vy),_>2&&(T=E.z+E.vz),F.visit(U);function U(Q,G,V,W,j,oe,K){var ne=[G,V,W,j,oe,K],hn=ne[0],Xl=ne[1],jl=ne[2],$l=ne[_],Zl=ne[_+1],Kl=ne[_+2],re=Q.data,Rt=Q.r,q=M+Rt;if(!re)return hn>R+q||$l<R-q||_>1&&(Xl>B+q||Zl<B-q)||_>2&&(jl>T+q||Kl<T-q);if(re.index>E.index){var we=R-re.x-re.vx,Ee=_>1?B-re.y-re.vy:0,ke=_>2?T-re.z-re.vz:0,ie=we*we+Ee*Ee+ke*ke;ie<q*q&&(we===0&&(ie+=(we=u(k))*we),_>1&&Ee===0&&(ie+=(Ee=u(k))*Ee),_>2&&ke===0&&(ie+=(ke=u(k))*ke),ie=(q-(ie=Math.sqrt(ie)))/ie*S,E.vx+=(we*=ie)*(q=(Rt*=Rt)/(P+Rt)),_>1&&(E.vy+=(Ee*=ie)*q),_>2&&(E.vz+=(ke*=ie)*q),re.vx-=we*(q=1-q),_>1&&(re.vy-=Ee*q),_>2&&(re.vz-=ke*q))}}}function O(b){if(b.data)return b.r=C[b.data.index];for(var F=b.r=0;F<Math.pow(2,_);++F)b[F]&&b[F].r>b.r&&(b.r=b[F].r)}function z(){if(A){var b,F,E=A.length;for(C=new Array(E),b=0;b<E;++b)F=A[b],C[F.index]=+p(F,b,A)}}return typeof p!="function"&&(p=s(p==null?1:+p)),I.initialize=function(b,...F){A=b,k=F.find(E=>typeof E=="function")||Math.random,_=F.find(E=>[1,2,3].includes(E))||2,z()},I.iterations=function(b){return arguments.length?(N=+b,I):N},I.strength=function(b){return arguments.length?(S=+b,I):S},I.radius=function(b){return arguments.length?(p=typeof b=="function"?b:s(+b),z(),I):p},I},e.forceLink=function(p){var A,_,C,k,S,N,I,O=c,z=function(M){return 1/Math.min(S[M.source.index],S[M.target.index])},b=s(30),F=1;function E(M){for(var P=0,D=p.length;P<F;++P)for(var L,U,Q,G,V,W=0,j=0,oe=0,K=0;W<D;++W)U=(L=p[W]).source,j=(Q=L.target).x+Q.vx-U.x-U.vx||u(I),k>1&&(oe=Q.y+Q.vy-U.y-U.vy||u(I)),k>2&&(K=Q.z+Q.vz-U.z-U.vz||u(I)),j*=G=((G=Math.sqrt(j*j+oe*oe+K*K))-_[W])/G*M*A[W],oe*=G,K*=G,Q.vx-=j*(V=N[W]),k>1&&(Q.vy-=oe*V),k>2&&(Q.vz-=K*V),U.vx+=j*(V=1-V),k>1&&(U.vy+=oe*V),k>2&&(U.vz+=K*V)}function R(){if(C){var M,P,D=C.length,L=p.length,U=new Map(C.map((Q,G)=>[O(Q,G,C),Q]));for(M=0,S=new Array(D);M<L;++M)(P=p[M]).index=M,typeof P.source!="object"&&(P.source=d(U,P.source)),typeof P.target!="object"&&(P.target=d(U,P.target)),S[P.source.index]=(S[P.source.index]||0)+1,S[P.target.index]=(S[P.target.index]||0)+1;for(M=0,N=new Array(L);M<L;++M)P=p[M],N[M]=S[P.source.index]/(S[P.source.index]+S[P.target.index]);A=new Array(L),B(),_=new Array(L),T()}}function B(){if(C)for(var M=0,P=p.length;M<P;++M)A[M]=+z(p[M],M,p)}function T(){if(C)for(var M=0,P=p.length;M<P;++M)_[M]=+b(p[M],M,p)}return p==null&&(p=[]),E.initialize=function(M,...P){C=M,I=P.find(D=>typeof D=="function")||Math.random,k=P.find(D=>[1,2,3].includes(D))||2,R()},E.links=function(M){return arguments.length?(p=M,R(),E):p},E.id=function(M){return arguments.length?(O=M,E):O},E.iterations=function(M){return arguments.length?(F=+M,E):F},E.strength=function(M){return arguments.length?(z=typeof M=="function"?M:s(+M),B(),E):z},E.distance=function(M){return arguments.length?(b=typeof M=="function"?M:s(+M),T(),E):b},E},e.forceManyBody=function(){var p,A,_,C,k,S,N=s(-30),I=1,O=1/0,z=.81;function b(B){var T,M=p.length,P=(A===1?n.binarytree(p,g):A===2?r.quadtree(p,g,m):A===3?i.octree(p,g,m,y):null).visitAfter(E);for(k=B,T=0;T<M;++T)_=p[T],P.visit(R)}function F(){if(p){var B,T,M=p.length;for(S=new Array(M),B=0;B<M;++B)T=p[B],S[T.index]=+N(T,B,p)}}function E(B){var T,M,P,D,L,U,Q=0,G=0,V=B.length;if(V){for(P=D=L=U=0;U<V;++U)(T=B[U])&&(M=Math.abs(T.value))&&(Q+=T.value,G+=M,P+=M*(T.x||0),D+=M*(T.y||0),L+=M*(T.z||0));Q*=Math.sqrt(4/V),B.x=P/G,A>1&&(B.y=D/G),A>2&&(B.z=L/G)}else{(T=B).x=T.data.x,A>1&&(T.y=T.data.y),A>2&&(T.z=T.data.z);do Q+=S[T.data.index];while(T=T.next)}B.value=Q}function R(B,T,M,P,D){if(!B.value)return!0;var L=[M,P,D][A-1],U=B.x-_.x,Q=A>1?B.y-_.y:0,G=A>2?B.z-_.z:0,V=L-T,W=U*U+Q*Q+G*G;if(V*V/z<W)return W<O&&(U===0&&(W+=(U=u(C))*U),A>1&&Q===0&&(W+=(Q=u(C))*Q),A>2&&G===0&&(W+=(G=u(C))*G),W<I&&(W=Math.sqrt(I*W)),_.vx+=U*B.value*k/W,A>1&&(_.vy+=Q*B.value*k/W),A>2&&(_.vz+=G*B.value*k/W)),!0;if(!(B.length||W>=O)){(B.data!==_||B.next)&&(U===0&&(W+=(U=u(C))*U),A>1&&Q===0&&(W+=(Q=u(C))*Q),A>2&&G===0&&(W+=(G=u(C))*G),W<I&&(W=Math.sqrt(I*W)));do B.data!==_&&(V=S[B.data.index]*k/W,_.vx+=U*V,A>1&&(_.vy+=Q*V),A>2&&(_.vz+=G*V));while(B=B.next)}}return b.initialize=function(B,...T){p=B,C=T.find(M=>typeof M=="function")||Math.random,A=T.find(M=>[1,2,3].includes(M))||2,F()},b.strength=function(B){return arguments.length?(N=typeof B=="function"?B:s(+B),F(),b):N},b.distanceMin=function(B){return arguments.length?(I=B*B,b):Math.sqrt(I)},b.distanceMax=function(B){return arguments.length?(O=B*B,b):Math.sqrt(O)},b.theta=function(B){return arguments.length?(z=B*B,b):Math.sqrt(z)},b},e.forceRadial=function(p,A,_,C){var k,S,N,I,O=s(.1);function z(F){for(var E=0,R=k.length;E<R;++E){var B=k[E],T=B.x-A||1e-6,M=(B.y||0)-_||1e-6,P=(B.z||0)-C||1e-6,D=Math.sqrt(T*T+M*M+P*P),L=(I[E]-D)*N[E]*F/D;B.vx+=T*L,S>1&&(B.vy+=M*L),S>2&&(B.vz+=P*L)}}function b(){if(k){var F,E=k.length;for(N=new Array(E),I=new Array(E),F=0;F<E;++F)I[F]=+p(k[F],F,k),N[F]=isNaN(I[F])?0:+O(k[F],F,k)}}return typeof p!="function"&&(p=s(+p)),A==null&&(A=0),_==null&&(_=0),C==null&&(C=0),z.initialize=function(F,...E){k=F,S=E.find(R=>[1,2,3].includes(R))||2,b()},z.strength=function(F){return arguments.length?(O=typeof F=="function"?F:s(+F),b(),z):O},z.radius=function(F){return arguments.length?(p=typeof F=="function"?F:s(+F),b(),z):p},z.x=function(F){return arguments.length?(A=+F,z):A},z.y=function(F){return arguments.length?(_=+F,z):_},z.z=function(F){return arguments.length?(C=+F,z):C},z},e.forceSimulation=function(p,A){A=A||2;var _,C=Math.min(3,Math.max(1,Math.round(A))),k=1,S=.001,N=1-Math.pow(S,1/300),I=0,O=.6,z=new Map,b=o.timer(R),F=a.dispatch("tick","end"),E=function(){let P=1;return()=>(P=(1664525*P+1013904223)%v)/v}();function R(){B(),F.call("tick",_),k<S&&(b.stop(),F.call("end",_))}function B(P){var D,L,U=p.length;P===void 0&&(P=1);for(var Q=0;Q<P;++Q)for(k+=(I-k)*N,z.forEach(function(G){G(k)}),D=0;D<U;++D)(L=p[D]).fx==null?L.x+=L.vx*=O:(L.x=L.fx,L.vx=0),C>1&&(L.fy==null?L.y+=L.vy*=O:(L.y=L.fy,L.vy=0)),C>2&&(L.fz==null?L.z+=L.vz*=O:(L.z=L.fz,L.vz=0));return _}function T(){for(var P,D=0,L=p.length;D<L;++D){if((P=p[D]).index=D,P.fx!=null&&(P.x=P.fx),P.fy!=null&&(P.y=P.fy),P.fz!=null&&(P.z=P.fz),isNaN(P.x)||C>1&&isNaN(P.y)||C>2&&isNaN(P.z)){var U=10*(C>2?Math.cbrt(.5+D):C>1?Math.sqrt(.5+D):D),Q=D*w,G=D*x;C===1?P.x=U:C===2?(P.x=U*Math.cos(Q),P.y=U*Math.sin(Q)):(P.x=U*Math.sin(Q)*Math.cos(G),P.y=U*Math.cos(Q),P.z=U*Math.sin(Q)*Math.sin(G))}(isNaN(P.vx)||C>1&&isNaN(P.vy)||C>2&&isNaN(P.vz))&&(P.vx=0,C>1&&(P.vy=0),C>2&&(P.vz=0))}}function M(P){return P.initialize&&P.initialize(p,E,C),P}return p==null&&(p=[]),T(),_={tick:B,restart:function(){return b.restart(R),_},stop:function(){return b.stop(),_},numDimensions:function(P){return arguments.length?(C=Math.min(3,Math.max(1,Math.round(P))),z.forEach(M),_):C},nodes:function(P){return arguments.length?(p=P,T(),z.forEach(M),_):p},alpha:function(P){return arguments.length?(k=+P,_):k},alphaMin:function(P){return arguments.length?(S=+P,_):S},alphaDecay:function(P){return arguments.length?(N=+P,_):+N},alphaTarget:function(P){return arguments.length?(I=+P,_):I},velocityDecay:function(P){return arguments.length?(O=1-P,_):1-O},randomSource:function(P){return arguments.length?(E=P,z.forEach(M),_):E},force:function(P,D){return arguments.length>1?(D==null?z.delete(P):z.set(P,M(D)),_):z.get(P)},find:function(){var P,D,L,U,Q,G,V=Array.prototype.slice.call(arguments),W=V.shift()||0,j=(C>1?V.shift():null)||0,oe=(C>2?V.shift():null)||0,K=V.shift()||1/0,ne=0,hn=p.length;for(K*=K,ne=0;ne<hn;++ne)(U=(P=W-(Q=p[ne]).x)*P+(D=j-(Q.y||0))*D+(L=oe-(Q.z||0))*L)<K&&(G=Q,K=U);return G},on:function(P,D){return arguments.length>1?(F.on(P,D),_):F.on(P)}}},e.forceX=function(p){var A,_,C,k=s(.1);function S(I){for(var O,z=0,b=A.length;z<b;++z)(O=A[z]).vx+=(C[z]-O.x)*_[z]*I}function N(){if(A){var I,O=A.length;for(_=new Array(O),C=new Array(O),I=0;I<O;++I)_[I]=isNaN(C[I]=+p(A[I],I,A))?0:+k(A[I],I,A)}}return typeof p!="function"&&(p=s(p==null?0:+p)),S.initialize=function(I){A=I,N()},S.strength=function(I){return arguments.length?(k=typeof I=="function"?I:s(+I),N(),S):k},S.x=function(I){return arguments.length?(p=typeof I=="function"?I:s(+I),N(),S):p},S},e.forceY=function(p){var A,_,C,k=s(.1);function S(I){for(var O,z=0,b=A.length;z<b;++z)(O=A[z]).vy+=(C[z]-O.y)*_[z]*I}function N(){if(A){var I,O=A.length;for(_=new Array(O),C=new Array(O),I=0;I<O;++I)_[I]=isNaN(C[I]=+p(A[I],I,A))?0:+k(A[I],I,A)}}return typeof p!="function"&&(p=s(p==null?0:+p)),S.initialize=function(I){A=I,N()},S.strength=function(I){return arguments.length?(k=typeof I=="function"?I:s(+I),N(),S):k},S.y=function(I){return arguments.length?(p=typeof I=="function"?I:s(+I),N(),S):p},S},e.forceZ=function(p){var A,_,C,k=s(.1);function S(I){for(var O,z=0,b=A.length;z<b;++z)(O=A[z]).vz+=(C[z]-O.z)*_[z]*I}function N(){if(A){var I,O=A.length;for(_=new Array(O),C=new Array(O),I=0;I<O;++I)_[I]=isNaN(C[I]=+p(A[I],I,A))?0:+k(A[I],I,A)}}return typeof p!="function"&&(p=s(p==null?0:+p)),S.initialize=function(I){A=I,N()},S.strength=function(I){return arguments.length?(k=typeof I=="function"?I:s(+I),N(),S):k},S.z=function(I){return arguments.length?(p=typeof I=="function"?I:s(+I),N(),S):p},S},Object.defineProperty(e,"__esModule",{value:!0})}),this._handleSetAttribute=(e,n)=>{let r=e.split("."),i=this;for(let a=0;a<r.length;a++)i=i?.[r[a]];i?.(n)},self.onmessage=function(e){let n=!1;if(e.data.type=="pause")this.simulation.stop();else if(e.data.type=="resume")this.simulation.restart();else if(e.data.type=="setAttribute")this._handleSetAttribute(e.data.attributeName,e.data.value);else if(e.data.type=="start"){let s=function(){var u,f=.05,l=.025;function h(c){const d=Math.sqrt(u.length)*c*f;for(let v=0,g=u.length,m;v<g;++v){m=u[v];let y=Math.sqrt(m.x*m.x+m.y*m.y+m.z*m.z+l),w=d/y;m.vx-=m.x*w,m.vy-=m.y*w,m.vz-=m.z*w}}return h.initialize=function(c){u=c},h.strength=function(c){return arguments.length?(f=+c,h):f},h.softening=function(c){return arguments.length?(l=+c,h):l},h},r=e.data.positions,i=e.data.edges;e.data.use2D&&(n=!0);let a=[],o=[];for(let u=0;u<r.length/3;u++){let f=r[u*3+0]*10,l=r[u*3+1]*10,h=r[u*3+2]*10,c=0;a.push({x:f,y:l,z:h,vz:c,ID:u})}for(let u=0;u<i.length/2;u++){let f=i[u*2],l=i[u*2+1],h={source:f,target:l};o.push(h)}this.repulsiveforce=d3.forceManyBody(),this.attractiveforce=d3.forceLink(o),this.centralForce=d3.forceCenter(),this.gravityForce=s(),this.simulation=d3.forceSimulation(a).numDimensions(n?2:3).force("charge",this.repulsiveforce).force("link",this.attractiveforce).force("center",centralForce).force("gravity",this.gravityForce).velocityDecay(.05).on("tick",async()=>{for(let u=0;u<a.length;u++){const f=a[u];r[u*3+0]=f.x/10,r[u*3+1]=f.y/10,n?r[u*3+2]=0:r[u*3+2]=f.z/10}self.postMessage({type:"update",positions:r})}).on("end",()=>{self.postMessage({type:"stop"})})}}}.toString(),Io=URL.createObjectURL(new Blob([`(${Co})()`],{type:"text/javascript"}));class Bo{constructor({network:e=null,onUpdate:n=null,onStop:r=null,onStart:i=null,use2D:a=!1}){this._network=e,this._onUpdate=n,this._onStop=r,this._onStart=i,this._use2D=a,this._attributes={charge:.1},this._layoutWorker=null}start(){return this._layoutWorker||(this._layoutWorker=new Worker(Io),this._layoutWorker.onmessage=e=>{e.data.type=="update"?this._onUpdate?.(e.data):e.data.type=="stop"?(this._onStop?.(e.data),this._layoutRunning=!1):e.data.type=="getAttribute"?this._handleReturnAttribute(e.data):console.log("Layout received Unknown msg: ",e)},this._layoutRunning=!0,this._onStart?.(),this._layoutWorker.postMessage({type:"start",positions:this._network.positions,edges:this._network.indexedEdges,use2D:this._use2D})),this}restart(){return this.stop(),this.start(),this}stop(){return this._layoutRunning&&this._onStop?.(),this._layoutWorker?.terminate(),this._layoutRunning=!1,delete this._layoutWorker,this._layoutWorker=null,this}resume(){return this.start(),this._layoutRunning||this._onStart?.(),this._layoutWorker.postMessage({type:"resume"}),this._layoutRunning=!0,this}pause(){return this._layoutWorker.postMessage({type:"pause"}),this._layoutRunning=!1,this._onStop?.(),this}onUpdate(e){return this._onUpdate=e,this}onStop(e){return this._onStop=e,this}onStart(e){return this._onStart=e,this}isRunning(){return this._layoutRunning}cleanup(){this.stop()}_handleGetAttribute(){}setAttribute(e,n){return this._layoutWorker.postMessage({type:"setAttribute",attributeName:e,value:n}),this}groups(e){return this.setAttribute("groups",e)}alpha(e){return this.setAttribute("simulation.alpha",e)}alphaDecay(e){return this.setAttribute("simulation.alphaDecay",e)}alphaTarget(e){return this.setAttribute("simulation.alphaTarget",e)}velocityDecay(e){return this.setAttribute("simulation.velocityDecay",e)}}let ur=`
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
 
uniform float globalSizeScale;
uniform float globalSizeBase;
uniform float globalWidthScale;
uniform float globalWidthBase;

uniform float globalOpacityScale;
uniform float globalOpacityBase;

uniform float scaleWithNodeSize;

attribute vec3 fromVertex;
attribute vec3 toVertex;
attribute vec2 vertexType;
// 0,1:  0.0, 1.0, // source, top
// 0,0:  0.0, 0.0, // source, bottom
// 1,1:  1.0, 1.0, // target, top
// 1,0:  1.0, 0.0, // target, bottom

attribute vec4 fromColor;
attribute vec4 toColor;
attribute float fromSize;
attribute float toSize;
attribute vec4 encodedIndex;

varying vec4 vColor;
varying vec3 vOffset;
varying vec4 vEncodedIndex;

varying vec3 vOffsetFromVertex;
varying vec3 vOffsetToVertex;


//varying float vZComponent;

void main(void){
	vColor = (fromColor)*vertexType.x + (toColor)*(1.0-vertexType.x);
	vColor.w = clamp(globalOpacityBase+globalOpacityScale*vColor.w,0.0,1.0);
	float updatedFromSize = 1.0*globalSizeScale*fromSize+globalSizeBase;
	float updatedToSize = 1.0*globalSizeScale*toSize+globalSizeBase;
	vEncodedIndex = encodedIndex;
	//vZComponent = viewVertex.z;
	
	// TODO Implement: correct version
	// float fromSizeEffect = scaleWithNodeSize*updatedFromSize+1.0-scaleWithNodeSize;
	// float toSizeEffect = scaleWithNodeSize*updatedToSize+1.0-scaleWithNodeSize;
	float fromSizeEffect = updatedFromSize;
	float toSizeEffect = updatedToSize;

    // Compute the normalized direction of the edge from source to target
    vec3 direction = normalize(toVertex - fromVertex);

    // Offset source and target positions
    vec3 offsetFromVertex = fromVertex + direction * updatedFromSize;
    vec3 offsetToVertex = toVertex - direction * updatedToSize;

    // Adjust the vertex center based on the updated source and target positions
    vec3 vertexCenter = offsetFromVertex * vertexType.x + offsetToVertex * (1.0 - vertexType.x);

	// vec3 vertexCenter = fromVertex.xyz*vertexType.x + toVertex.xyz*(1.0-vertexType.x);
    vec4 clipFrom = projectionMatrix * viewMatrix * vec4(fromVertex, 1.0);
    vec4 clipTo = projectionMatrix * viewMatrix * vec4(toVertex, 1.0);
    
    vec3 clipDisplacement = (clipTo.xyz / clipTo.w - clipFrom.xyz / clipFrom.w);
    vec3 perpendicularVector = normalize(vec3(-clipDisplacement.y, clipDisplacement.x, 0.0));
    
    float width = globalWidthBase + globalWidthScale * ((fromSizeEffect) * vertexType.x + (toSizeEffect) * (1.0 - vertexType.x));
    
    vec3 offset = width * (vertexType.y - 0.5) * 2.0 * 1.5 * perpendicularVector;
    
    vec4 viewVertex = viewMatrix * vec4(vertexCenter, 1.0);
    vec4 offsetVertex = viewVertex + vec4(offset, 0.0);
    
    vec4 finalPos = projectionMatrix * offsetVertex;
    gl_Position = finalPos;
	
}
`,fr=`
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
 
uniform float globalSizeScale;
uniform float globalSizeBase;
uniform float globalWidthScale;
uniform float globalWidthBase;

uniform float globalOpacityScale;
uniform float globalOpacityBase;

attribute vec3 fromVertex;
attribute vec3 toVertex;
attribute vec2 vertexType;
// 0,1:  0.0, 1.0, // source, top
// 0,0:  0.0, 0.0, // source, bottom
// 1,1:  1.0, 1.0, // target, top
// 1,0:  1.0, 0.0, // target, bottom

attribute vec4 fromColor;
attribute vec4 toColor;
attribute float fromSize;
attribute float toSize;
attribute vec4 encodedIndex;

varying vec4 vColor;
varying vec3 vOffset;
varying vec4 vEncodedIndex;


vec2 hyperbolicNormFactor(vec2 vertex, float scaling){
	vec2 pos = vertex.xy;
	float r = length(pos.xy);
	// //polar
	// vec2 normFactor = (r+scaling)*vec2(1.0,1.0);
	// catersian
	vec2 normFactor = sqrt(vertex.xy*vertex.xy+scaling*scaling);
	return normFactor;
}

//varying float vZComponent;

void main(void){
	vColor = (fromColor)*vertexType.x + (toColor)*(1.0-vertexType.x);
	vColor.w = clamp(globalOpacityBase+globalOpacityScale*vColor.w,0.0,1.0);
	float updatedFromSize = globalSizeScale*fromSize+globalSizeBase;
	float updatedToSize = globalSizeScale*toSize+globalSizeBase;

	float width = globalWidthBase+globalWidthScale*((updatedFromSize)*vertexType.x + (updatedToSize)*(1.0-vertexType.x));
	vEncodedIndex = encodedIndex;
	//vZComponent = viewVertex.z;

	float scaling = -viewMatrix[3][2];
	
	vec4 fromVertexView = viewMatrix * vec4(fromVertex.xyz,1.0);
	vec4 toVertexView = viewMatrix * vec4(toVertex.xyz,1.0);

	vec2 normFactorFrom = hyperbolicNormFactor(fromVertexView.xy, scaling);
	vec2 normFactorTo = hyperbolicNormFactor(toVertexView.xy, scaling);
	
	vec3 vertexCenter = fromVertexView.xyz*vertexType.x + toVertexView.xyz*(1.0-vertexType.x);
	vec3 destinationVertexCenter = fromVertexView.xyz*(1.0-vertexType.x) + toVertexView.xyz*vertexType.x;

	vec2 normFactorCenter = hyperbolicNormFactor(vertexCenter.xy, scaling);
	vec2 normFactorDestinationCenter = hyperbolicNormFactor(destinationVertexCenter.xy, scaling);

	fromVertexView.xy = fromVertexView.xy/normFactorFrom/vec2(projectionMatrix[0][0],projectionMatrix[1][1]);
	toVertexView.xy = toVertexView.xy/normFactorTo/vec2(projectionMatrix[0][0],projectionMatrix[1][1]);
	vertexCenter.xy = vertexCenter.xy/normFactorCenter/vec2(projectionMatrix[0][0],projectionMatrix[1][1]);
	destinationVertexCenter.xy = destinationVertexCenter.xy/normFactorDestinationCenter/vec2(projectionMatrix[0][0],projectionMatrix[1][1]);

	vec3 displacement = vec4((destinationVertexCenter-vertexCenter),0.0).xyz;
	vec3 perpendicularVector = normalize(vec3(-displacement.y, displacement.x, 0.0));
	vec3 offset = width*(vertexType.x-0.5)*(vertexType.y-0.5)*4.0*1.0*perpendicularVector/length(normFactorCenter)*scaling;
	
	vec4 viewVertex = vec4(vertexCenter.xyz,1.0)+vec4(offset,0.0);
	float displacementLength = length(displacement);
	// vOffset = vec3(vertexType.x,updatedToSize/displacementLength*1.0,updatedFromSize/displacementLength*1.0);
	vOffset = vec3(0.0,0.0,0.0);
	viewVertex.zw = vec2(0.0,1.0);
	vec4 temp_pos = projectionMatrix*viewVertex;
	gl_Position = temp_pos;
}
`,Fo=`
#ifdef GL_ES
	precision highp float;
#endif
//uniform vec2 nearFar;
varying vec4 vEncodedIndex;
varying vec4 vColor;
varying vec3 vOffset;
//varying float vZComponent;
//gl_DepthRange.near)/gl_DepthRange.diff
void main(){
	//float w = (-vZComponent-nearFar[0])/(nearFar[1]-nearFar[0]);
	// if(vOffset.x<vOffset.y || vOffset.x>(1.0-vOffset.z)){
	// 	discard;
	// }

	// gl_FragColor = vec4(vOffset.x,vOffset.x,0,1.0);//vec4(vColor.xyz,globalOpacity*vColor.w);
	gl_FragColor = vColor;
}
`,So=`
#ifdef GL_ES
	precision highp float;
#endif
//uniform vec2 nearFar;
varying vec4 vEncodedIndex;
varying vec4 vColor;
varying vec3 vOffset;
//varying float vZComponent;
//gl_DepthRange.near)/gl_DepthRange.diff
void main(){

	if(vOffset.x<vOffset.y*1.1 || vOffset.x>(1.0-vOffset.z*1.1) || (vEncodedIndex.x+vEncodedIndex.y+vEncodedIndex.z+vEncodedIndex.w)<=0.0){
		discard;
	}
	//float w = (-vZComponent-nearFar[0])/(nearFar[1]-nearFar[0]);
	gl_FragColor = vEncodedIndex;
	
}
`,Mo=`
uniform mat4 projectionViewMatrix;
uniform float globalOpacityScale;
uniform float globalOpacityBase;

attribute vec3 vertex;
attribute vec4 color;


varying vec4 vColor;
varying vec4 vEncodedIndex;

//varying float vZComponent;

void main(void){
	vColor = color;
	vColor.w = clamp(globalOpacityBase+globalOpacityScale*vColor.w,0.0,1.0);
	//vZComponent = viewVertex.z;
	gl_Position =   projectionViewMatrix * vec4(vertex,1.0);
}
`,Ro=`
uniform mat4 projectionViewMatrix;
uniform float globalOpacityScale;
uniform float globalOpacityBase;

attribute vec3 vertex;
attribute vec4 color;


varying vec4 vColor;
varying vec4 vEncodedIndex;

//varying float vZComponent;

void main(void){
	vColor = color;
	vColor.w = clamp(globalOpacityBase+globalOpacityScale*vColor.w,0.0,1.0);
	//vZComponent = viewVertex.z;

	vec4 temp_pos = projectionViewMatrix * vec4(vertex,1.0);
	vec4 eye_vec = vec4(0.0,0.0,1.0,0);
	float dist = length(eye_vec);
	vec4 lookat = eye_vec - temp_pos;
	vec4 dir = temp_pos - eye_vec;
	vec4 center = normalize(-eye_vec);
	vec4 proj = dot(temp_pos, normalize(-lookat)) * normalize(-lookat);
	vec4 c = temp_pos - proj;
	float magnitude = 1.0-acos(dot(normalize(-eye_vec), normalize(temp_pos)));

	c = length(c) * magnitude * normalize(c);
	vec4 dir2 = normalize(c-lookat);
	temp_pos.xy = (dir2).xy;
	temp_pos.z = 0.0;
	temp_pos.w = 1.0;
	gl_Position = temp_pos;
}
`,To=`
#ifdef GL_ES
	precision highp float;
#endif
//uniform vec2 nearFar;
varying vec4 vColor;
//varying float vZComponent;
//gl_DepthRange.near)/gl_DepthRange.diff
void main(){
	//float w = (-vZComponent-nearFar[0])/(nearFar[1]-nearFar[0]);
	gl_FragColor = vColor;
	// gl_FragColor = vec4(vEncodedIndex.x/10,0,0,1.0);
}

`,en=`
// uniform mat4 projectionMatrix;
// uniform mat4 viewMatrix;
// uniform mat3 normalMatrix;


// attribute vec4 vertex;
// attribute vec3 normal;
// attribute vec3 position;
// attribute vec3 color;
// attribute float size;
// attribute float Opacity;

// varying vec3 vNormal;
// varying vec3 vEye;

// varying vec3 vColor;
// varying float vSize;
// varying float vOpacity;

// void main(void){
// 	vec4 viewVertex = viewMatrix * (vertex*vec4(vec3(size),1.0) + vec4(position,0.0));
// 	vNormal = normalMatrix * normal;
// 	vEye = -vec3(viewVertex);
// 	vOpacity = Opacity;
// 	vColor = color;
// 	gl_Position =   projectionMatrix * viewVertex;
// }

uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;

uniform float globalOpacityScale;
uniform float globalSizeScale;
uniform float globalOutlineWidthScale;

uniform float globalOpacityBase;
uniform float globalSizeBase;
uniform float globalOutlineWidthBase;

attribute vec2 vertex;
// attribute vec3 normal;
attribute vec3 position;
attribute vec4 color;
attribute float size;
attribute float outlineWidth;
attribute vec4 outlineColor;
attribute vec4 encodedIndex;

varying vec3 vNormal;
varying vec3 vEye;
varying vec4 vColor;
varying vec2 vOffset;
varying float vSize;
varying vec4 vEncodedIndex;
varying float vOutlineThreshold;
varying vec4 vOutlineColor;
varying vec4 vPosition;

void main(void){
	float BoxCorrection = 1.5;
	vec2 offset = vertex;
	float updatedSize = globalSizeScale*size+globalSizeBase;
	float updatedOutlineWidth = globalOutlineWidthScale*outlineWidth+globalOutlineWidthBase;
	float fullSize = updatedSize + updatedOutlineWidth;
	// vec4 viewCenters = viewMatrix*vec4(position,1);
	// vec3 viewCenters = position;
	// fragCenter = viewCenters
	// float scalingFactor = 1.0 / abs(centers.x)*0.001;
	// offset*=scalingFactor;
	vec3 cameraRight = normalize(vec3(viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0]));
	vec3 cameraUp = normalize(vec3(viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1]));

	// viewCenters.xy += offset*updatedSize*CameraRight_worldspace;
	
	vec4 viewCenters = viewMatrix*vec4(position+BoxCorrection*fullSize*(cameraRight*offset.x + cameraUp*offset.y),1.0);
	vNormal = vec3(0.0,0.0,1.0); //normalMatrix * normal;
	vEye = -vec3(offset,0.0);
	vEncodedIndex = encodedIndex;
	vColor = color;
	vColor.w = clamp(globalOpacityBase+globalOpacityScale*vColor.w,0.0,1.0);
	vOutlineColor.w = clamp(globalOpacityBase+globalOpacityScale*vOutlineColor.w,0.0,1.0);
	vOffset = vertex;
	vSize = updatedSize;
	vOutlineThreshold = updatedOutlineWidth/fullSize;

	vOutlineColor = outlineColor;
	vPosition = projectionMatrix * viewCenters;

	// vec4 temp_pos = vPosition;
	// vec4 eye_vec = vec4(0.0,0.0,0.0,0);
	// float dist = length(eye_vec);
	// vec4 lookat = eye_vec - temp_pos;
	// vec4 dir = temp_pos - eye_vec;
	// vec4 center = normalize(-eye_vec);
	// vec4 proj = dot(temp_pos, normalize(-lookat)) * normalize(-lookat);
	// vec4 c = temp_pos - proj;
	// float magnitude = 1.0-acos(dot(normalize(-eye_vec), normalize(temp_pos)));

	// c = length(c) * magnitude * normalize(c);
	// vec4 dir2 = normalize(c-lookat);
	// vPosition.xy = (dir2).xy;
	// vPosition.z = 0.0;
	// vPosition.w = 1.0;
	gl_Position = vPosition;
}
`,tn=`
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;

uniform float globalOpacityScale;
uniform float globalSizeScale;
uniform float globalOutlineWidthScale;

uniform float globalOpacityBase;
uniform float globalSizeBase;
uniform float globalOutlineWidthBase;

attribute vec2 vertex;
// attribute vec3 normal;
attribute vec3 position;
attribute vec4 color;
attribute float size;
attribute float outlineWidth;
attribute vec4 outlineColor;
attribute vec4 encodedIndex;

varying vec3 vNormal;
varying vec3 vEye;
varying vec4 vColor;
varying vec2 vOffset;
varying float vSize;
varying vec4 vEncodedIndex;
varying float vOutlineThreshold;
varying vec4 vOutlineColor;
varying vec4 vPosition;

vec2 hyperbolicNormFactor(vec2 vertex, float scaling){
	vec2 pos = vertex.xy;
	float r = length(pos.xy);
	// //polar
	// vec2 normFactor = (r+scaling)*vec2(1.0,1.0);
	// catersian
	vec2 normFactor = sqrt(vertex.xy*vertex.xy+scaling*scaling);
	return normFactor;
}

void main(void){
	float BoxCorrection = 1.5;
	vec2 offset = vertex;
	float updatedSize = globalSizeScale*size+globalSizeBase;
	float updatedOutlineWidth = globalOutlineWidthScale*outlineWidth+globalOutlineWidthBase;
	float fullSize = updatedSize + updatedOutlineWidth;
	// vec4 viewCenters = viewMatrix*vec4(position,1);
	// vec3 viewCenters = position;
	// fragCenter = viewCenters
	// float scalingFactor = 1.0 / abs(centers.x)*0.001;
	// offset*=scalingFactor;
	vec3 cameraRight = normalize(vec3(viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0]));
	vec3 cameraUp = normalize(vec3(viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1]));

	// viewCenters.xy += offset*updatedSize*CameraRight_worldspace;
	


	// temp_pos.z = 0.0;
	// temp_pos.w = 1.0;



	vec4 viewCenters = viewMatrix*vec4(position.xyz,1.0);
	float scaling = -viewMatrix[3][2];
	vec4 temp_pos = viewCenters;
	
	vec2 normFactor = hyperbolicNormFactor(viewCenters.xy, scaling);
	// catersian
	// vec2 normFactor = sqrt(temp_pos.xy*temp_pos.xy+scaling*scaling);
	temp_pos.xy = temp_pos.xy/normFactor;

	viewCenters.xy = temp_pos.xy/vec2(projectionMatrix[0][0],projectionMatrix[1][1]);
	viewCenters.xy+=BoxCorrection*fullSize*offset.xy/length(normFactor)*scaling;
	

	vNormal = vec3(0.0,0.0,1.0); //normalMatrix * normal;
	vEye = -vec3(offset,0.0);
	vEncodedIndex = encodedIndex;
	vColor = color;
	vColor.w = clamp(globalOpacityBase+globalOpacityScale*vColor.w,0.0,1.0);
	vOutlineColor.w = clamp(globalOpacityBase+globalOpacityScale*vOutlineColor.w,0.0,1.0);
	vOffset = vertex;
	vSize = updatedSize;
	vOutlineThreshold = updatedOutlineWidth/fullSize;

	vOutlineColor = outlineColor;
	vPosition = projectionMatrix * viewCenters;

	gl_Position = vPosition;
}
`,No=`// #ifdef GL_ES
// 	precision highp float;
// #endif

precision mediump float;
varying vec4 vColor;
varying vec4 vEncodedIndex;
varying vec3 vNormal;
varying vec3 vEye;
varying float vSize;
varying vec2 vOffset;
varying float vOutlineThreshold;
varying vec4 vOutlineColor;
varying vec4 vPosition;



void main(){
	// const vec3 lightDirection = vec3(0.577350269,0.577350269,0.577350269);
	// const float ambientFactor = 0.6;
	
	// vec3 normal = normalize(vNormal);
	// vec3 eye = normalize(vEye);
	
	// //Ambient+Diffuse
	// float cosTheta = max(dot(lightDirection,normal),0.0);
	// vec3 newColor = vColor*(ambientFactor+cosTheta);
	
	// //Specular
	// vec3 reflection = reflect(-lightDirection, normal);
	// float eyeDotReflection = max(dot(eye, reflection), 0.0);
	// newColor +=  vec3(0.5)* pow(eyeDotReflection, 60.0);
	
	// gl_FragColor = vec4(newColor,vOpacity);
	// gl_FragColor = vec4(eye,Opacity);
	//gl_FragData[0] = vec4(newColor,Opacity);

// Renaming variables passed from the Vertex Shader

	// vec3 cameraPos;
	// vec3 cameraNormal;

	// float lensqr = dot(vOffset, vOffset);

	// if(lensqr > 1.0)
	// 		discard;
		
	// cameraNormal = vec3(vOffset, sqrt(1.0 - lensqr));
	// cameraPos = (cameraNormal * size) + cameraSpherePos;

	// float len = length(point);
	// // VTK Fake Spheres
	// float radius = 1.;
	// if(len > radius)
	// 		discard;
	// vec3 normalizedPoint = normalize(vec3(point.xy, sqrt(1. - len)));
	// vec3 direction = normalize(vec3(1., 1., 1.));
	// float df2 = max(0, dot(direction, normalizedPoint));
	// float sf2 = pow(df2, 90);
	// fragOutput0 = vec4(max((df2+0.3) * color, sf2 * vec3(1)), 1);

	// fragOutput1 = vec4(vertexVC.xyz, 1.0);
	// fragOutput2 = vec4(normalVCVSOutput, 1.0);
	
	float lensqr = dot(vOffset, vOffset);

	if(lensqr > 1.0)
		discard;
	

	vec3 normalizedPoint = normalize(vec3(vOffset.xy, sqrt(1. - lensqr)));
	const vec3 lightDirection = vec3(0.577350269,0.577350269,0.577350269);
	const float ambientFactor = 0.6;
	
	vec3 normal = normalizedPoint;
	vec3 eye = normalize(vEye);
	
	//Ambient+Diffuse
	float cosTheta = max(dot(lightDirection,normal),0.0);
	vec3 newColor = vColor.xyz*(ambientFactor+cosTheta);
	
	//Specular
	vec3 reflection = reflect(-lightDirection, normal);
	float eyeDotReflection = max(dot(eye, reflection), 0.0);
	newColor +=  vec3(0.5)* pow(eyeDotReflection, 60.0);
	
	
	
	if(lensqr < 1.0-vOutlineThreshold){
		// gl_FragColor = vec4(vColor,vOpacity)
		gl_FragColor = vec4(newColor,vColor.w);;
	}else{
		gl_FragColor = vec4(vOutlineColor.xyz,vOutlineColor.w);
	}
	// gl_FragDepthEXT = 0.5; 
}
`,Oo=`
// #ifdef GL_ES
// 	precision highp float;
// #endif

precision mediump float;
varying vec4 vColor;
varying vec4 vEncodedIndex;
varying vec3 vNormal;
varying vec3 vEye;
varying float vSize;
varying vec2 vOffset;
varying float vOutlineThreshold;
varying vec4 vOutlineColor;

void main(){
	float lensqr = dot(vOffset, vOffset);

	if(lensqr > 1.0)
			discard;
	
	gl_FragColor = vEncodedIndex;
}
`,Po=`
// #ifdef GL_ES
// 	precision highp float;
// #endif

precision mediump float;
varying vec4 vColor;
varying vec4 vEncodedIndex;
varying vec3 vNormal;
varying vec3 vEye;
varying float vSize;
varying vec2 vOffset;
varying float vOutlineThreshold;
varying vec4 vOutlineColor;
varying vec4 vPosition;



void main(){
	
	float lensqr = dot(vOffset, vOffset);

	if(lensqr > 1.0)
			discard;
	
	if(lensqr < 1.0-vOutlineThreshold){
		// gl_FragColor = vec4(vColor,vOpacity)
		gl_FragColor = vColor;
	}else{
		gl_FragColor = vOutlineColor;
	}
	// gl_FragDepthEXT = 0.5; 
}
`;var mt={},pt={},We={};Object.defineProperty(We,"__esModule",{value:!0});var zo=function(){function t(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function Do(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var hr=We.LinkedList=function(){function t(){Do(this,t),this.length=0,this.first=null,this.last=null}return zo(t,[{key:"forEach",value:function(n,r){for(var i=this.first,a=this.length,o=0;o<a;o++)n.call(r,i,o),i=i.next}},{key:"at",value:function(n){if(!(n>=0&&n<this.length))return null;for(var r=this.first;n--;)r=r.next;return r}},{key:"randomNode",value:function(){var n=Math.floor(Math.random()*this.length);return this.at(n)}},{key:"toArray",value:function(){for(var n=[],r=this.first,i=this.length;i--;)n.push(r.data||r),r=r.next;return n}}]),t}();hr.prototype.each=hr.prototype.forEach,Object.defineProperty(pt,"__esModule",{value:!0}),pt.CircularLinkedList=void 0;var Lo=function(){function t(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),cr=We;function Uo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qo(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function Go(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var dr=pt.CircularLinkedList=function(t){Go(e,t);function e(){return Uo(this,e),Qo(this,Object.getPrototypeOf(e).apply(this,arguments))}return Lo(e,[{key:"append",value:function(r){this.first===null?(r.prev=r,r.next=r,this.first=r,this.last=r):(r.prev=this.last,r.next=this.first,this.first.prev=r,this.last.next=r,this.last=r),this.length++}},{key:"prepend",value:function(r){if(this.first===null){this.append(r);return}else r.prev=this.last,r.next=this.first,this.first.prev=r,this.last.next=r,this.first=r;this.length++}},{key:"insertAfter",value:function(r,i){i.prev=r,i.next=r.next,r.next.prev=i,r.next=i,i.prev===this.last&&(this.last=i),this.length++}},{key:"insertBefore",value:function(r,i){i.prev=r.prev,i.next=r,r.prev.next=i,r.prev=i,i.next===this.first&&(this.first=i),this.length++}},{key:"remove",value:function(r){this.length>1?(r.prev.next=r.next,r.next.prev=r.prev,r===this.first&&(this.first=r.next),r===this.last&&(this.last=r.prev)):(this.first=null,this.last=null),r.prev=null,r.next=null,this.length--}},{key:"withData",value:function(r){for(var i=this.first,a=this.last,o=Math.ceil(this.length/2);o--;){if(i.data===r)return i;if(a.data===r)return a;i=i.next,a=a.prev}return null}}]),e}(cr.LinkedList);dr.fromArray=function(t,e){for(var n=new dr,r=t.length;r--;)n.prepend(e?new cr.LinkedList.Node(t[r]):t[r]);return n};var He={},he={};Object.defineProperty(he,"__esModule",{value:!0}),he.PRECISION=1e-6;var Ye={},qe={},gr;function Me(){if(gr)return qe;gr=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.Matrix=void 0;var t=function(){function a(o,s){for(var u=0;u<s.length;u++){var f=s[u];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(o,f.key,f)}}return function(o,s,u){return s&&a(o.prototype,s),u&&a(o,u),o}}(),e=he,n=me();function r(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}var i=qe.Matrix=function(){function a(o){r(this,a),this.setElements(o)}return t(a,[{key:"e",value:function(s,u){return s<1||s>this.elements.length||u<1||u>this.elements[0].length?null:this.elements[s-1][u-1]}},{key:"row",value:function(s){return s>this.elements.length?null:new n.Vector(this.elements[s-1])}},{key:"col",value:function(s){if(this.elements.length===0||s>this.elements[0].length)return null;for(var u=[],f=this.elements.length,l=0;l<f;l++)u.push(this.elements[l][s-1]);return new n.Vector(u)}},{key:"dimensions",value:function(){var s=this.elements.length===0?0:this.elements[0].length;return{rows:this.elements.length,cols:s}}},{key:"rows",value:function(){return this.elements.length}},{key:"cols",value:function(){return this.elements.length===0?0:this.elements[0].length}},{key:"eql",value:function(s){var u=s.elements||s;if((!u[0]||typeof u[0][0]>"u")&&(u=new a(u).elements),this.elements.length===0||u.length===0)return this.elements.length===u.length;if(this.elements.length!==u.length||this.elements[0].length!==u[0].length)return!1;for(var f=this.elements.length,l=this.elements[0].length,h;f--;)for(h=l;h--;)if(Math.abs(this.elements[f][h]-u[f][h])>e.PRECISION)return!1;return!0}},{key:"dup",value:function(){return new a(this.elements)}},{key:"map",value:function(s,u){if(this.elements.length===0)return new a([]);for(var f=[],l=this.elements.length,h=this.elements[0].length,c;l--;)for(c=h,f[l]=[];c--;)f[l][c]=s.call(u,this.elements[l][c],l+1,c+1);return new a(f)}},{key:"isSameSizeAs",value:function(s){var u=s.elements||s;return typeof u[0][0]>"u"&&(u=new a(u).elements),this.elements.length===0?u.length===0:this.elements.length===u.length&&this.elements[0].length===u[0].length}},{key:"add",value:function(s){if(this.elements.length===0)return this.map(function(f){return f});var u=s.elements||s;return typeof u[0][0]>"u"&&(u=new a(u).elements),this.isSameSizeAs(u)?this.map(function(f,l,h){return f+u[l-1][h-1]}):null}},{key:"subtract",value:function(s){if(this.elements.length===0)return this.map(function(f){return f});var u=s.elements||s;return typeof u[0][0]>"u"&&(u=new a(u).elements),this.isSameSizeAs(u)?this.map(function(f,l,h){return f-u[l-1][h-1]}):null}},{key:"canMultiplyFromLeft",value:function(s){if(this.elements.length===0)return!1;var u=s.elements||s;return typeof u[0][0]>"u"&&(u=new a(u).elements),this.elements[0].length===u.length}},{key:"multiply",value:function(s){if(this.elements.length===0)return null;if(!s.elements)return this.map(function(y){return y*s});var u=!!s.modulus,m=s.elements||s;if(typeof m[0][0]>"u"&&(m=new a(m).elements),!this.canMultiplyFromLeft(m))return null;for(var f=this.elements.length,l=m[0].length,h,c=this.elements[0].length,d,v=[],g;f--;)for(h=l,v[f]=[];h--;){for(d=c,g=0;d--;)g+=this.elements[f][d]*m[d][h];v[f][h]=g}var m=new a(v);return u?m.col(1):m}},{key:"minor",value:function(s,u,f,l){if(this.elements.length===0)return null;for(var h=[],c=f,d,v,g,m=this.elements.length,y=this.elements[0].length;c--;)for(d=f-c-1,h[d]=[],v=l;v--;)g=l-v-1,h[d][g]=this.elements[(s+d-1)%m][(u+g-1)%y];return new a(h)}},{key:"transpose",value:function(){if(this.elements.length===0)return new a([]);for(var s=this.elements.length,h,u=this.elements[0].length,f,l=[],h=u;h--;)for(f=s,l[h]=[];f--;)l[h][f]=this.elements[f][h];return new a(l)}},{key:"isSquare",value:function(){var s=this.elements.length===0?0:this.elements[0].length;return this.elements.length===s}},{key:"max",value:function(){if(this.elements.length===0)return null;for(var s=0,u=this.elements.length,f=this.elements[0].length,l;u--;)for(l=f;l--;)Math.abs(this.elements[u][l])>Math.abs(s)&&(s=this.elements[u][l]);return s}},{key:"indexOf",value:function(s){if(this.elements.length===0)return null;var u=this.elements.length,f,l=this.elements[0].length,h;for(f=0;f<u;f++)for(h=0;h<l;h++)if(this.elements[f][h]===s)return{i:f+1,j:h+1};return null}},{key:"diagonal",value:function(){if(!this.isSquare)return null;for(var s=[],u=this.elements.length,f=0;f<u;f++)s.push(this.elements[f][f]);return new n.Vector(s)}},{key:"toRightTriangular",value:function(){if(this.elements.length===0)return new a([]);var s=this.dup(),u,f=this.elements.length,l,h,c=this.elements[0].length,d;for(l=0;l<f;l++){if(s.elements[l][l]===0){for(h=l+1;h<f;h++)if(s.elements[h][l]!==0){for(u=[],d=0;d<c;d++)u.push(s.elements[l][d]+s.elements[h][d]);s.elements[l]=u;break}}if(s.elements[l][l]!==0)for(h=l+1;h<f;h++){var v=s.elements[h][l]/s.elements[l][l];for(u=[],d=0;d<c;d++)u.push(d<=l?0:s.elements[h][d]-s.elements[l][d]*v);s.elements[h]=u}}return s}},{key:"determinant",value:function(){if(this.elements.length===0)return 1;if(!this.isSquare())return null;for(var s=this.toRightTriangular(),u=s.elements[0][0],f=s.elements.length,l=1;l<f;l++)u=u*s.elements[l][l];return u}},{key:"isSingular",value:function(){return this.isSquare()&&this.determinant()===0}},{key:"trace",value:function(){if(this.elements.length===0)return 0;if(!this.isSquare())return null;for(var s=this.elements[0][0],u=this.elements.length,f=1;f<u;f++)s+=this.elements[f][f];return s}},{key:"rank",value:function(){if(this.elements.length===0)return 0;for(var s=this.toRightTriangular(),u=0,f=this.elements.length,l=this.elements[0].length,h;f--;)for(h=l;h--;)if(Math.abs(s.elements[f][h])>e.PRECISION){u++;break}return u}},{key:"augment",value:function(s){if(this.elements.length===0)return this.dup();var u=s.elements||s;typeof u[0][0]>"u"&&(u=new a(u).elements);var f=this.dup(),l=f.elements[0].length,h=f.elements.length,c=u[0].length,d;if(h!==u.length)return null;for(;h--;)for(d=c;d--;)f.elements[h][l+d]=u[h][d];return f}},{key:"inverse",value:function(){if(this.elements.length===0||!this.isSquare()||this.isSingular())return null;for(var s=this.elements.length,u=s,f,l=this.augment(a.I(s)).toRightTriangular(),h=l.elements[0].length,c,d,v,g=[],m;u--;){for(d=[],g[u]=[],v=l.elements[u][u],c=0;c<h;c++)m=l.elements[u][c]/v,d.push(m),c>=s&&g[u].push(m);for(l.elements[u]=d,f=u;f--;){for(d=[],c=0;c<h;c++)d.push(l.elements[f][c]-l.elements[u][c]*l.elements[f][u]);l.elements[f]=d}}return new a(g)}},{key:"round",value:function(){return this.map(function(s){return Math.round(s)})}},{key:"snapTo",value:function(s){return this.map(function(u){return Math.abs(u-s)<=e.PRECISION?s:u})}},{key:"inspect",value:function(){var s=[],u=this.elements.length;if(u===0)return"[]";for(var f=0;f<u;f++)s.push(new n.Vector(this.elements[f]).inspect());return s.join(`
`)}},{key:"setElements",value:function(s){var u,f,l=s.elements||s;if(l[0]&&typeof l[0][0]<"u"){for(u=l.length,this.elements=[];u--;)for(f=l[u].length,this.elements[u]=[];f--;)this.elements[u][f]=l[u][f];return this}var h=l.length;for(this.elements=[],u=0;u<h;u++)this.elements.push([l[u]]);return this}},{key:"flatten",value:function(){var s=[];if(this.elements.length==0)return[];for(var u=0;u<this.elements[0].length;u++)for(var f=0;f<this.elements.length;f++)s.push(this.elements[f][u]);return s}},{key:"ensure4x4",value:function(){if(this.elements.length==4&&this.elements[0].length==4)return this;if(this.elements.length>4||this.elements[0].length>4)return null;for(var s=0;s<this.elements.length;s++)for(var u=this.elements[s].length;u<4;u++)s==u?this.elements[s].push(1):this.elements[s].push(0);for(var s=this.elements.length;s<4;s++)s==0?this.elements.push([1,0,0,0]):s==1?this.elements.push([0,1,0,0]):s==2?this.elements.push([0,0,1,0]):s==3&&this.elements.push([0,0,0,1]);return this}},{key:"make3x3",value:function(){return this.elements.length!=4||this.elements[0].length!=4?null:new a([[this.elements[0][0],this.elements[0][1],this.elements[0][2]],[this.elements[1][0],this.elements[1][1],this.elements[1][2]],[this.elements[2][0],this.elements[2][1],this.elements[2][2]]])}}]),a}();return i.I=function(a){for(var o=[],s=a,u;s--;)for(u=a,o[s]=[];u--;)o[s][u]=s===u?1:0;return new i(o)},i.Diagonal=function(a){for(var o=a.length,s=i.I(o);o--;)s.elements[o][o]=a[o];return s},i.Rotation=function(a,o){if(!o)return new i([[Math.cos(a),-Math.sin(a)],[Math.sin(a),Math.cos(a)]]);var s=o.dup();if(s.elements.length!==3)return null;var u=s.modulus(),f=s.elements[0]/u,l=s.elements[1]/u,h=s.elements[2]/u,c=Math.sin(a),d=Math.cos(a),v=1-d;return new i([[v*f*f+d,v*f*l-c*h,v*f*h+c*l],[v*f*l+c*h,v*l*l+d,v*l*h-c*f],[v*f*h-c*l,v*l*h+c*f,v*h*h+d]])},i.RotationX=function(a){var o=Math.cos(a),s=Math.sin(a);return new i([[1,0,0],[0,o,-s],[0,s,o]])},i.RotationY=function(a){var o=Math.cos(a),s=Math.sin(a);return new i([[o,0,s],[0,1,0],[-s,0,o]])},i.RotationZ=function(a){var o=Math.cos(a),s=Math.sin(a);return new i([[o,-s,0],[s,o,0],[0,0,1]])},i.Random=function(a,o){return i.Zero(a,o).map(function(){return Math.random()})},i.Translation=function(a){if(a.elements.length==2){var o=i.I(3);return o.elements[2][0]=a.elements[0],o.elements[2][1]=a.elements[1],o}if(a.elements.length==3){var o=i.I(4);return o.elements[0][3]=a.elements[0],o.elements[1][3]=a.elements[1],o.elements[2][3]=a.elements[2],o}throw"Invalid length for Translation"},i.Zero=function(a,o){for(var s=[],u=a,f;u--;)for(f=o,s[u]=[];f--;)s[u][f]=0;return new i(s)},i.prototype.toUpperTriangular=i.prototype.toRightTriangular,i.prototype.det=i.prototype.determinant,i.prototype.tr=i.prototype.trace,i.prototype.rk=i.prototype.rank,i.prototype.inv=i.prototype.inverse,i.prototype.x=i.prototype.multiply,qe}var vr;function me(){if(vr)return Ye;vr=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.Vector=void 0;var t=function(){function a(o,s){for(var u=0;u<s.length;u++){var f=s[u];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(o,f.key,f)}}return function(o,s,u){return s&&a(o.prototype,s),u&&a(o,u),o}}(),e=Me(),n=he;function r(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}var i=Ye.Vector=function(){function a(o){r(this,a),this.setElements(o)}return t(a,[{key:"e",value:function(s){return s<1||s>this.elements.length?null:this.elements[s-1]}},{key:"dimensions",value:function(){return this.elements.length}},{key:"modulus",value:function(){return Math.sqrt(this.dot(this))}},{key:"eql",value:function(s){var u=this.elements.length,f=s.elements||s;if(u!==f.length)return!1;for(;u--;)if(Math.abs(this.elements[u]-f[u])>n.PRECISION)return!1;return!0}},{key:"dup",value:function(){return new a(this.elements)}},{key:"map",value:function(s,u){var f=[];return this.each(function(l,h){f.push(s.call(u,l,h))}),new a(f)}},{key:"forEach",value:function(s,u){for(var f=this.elements.length,l=0;l<f;l++)s.call(u,this.elements[l],l+1)}},{key:"toUnitVector",value:function(){var s=this.modulus();return s===0?this.dup():this.map(function(u){return u/s})}},{key:"angleFrom",value:function(s){var u=s.elements||s,f=this.elements.length;if(f!==u.length)return null;var l=0,h=0,c=0;if(this.each(function(v,g){l+=v*u[g-1],h+=v*v,c+=u[g-1]*u[g-1]}),h=Math.sqrt(h),c=Math.sqrt(c),h*c===0)return null;var d=l/(h*c);return d<-1&&(d=-1),d>1&&(d=1),Math.acos(d)}},{key:"isParallelTo",value:function(s){var u=this.angleFrom(s);return u===null?null:u<=n.PRECISION}},{key:"isAntiparallelTo",value:function(s){var u=this.angleFrom(s);return u===null?null:Math.abs(u-Math.PI)<=n.PRECISION}},{key:"isPerpendicularTo",value:function(s){var u=this.dot(s);return u===null?null:Math.abs(u)<=n.PRECISION}},{key:"add",value:function(s){var u=s.elements||s;return this.elements.length!==u.length?null:this.map(function(f,l){return f+u[l-1]})}},{key:"subtract",value:function(s){var u=s.elements||s;return this.elements.length!==u.length?null:this.map(function(f,l){return f-u[l-1]})}},{key:"multiply",value:function(s){return this.map(function(u){return u*s})}},{key:"dot",value:function(s){var u=s.elements||s,f=0,l=this.elements.length;if(l!==u.length)return null;for(;l--;)f+=this.elements[l]*u[l];return f}},{key:"cross",value:function(s){var u=s.elements||s;if(this.elements.length!==3||u.length!==3)return null;var f=this.elements;return new a([f[1]*u[2]-f[2]*u[1],f[2]*u[0]-f[0]*u[2],f[0]*u[1]-f[1]*u[0]])}},{key:"max",value:function(){for(var s=0,u=this.elements.length;u--;)Math.abs(this.elements[u])>Math.abs(s)&&(s=this.elements[u]);return s}},{key:"indexOf",value:function(s){for(var u=null,f=this.elements.length,l=0;l<f;l++)u===null&&this.elements[l]===s&&(u=l+1);return u}},{key:"toDiagonalMatrix",value:function(){return e.Matrix.Diagonal(this.elements)}},{key:"round",value:function(){return this.map(function(s){return Math.round(s)})}},{key:"snapTo",value:function(s){return this.map(function(u){return Math.abs(u-s)<=n.PRECISION?s:u})}},{key:"distanceFrom",value:function(s){if(s.anchor||s.start&&s.end)return s.distanceFrom(this);var u=s.elements||s;if(u.length!==this.elements.length)return null;var f=0,l;return this.each(function(h,c){l=h-u[c-1],f+=l*l}),Math.sqrt(f)}},{key:"liesOn",value:function(s){return s.contains(this)}},{key:"liesIn",value:function(s){return s.contains(this)}},{key:"rotate",value:function(s,u){var f,l=null,h,c,d;switch(s.determinant&&(l=s.elements),this.elements.length){case 2:return f=u.elements||u,f.length!==2?null:(l||(l=e.Matrix.Rotation(s).elements),h=this.elements[0]-f[0],c=this.elements[1]-f[1],new a([f[0]+l[0][0]*h+l[0][1]*c,f[1]+l[1][0]*h+l[1][1]*c]));case 3:{if(!u.direction)return null;var v=u.pointClosestTo(this).elements;return l||(l=e.Matrix.Rotation(s,u.direction).elements),h=this.elements[0]-v[0],c=this.elements[1]-v[1],d=this.elements[2]-v[2],new a([v[0]+l[0][0]*h+l[0][1]*c+l[0][2]*d,v[1]+l[1][0]*h+l[1][1]*c+l[1][2]*d,v[2]+l[2][0]*h+l[2][1]*c+l[2][2]*d])}default:return null}}},{key:"reflectionIn",value:function(s){if(s.anchor){var u=this.elements.slice(),f=s.pointClosestTo(u).elements;return new a([f[0]+(f[0]-u[0]),f[1]+(f[1]-u[1]),f[2]+(f[2]-(u[2]||0))])}else{var l=s.elements||s;return this.elements.length!==l.length?null:this.map(function(h,c){return l[c-1]+(l[c-1]-h)})}}},{key:"to3D",value:function(){var s=this.dup();switch(s.elements.length){case 3:break;case 2:{s.elements.push(0);break}default:return null}return s}},{key:"inspect",value:function(){return"["+this.elements.join(", ")+"]"}},{key:"setElements",value:function(s){return this.elements=(s.elements||s).slice(),this}},{key:"flatten",value:function(){return this.elements}}]),a}();return i.Random=function(a){for(var o=[];a--;)o.push(Math.random());return new i(o)},i.Zero=function(a){for(var o=[];a--;)o.push(0);return new i(o)},i.prototype.x=i.prototype.multiply,i.prototype.each=i.prototype.forEach,i.i=new i([1,0,0]),i.j=new i([0,1,0]),i.k=new i([0,0,1]),Ye}var Xe={},mr;function _t(){if(mr)return Xe;mr=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.Plane=void 0;var t=function(){function s(u,f){for(var l=0;l<f.length;l++){var h=f[l];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(u,h.key,h)}}return function(u,f,l){return f&&s(u.prototype,f),l&&s(u,l),u}}(),e=he,n=Me(),r=me(),i=At();function a(s,u){if(!(s instanceof u))throw new TypeError("Cannot call a class as a function")}var o=Xe.Plane=function(){function s(u,f,l){a(this,s),this.setVectors(u,f,l)}return t(s,[{key:"eql",value:function(f){return this.contains(f.anchor)&&this.isParallelTo(f)}},{key:"dup",value:function(){return new s(this.anchor,this.normal)}},{key:"translate",value:function(f){var l=f.elements||f;return new s([this.anchor.elements[0]+l[0],this.anchor.elements[1]+l[1],this.anchor.elements[2]+(l[2]||0)],this.normal)}},{key:"isParallelTo",value:function(f){var l;return f.normal?(l=this.normal.angleFrom(f.normal),Math.abs(l)<=e.PRECISION||Math.abs(Math.PI-l)<=e.PRECISION):f.direction?this.normal.isPerpendicularTo(f.direction):null}},{key:"isPerpendicularTo",value:function(f){var l=this.normal.angleFrom(f.normal);return Math.abs(Math.PI/2-l)<=e.PRECISION}},{key:"distanceFrom",value:function(f){if(this.intersects(f)||this.contains(f))return 0;if(f.anchor){var l=this.anchor.elements,h=f.anchor.elements,c=this.normal.elements;return Math.abs((l[0]-h[0])*c[0]+(l[1]-h[1])*c[1]+(l[2]-h[2])*c[2])}else{var d=f.elements||f,l=this.anchor.elements,c=this.normal.elements;return Math.abs((l[0]-d[0])*c[0]+(l[1]-d[1])*c[1]+(l[2]-(d[2]||0))*c[2])}}},{key:"contains",value:function(f){if(f.normal)return null;if(f.direction)return this.contains(f.anchor)&&this.contains(f.anchor.add(f.direction));var l=f.elements||f,h=this.anchor.elements,c=this.normal.elements,d=Math.abs(c[0]*(h[0]-l[0])+c[1]*(h[1]-l[1])+c[2]*(h[2]-(l[2]||0)));return d<=e.PRECISION}},{key:"intersects",value:function(f){return typeof f.direction>"u"&&typeof f.normal>"u"?null:!this.isParallelTo(f)}},{key:"intersectionWith",value:function(f){if(!this.intersects(f))return null;if(f.direction){var l=f.anchor.elements,h=f.direction.elements,c=this.anchor.elements,d=this.normal.elements,v=(d[0]*(c[0]-l[0])+d[1]*(c[1]-l[1])+d[2]*(c[2]-l[2]))/(d[0]*h[0]+d[1]*h[1]+d[2]*h[2]);return new r.Vector([l[0]+h[0]*v,l[1]+h[1]*v,l[2]+h[2]*v])}else if(f.normal){for(var g=this.normal.cross(f.normal).toUnitVector(),d=this.normal.elements,l=this.anchor.elements,m=f.normal.elements,y=f.anchor.elements,w=n.Matrix.Zero(2,2),x=0;w.isSingular();)x++,w=new n.Matrix([[d[x%3],d[(x+1)%3]],[m[x%3],m[(x+1)%3]]]);for(var p=w.inverse().elements,A=d[0]*l[0]+d[1]*l[1]+d[2]*l[2],_=m[0]*y[0]+m[1]*y[1]+m[2]*y[2],C=[p[0][0]*A+p[0][1]*_,p[1][0]*A+p[1][1]*_],k=[],S=1;S<=3;S++)k.push(x===S?0:C[(S+(5-x)%3)%3]);return new i.Line(k,g)}}},{key:"pointClosestTo",value:function(f){var l=f.elements||f,h=this.anchor.elements,c=this.normal.elements,d=(h[0]-l[0])*c[0]+(h[1]-l[1])*c[1]+(h[2]-(l[2]||0))*c[2];return new r.Vector([l[0]+c[0]*d,l[1]+c[1]*d,(l[2]||0)+c[2]*d])}},{key:"rotate",value:function(f,l){var h=f.determinant?f.elements:n.Matrix.Rotation(f,l.direction).elements,c=l.pointClosestTo(this.anchor).elements,d=this.anchor.elements,v=this.normal.elements,g=c[0],m=c[1],y=c[2],w=d[0],x=d[1],p=d[2],A=w-g,_=x-m,C=p-y;return new s([g+h[0][0]*A+h[0][1]*_+h[0][2]*C,m+h[1][0]*A+h[1][1]*_+h[1][2]*C,y+h[2][0]*A+h[2][1]*_+h[2][2]*C],[h[0][0]*v[0]+h[0][1]*v[1]+h[0][2]*v[2],h[1][0]*v[0]+h[1][1]*v[1]+h[1][2]*v[2],h[2][0]*v[0]+h[2][1]*v[1]+h[2][2]*v[2]])}},{key:"reflectionIn",value:function(f){if(f.normal){var l=this.anchor.elements,h=this.normal.elements,c=l[0],d=l[1],v=l[2],g=h[0],m=h[1],y=h[2],w=this.anchor.reflectionIn(f).elements,x=c+g,p=d+m,A=v+y,_=f.pointClosestTo([x,p,A]).elements,C=[_[0]+(_[0]-x)-w[0],_[1]+(_[1]-p)-w[1],_[2]+(_[2]-A)-w[2]];return new s(w,C)}else{if(f.direction)return this.rotate(Math.PI,f);var k=f.elements||f;return new s(this.anchor.reflectionIn([k[0],k[1],k[2]||0]),this.normal)}}},{key:"setVectors",value:function(f,l,h){if(f=new r.Vector(f),f=f.to3D(),f===null||(l=new r.Vector(l),l=l.to3D(),l===null))return null;if(typeof h>"u")h=null;else if(h=new r.Vector(h),h=h.to3D(),h===null)return null;var c=f.elements[0],d=f.elements[1],v=f.elements[2],g=l.elements[0],m=l.elements[1],y=l.elements[2],w,x;if(h!==null){var p=h.elements[0],A=h.elements[1],_=h.elements[2];if(w=new r.Vector([(m-d)*(_-v)-(y-v)*(A-d),(y-v)*(p-c)-(g-c)*(_-v),(g-c)*(A-d)-(m-d)*(p-c)]),x=w.modulus(),x===0)return null;w=new r.Vector([w.elements[0]/x,w.elements[1]/x,w.elements[2]/x])}else{if(x=Math.sqrt(g*g+m*m+y*y),x===0)return null;w=new r.Vector([l.elements[0]/x,l.elements[1]/x,l.elements[2]/x])}return this.anchor=f,this.normal=w,this}}]),s}();return o.XY=new o(r.Vector.Zero(3),r.Vector.k),o.YZ=new o(r.Vector.Zero(3),r.Vector.i),o.ZX=new o(r.Vector.Zero(3),r.Vector.j),o.YX=o.XY,o.ZY=o.YZ,o.XZ=o.ZX,o.fromPoints=function(s){var u=s.length,f=[],l,h,c,d,v,g,m,y,w,x,p=r.Vector.Zero(3);for(l=0;l<u;l++){if(h=new r.Vector(s[l]).to3D(),h===null)return null;if(f.push(h),c=f.length,c>2){if(v=f[c-1].elements,g=f[c-2].elements,m=f[c-3].elements,d=new r.Vector([(v[1]-g[1])*(m[2]-g[2])-(v[2]-g[2])*(m[1]-g[1]),(v[2]-g[2])*(m[0]-g[0])-(v[0]-g[0])*(m[2]-g[2]),(v[0]-g[0])*(m[1]-g[1])-(v[1]-g[1])*(m[0]-g[0])]).toUnitVector(),c>3&&(w=d.angleFrom(x),w!==null&&!(Math.abs(w)<=e.PRECISION||Math.abs(w-Math.PI)<=e.PRECISION)))return null;p=p.add(d),x=d}}return v=f[1].elements,g=f[0].elements,m=f[c-1].elements,y=f[c-2].elements,p=p.add(new r.Vector([(v[1]-g[1])*(m[2]-g[2])-(v[2]-g[2])*(m[1]-g[1]),(v[2]-g[2])*(m[0]-g[0])-(v[0]-g[0])*(m[2]-g[2]),(v[0]-g[0])*(m[1]-g[1])-(v[1]-g[1])*(m[0]-g[0])]).toUnitVector()).add(new r.Vector([(g[1]-m[1])*(y[2]-m[2])-(g[2]-m[2])*(y[1]-m[1]),(g[2]-m[2])*(y[0]-m[0])-(g[0]-m[0])*(y[2]-m[2]),(g[0]-m[0])*(y[1]-m[1])-(g[1]-m[1])*(y[0]-m[0])]).toUnitVector()),new o(f[0],p)},Xe}var pr;function At(){if(pr)return He;pr=1,Object.defineProperty(He,"__esModule",{value:!0}),He.Line=void 0;var t=function(){function s(u,f){for(var l=0;l<f.length;l++){var h=f[l];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(u,h.key,h)}}return function(u,f,l){return f&&s(u.prototype,f),l&&s(u,l),u}}(),e=he,n=me(),r=Me(),i=_t();function a(s,u){if(!(s instanceof u))throw new TypeError("Cannot call a class as a function")}var o=He.Line=function(){function s(u,f){a(this,s),this.setVectors(u,f)}return t(s,[{key:"eql",value:function(f){return this.isParallelTo(f)&&this.contains(f.anchor)}},{key:"dup",value:function(){return new s(this.anchor,this.direction)}},{key:"translate",value:function(f){var l=f.elements||f;return new s([this.anchor.elements[0]+l[0],this.anchor.elements[1]+l[1],this.anchor.elements[2]+(l[2]||0)],this.direction)}},{key:"isParallelTo",value:function(f){if(f.normal||f.start&&f.end)return f.isParallelTo(this);var l=this.direction.angleFrom(f.direction);return Math.abs(l)<=e.PRECISION||Math.abs(l-Math.PI)<=e.PRECISION}},{key:"distanceFrom",value:function(f){if(f.normal||f.start&&f.end)return f.distanceFrom(this);if(f.direction){if(this.isParallelTo(f))return this.distanceFrom(f.anchor);var l=this.direction.cross(f.direction).toUnitVector().elements,h=this.anchor.elements,c=f.anchor.elements;return Math.abs((h[0]-c[0])*l[0]+(h[1]-c[1])*l[1]+(h[2]-c[2])*l[2])}else{var d=f.elements||f,h=this.anchor.elements,v=this.direction.elements,g=d[0]-h[0],m=d[1]-h[1],y=(d[2]||0)-h[2],w=Math.sqrt(g*g+m*m+y*y);if(w===0)return 0;var x=(g*v[0]+m*v[1]+y*v[2])/w,p=1-x*x;return Math.abs(w*Math.sqrt(p<0?0:p))}}},{key:"contains",value:function(f){if(f.start&&f.end)return this.contains(f.start)&&this.contains(f.end);var l=this.distanceFrom(f);return l!==null&&l<=e.PRECISION}},{key:"positionOf",value:function(f){if(!this.contains(f))return null;var l=f.elements||f,h=this.anchor.elements,c=this.direction.elements;return(l[0]-h[0])*c[0]+(l[1]-h[1])*c[1]+((l[2]||0)-h[2])*c[2]}},{key:"liesIn",value:function(f){return f.contains(this)}},{key:"intersects",value:function(f){return f.normal?f.intersects(this):!this.isParallelTo(f)&&this.distanceFrom(f)<=e.PRECISION}},{key:"intersectionWith",value:function(f){if(f.normal||f.start&&f.end)return f.intersectionWith(this);if(!this.intersects(f))return null;var l=this.anchor.elements,h=this.direction.elements,c=f.anchor.elements,d=f.direction.elements,v=h[0],g=h[1],m=h[2],y=d[0],w=d[1],x=d[2],p=l[0]-c[0],A=l[1]-c[1],_=l[2]-c[2],C=-v*p-g*A-m*_,k=y*p+w*A+x*_,S=v*v+g*g+m*m,N=y*y+w*w+x*x,I=v*y+g*w+m*x,O=(C*N/S+I*k)/(N-I*I);return new n.Vector([l[0]+O*v,l[1]+O*g,l[2]+O*m])}},{key:"pointClosestTo",value:function(f){if(f.start&&f.end){var l=f.pointClosestTo(this);return l===null?null:this.pointClosestTo(l)}else if(f.direction){if(this.intersects(f))return this.intersectionWith(f);if(this.isParallelTo(f))return null;var h=this.direction.elements,c=f.direction.elements,d=h[0],v=h[1],g=h[2],m=c[0],y=c[1],w=c[2],x=g*m-d*w,p=d*y-v*m,A=v*w-g*y,_=[x*w-p*y,p*m-A*w,A*y-x*m],l=new i.Plane(f.anchor,_);return l.intersectionWith(this)}else{var l=f.elements||f;if(this.contains(l))return new n.Vector(l);var C=this.anchor.elements,h=this.direction.elements,d=h[0],v=h[1],g=h[2],k=C[0],S=C[1],N=C[2],x=d*(l[1]-S)-v*(l[0]-k),p=v*((l[2]||0)-N)-g*(l[1]-S),A=g*(l[0]-k)-d*((l[2]||0)-N),I=new n.Vector([v*x-g*A,g*p-d*x,d*A-v*p]),O=this.distanceFrom(l)/I.modulus();return new n.Vector([l[0]+I.elements[0]*O,l[1]+I.elements[1]*O,(l[2]||0)+I.elements[2]*O])}}},{key:"rotate",value:function(f,l){typeof l.direction>"u"&&(l=new s(l.to3D(),n.Vector.k));var h=r.Matrix.Rotation(f,l.direction).elements,c=l.pointClosestTo(this.anchor).elements,d=this.anchor.elements,v=this.direction.elements,g=c[0],m=c[1],y=c[2],w=d[0],x=d[1],p=d[2],A=w-g,_=x-m,C=p-y;return new s([g+h[0][0]*A+h[0][1]*_+h[0][2]*C,m+h[1][0]*A+h[1][1]*_+h[1][2]*C,y+h[2][0]*A+h[2][1]*_+h[2][2]*C],[h[0][0]*v[0]+h[0][1]*v[1]+h[0][2]*v[2],h[1][0]*v[0]+h[1][1]*v[1]+h[1][2]*v[2],h[2][0]*v[0]+h[2][1]*v[1]+h[2][2]*v[2]])}},{key:"reverse",value:function(){return new s(this.anchor,this.direction.x(-1))}},{key:"reflectionIn",value:function(f){if(f.normal){var l=this.anchor.elements,h=this.direction.elements,c=l[0],d=l[1],v=l[2],g=h[0],m=h[1],y=h[2],w=this.anchor.reflectionIn(f).elements,x=c+g,p=d+m,A=v+y,_=f.pointClosestTo([x,p,A]).elements,C=[_[0]+(_[0]-x)-w[0],_[1]+(_[1]-p)-w[1],_[2]+(_[2]-A)-w[2]];return new s(w,C)}else{if(f.direction)return this.rotate(Math.PI,f);var k=f.elements||f;return new s(this.anchor.reflectionIn([k[0],k[1],k[2]||0]),this.direction)}}},{key:"setVectors",value:function(f,l){if(f=new n.Vector(f),l=new n.Vector(l),f.elements.length===2&&f.elements.push(0),l.elements.length===2&&l.elements.push(0),f.elements.length>3||l.elements.length>3)return null;var h=l.modulus();return h===0?null:(this.anchor=f,this.direction=new n.Vector([l.elements[0]/h,l.elements[1]/h,l.elements[2]/h]),this)}}]),s}();return o.X=new o(n.Vector.Zero(3),n.Vector.i),o.Y=new o(n.Vector.Zero(3),n.Vector.j),o.Z=new o(n.Vector.Zero(3),n.Vector.k),He}var yt={};Object.defineProperty(yt,"__esModule",{value:!0}),yt.LineSegment=void 0;var Vo=function(){function t(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),je=me(),Wo=_t(),Ho=At();function Yo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}yt.LineSegment=function(){function t(e,n){Yo(this,t),this.setPoints(e,n)}return Vo(t,[{key:"eql",value:function(n){return this.start.eql(n.start)&&this.end.eql(n.end)||this.start.eql(n.end)&&this.end.eql(n.start)}},{key:"dup",value:function(){return new t(this.start,this.end)}},{key:"length",value:function(){var n=this.start.elements,r=this.end.elements,i=r[0]-n[0],a=r[1]-n[1],o=r[2]-n[2];return Math.sqrt(i*i+a*a+o*o)}},{key:"toVector",value:function(){var n=this.start.elements,r=this.end.elements;return new je.Vector([r[0]-n[0],r[1]-n[1],r[2]-n[2]])}},{key:"midpoint",value:function(){var n=this.start.elements,r=this.end.elements;return new je.Vector([(r[0]+n[0])/2,(r[1]+n[1])/2,(r[2]+n[2])/2])}},{key:"bisectingPlane",value:function(){return new Wo.Plane(this.midpoint(),this.toVector())}},{key:"translate",value:function(n){var r=n.elements||n,i=this.start.elements,a=this.end.elements;return new t([i[0]+r[0],i[1]+r[1],i[2]+(r[2]||0)],[a[0]+r[0],a[1]+r[1],a[2]+(r[2]||0)])}},{key:"isParallelTo",value:function(n){return this.line.isParallelTo(n)}},{key:"distanceFrom",value:function(n){var r=this.pointClosestTo(n);return r===null?null:r.distanceFrom(n)}},{key:"contains",value:function(n){if(n.start&&n.end)return this.contains(n.start)&&this.contains(n.end);var r=(n.elements||n).slice();if(r.length===2&&r.push(0),this.start.eql(r))return!0;var i=this.start.elements,a=new je.Vector([i[0]-r[0],i[1]-r[1],i[2]-(r[2]||0)]),o=this.toVector();return a.isAntiparallelTo(o)&&a.modulus()<=o.modulus()}},{key:"intersects",value:function(n){return this.intersectionWith(n)!==null}},{key:"intersectionWith",value:function(n){if(!this.line.intersects(n))return null;var r=this.line.intersectionWith(n);return this.contains(r)?r:null}},{key:"pointClosestTo",value:function(n){if(n.normal){var r=this.line.intersectionWith(n);return r===null?null:this.pointClosestTo(r)}else{var i=this.line.pointClosestTo(n);return i===null?null:this.contains(i)?i:(this.line.positionOf(i)<0?this.start:this.end).dup()}}},{key:"setPoints",value:function(n,r){return n=new je.Vector(n).to3D(),r=new je.Vector(r).to3D(),n===null||r===null?null:(this.line=new Ho.Line(n,r.subtract(n)),this.start=n,this.end=r,this)}}]),t}();var nn={};Object.defineProperty(nn,"__esModule",{value:!0});function qo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}nn.LinkedListNode=function t(e){qo(this,t),this.prev=null,this.next=null,this.data=e};var bt={};Object.defineProperty(bt,"__esModule",{value:!0}),bt.Polygon=void 0;var Xo=function(){function t(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),ce=We,_r=he,jo=Me(),$e=me(),rn=_t(),$o=At();function Zo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}bt.Polygon=function(){function t(e,n){Zo(this,t),this.setVertices(e,n)}return Xo(t,[{key:"v",value:function(n){return this.vertices.at(n-1).data}},{key:"nodeFor",value:function(n){return this.vertices.withData(n)}},{key:"dup",value:function(){return new t(this.vertices,this.plane)}},{key:"translate",value:function(n){var r=n.elements||n;return this.vertices.each(function(i){var a=i.data.elements;i.data.setElements([a[0]+r[0],a[1]+r[1],a[2]+(r[2]||0)])}),this.plane=this.plane.translate(n),this.updateTrianglePlanes(function(i){return i.translate(n)}),this}},{key:"rotate",value:function(n,r){var i=jo.Matrix.Rotation(n,r.direction);return this.vertices.each(function(a){a.data.setElements(a.data.rotate(i,r).elements)}),this.plane=this.plane.rotate(i,r),this.updateTrianglePlanes(function(a){return a.rotate(i,r)}),this}},{key:"scale",value:function(n,r){var i=r.elements||r;this.vertices.each(function(o){var s=o.data.elements;o.data.setElements([i[0]+n*(s[0]-i[0]),i[1]+n*(s[1]-i[1]),(i[2]||0)+n*(s[2]-(i[2]||0))])});var a=this.vertices.first.data;return this.plane.anchor.setElements(a),this.updateTrianglePlanes(function(o){return new rn.Plane(a,o.normal)}),this}},{key:"updateTrianglePlanes",value:function(n){var r;if(this.cached.triangles!==null)for(r=this.cached.triangles.length;r--;)this.cached.triangles[r].plane=n(this.cached.triangles[r].plane);if(this.cached.surfaceIntegralElements!==null)for(r=this.cached.surfaceIntegralElements.length;r--;)this.cached.surfaceIntegralElements[r].plane=n(this.cached.surfaceIntegralElements[r].plane)}},{key:"isTriangle",value:function(){return this.vertices.length===3}},{key:"trianglesForSurfaceIntegral",value:function(){if(this.cached.surfaceIntegralElements!==null)return this.cached.surfaceIntegralElements;var n=[],r=this.vertices.first.data,i=this.plane;return this.vertices.each(function(a,o){if(!(o<2)){var s=[r,a.prev.data,a.data];n.push(new t(s,rn.Plane.fromPoints(s)||i))}}),this.setCache("surfaceIntegralElements",n)}},{key:"area",value:function(){if(this.isTriangle()){var n=this.vertices.first,r=n.next,i=r.next;return n=n.data.elements,r=r.data.elements,i=i.data.elements,.5*new $e.Vector([(n[1]-r[1])*(i[2]-r[2])-(n[2]-r[2])*(i[1]-r[1]),(n[2]-r[2])*(i[0]-r[0])-(n[0]-r[0])*(i[2]-r[2]),(n[0]-r[0])*(i[1]-r[1])-(n[1]-r[1])*(i[0]-r[0])]).modulus()}else{for(var a=this.trianglesForSurfaceIntegral(),o=0,s=a.length;s--;)o+=a[s].area()*a[s].plane.normal.dot(this.plane.normal);return o}}},{key:"centroid",value:function(){if(this.isTriangle()){var n=this.v(1).elements,r=this.v(2).elements,i=this.v(3).elements;return new $e.Vector([(n[0]+r[0]+i[0])/3,(n[1]+r[1]+i[1])/3,(n[2]+r[2]+i[2])/3])}else{for(var n,a=0,o=$e.Vector.Zero(3),s,i,u=this.trianglesForSurfaceIntegral(),f=u.length;f--;)n=u[f].area()*u[f].plane.normal.dot(this.plane.normal),a+=n,s=o.elements,i=u[f].centroid().elements,o.setElements([s[0]+i[0]*n,s[1]+i[1]*n,s[2]+i[2]*n]);return o.x(1/a)}}},{key:"projectionOn",value:function(n){var r=[];return this.vertices.each(function(i){r.push(n.pointClosestTo(i.data))}),new t(r)}},{key:"removeVertex",value:function(n){if(!this.isTriangle()){var r=this.nodeFor(n);if(r===null)return null;this.clearCache();var i=r.prev,a=r.next,o=i.data.isConvex(this),s=a.data.isConvex(this);return r.data.isConvex(this)?this.convexVertices.remove(this.convexVertices.withData(r.data)):this.reflexVertices.remove(this.reflexVertices.withData(r.data)),this.vertices.remove(r),o!==i.data.isConvex(this)&&(o?(this.convexVertices.remove(this.convexVertices.withData(i.data)),this.reflexVertices.append(new ce.LinkedList.Node(i.data))):(this.reflexVertices.remove(this.reflexVertices.withData(i.data)),this.convexVertices.append(new ce.LinkedList.Node(i.data)))),s!==a.data.isConvex(this)&&(s?(this.convexVertices.remove(this.convexVertices.withData(a.data)),this.reflexVertices.append(new ce.LinkedList.Node(a.data))):(this.reflexVertices.remove(this.reflexVertices.withData(a.data)),this.convexVertices.append(new ce.LinkedList.Node(a.data)))),this}}},{key:"contains",value:function(n){return this.containsByWindingNumber(n)}},{key:"containsByWindingNumber",value:function(n){var r=n.elements||n;if(!this.plane.contains(r)||this.hasEdgeContaining(r))return!1;var i,a,o,s,u=0,f,l=0,h=this;return this.vertices.each(function(c){i=c.data.elements,a=c.next.data.elements,o=new $e.Vector([i[0]-r[0],i[1]-r[1],i[2]-(r[2]||0)]),s=new $e.Vector([a[0]-r[0],a[1]-r[1],a[2]-(r[2]||0)]),f=o.angleFrom(s),!(f===null||f===0)&&(u+=(o.cross(s).isParallelTo(h.plane.normal)?1:-1)*f,u>=2*Math.PI-_r.PRECISION&&(l++,u-=2*Math.PI),u<=-2*Math.PI+_r.PRECISION&&(l--,u+=2*Math.PI))}),l!==0}},{key:"hasEdgeContaining",value:function(n){var r=n.elements||n,i=!1;return this.vertices.each(function(a){$o.Line.Segment.create(a.data,a.next.data).contains(r)&&(i=!0)}),i}},{key:"toTriangles",value:function(){return this.cached.triangles!==null?this.cached.triangles:this.setCache("triangles",this.triangulateByEarClipping())}},{key:"triangulateByEarClipping",value:function(){for(var n=this.dup(),r=[],i,a,o,s;!n.isTriangle();){for(i=!1;!i;)i=!0,a=n.convexVertices.randomNode(),o=n.vertices.withData(a.data),s=new t([o.data,o.next.data,o.prev.data],this.plane),n.reflexVertices.each(function(u){u.data!==o.prev.data&&u.data!==o.next.data&&(s.contains(u.data)||s.hasEdgeContaining(u.data))&&(i=!1)});r.push(s),n.removeVertex(o.data)}return r.push(new t(n.vertices,this.plane)),r}},{key:"setVertices",value:function(n,r){var i=n.toArray?n.toArray():n;if(this.plane=r&&r.normal?r.dup():rn.Plane.fromPoints(i),this.plane===null)return null;this.vertices=new ce.LinkedList.Circular;for(var a=i.length,o;a--;)o=i[a].isConvex?i[a]:new t.Vertex(i[a]),this.vertices.prepend(new ce.LinkedList.Node(o));return this.clearCache(),this.populateVertexTypeLists(),this}},{key:"populateVertexTypeLists",value:function(){this.convexVertices=new ce.LinkedList.Circular,this.reflexVertices=new ce.LinkedList.Circular;var n=this;this.vertices.each(function(r){n[r.data.type(n)+"Vertices"].append(new ce.LinkedList.Node(r.data))})}},{key:"copyVertices",value:function(){this.clearCache(),this.vertices.each(function(n){n.data=new t.Vertex(n.data)}),this.populateVertexTypeLists()}},{key:"clearCache",value:function(){this.cached={triangles:null,surfaceIntegralElements:null}}},{key:"setCache",value:function(n,r){return this.cached[n]=r,r}},{key:"inspect",value:function(){var n=[];return this.vertices.each(function(r){n.push(r.data.inspect())}),n.join(" -> ")}}]),t}();var xt={};Object.defineProperty(xt,"__esModule",{value:!0}),xt.Vertex=void 0;var Ko=function(){function t(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),Jo=me(),Ar=he;function el(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yr(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function tl(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var br=xt.Vertex=function(t){tl(e,t);function e(n){el(this,e);var r=yr(this,Object.getPrototypeOf(e).call(this,n));if(r.setElements(n),r.elements.length===2&&r.elements.push(0),r.elements.length!==3){var i;return i=null,yr(r,i)}return r}return Ko(e,[{key:"isConvex",value:function(r){var i=r.nodeFor(this);if(i===null)return null;var a=i.prev.data,o=i.next.data,s=o.subtract(this),u=a.subtract(this),f=s.angleFrom(u);return f<=Ar.PRECISION?!0:Math.abs(f-Math.PI)<=Ar.PRECISION?!1:s.cross(u).dot(r.plane.normal)>0}},{key:"isReflex",value:function(r){var i=this.isConvex(r);return i===null?null:!i}},{key:"type",value:function(r){var i=this.isConvex(r);return i===null?null:i?"convex":"reflex"}}]),e}(Jo.Vector);br.convert=function(t){for(var e=t.toArray?t.toArray():t,n=[],r=e.length,i=0;i<r;i++)n.push(new br(e[i]));return n};var xe={};Object.defineProperty(xe,"__esModule",{value:!0}),xe.mht=nl,xe.makeLookAt=rl,xe.makeOrtho=il,xe.makePerspective=al,xe.makeFrustum=xr;var an=me(),wt=Me();function nl(t){var e="";if(t.length==16)for(var n=0;n<4;n++)e+="<span style='font-family: monospace'>["+t[n*4+0].toFixed(4)+","+t[n*4+1].toFixed(4)+","+t[n*4+2].toFixed(4)+","+t[n*4+3].toFixed(4)+"]</span><br>";else if(t.length==9)for(var n=0;n<3;n++)e+="<span style='font-family: monospace'>["+t[n*3+0].toFixed(4)+","+t[n*3+1].toFixed(4)+","+t[n*3+2].toFixed(4)+"]</font><br>";else return t.toString();return e}function rl(t,e,n,r,i,a,o,s,u){var f=new an.Vector([t,e,n]),l=new an.Vector([r,i,a]),h=new an.Vector([o,s,u]),c=f.subtract(l).toUnitVector(),d=h.cross(c).toUnitVector(),v=c.cross(d).toUnitVector(),g=new wt.Matrix([[d.e(1),d.e(2),d.e(3),0],[v.e(1),v.e(2),v.e(3),0],[c.e(1),c.e(2),c.e(3),0],[0,0,0,1]]),m=new wt.Matrix([[1,0,0,-t],[0,1,0,-e],[0,0,1,-n],[0,0,0,1]]);return g.x(m)}function il(t,e,n,r,i,a){var o=-(e+t)/(e-t),s=-(r+n)/(r-n),u=-(a+i)/(a-i);return new wt.Matrix([[2/(e-t),0,0,o],[0,2/(r-n),0,s],[0,0,-2/(a-i),u],[0,0,0,1]])}function al(t,e,n,r){var i=n*Math.tan(t*Math.PI/360),a=-i,o=a*e,s=i*e;return xr(o,s,a,i,n,r)}function xr(t,e,n,r,i,a){var o=2*i/(e-t),s=2*i/(r-n),u=(e+t)/(e-t),f=(r+n)/(r-n),l=-(a+i)/(a-i),h=-2*a*i/(a-i);return new wt.Matrix([[o,0,u,0],[0,s,f,0],[0,0,l,h],[0,0,-1,0]])}(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=pt;Object.defineProperty(t,"CircularLinkedList",{enumerable:!0,get:function(){return e.CircularLinkedList}});var n=At();Object.defineProperty(t,"Line",{enumerable:!0,get:function(){return n.Line}});var r=yt;Object.defineProperty(t,"LineSegment",{enumerable:!0,get:function(){return r.LineSegment}});var i=We;Object.defineProperty(t,"LinkedList",{enumerable:!0,get:function(){return i.LinkedList}});var a=nn;Object.defineProperty(t,"LinkedListNode",{enumerable:!0,get:function(){return a.LinkedListNode}});var o=Me();Object.defineProperty(t,"Matrix",{enumerable:!0,get:function(){return o.Matrix}});var s=_t();Object.defineProperty(t,"Plane",{enumerable:!0,get:function(){return s.Plane}});var u=bt;Object.defineProperty(t,"Polygon",{enumerable:!0,get:function(){return u.Polygon}});var f=me();Object.defineProperty(t,"Vector",{enumerable:!0,get:function(){return f.Vector}});var l=xt;Object.defineProperty(t,"Vertex",{enumerable:!0,get:function(){return l.Vertex}});var h=xe;Object.defineProperty(t,"mht",{enumerable:!0,get:function(){return h.mht}}),Object.defineProperty(t,"makeLookAt",{enumerable:!0,get:function(){return h.makeLookAt}}),Object.defineProperty(t,"makePerspective",{enumerable:!0,get:function(){return h.makePerspective}}),Object.defineProperty(t,"makeFrustum",{enumerable:!0,get:function(){return h.makeFrustum}}),Object.defineProperty(t,"makeOrtho",{enumerable:!0,get:function(){return h.makeOrtho}});var c=he;Object.defineProperty(t,"PRECISION",{enumerable:!0,get:function(){return c.PRECISION}})})(mt);function Et(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(r*6,++r*6);return n}function kt(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}kt(Et("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),kt(Et("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf"));var sl=kt(Et("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"));kt(Et("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));let ol=`precision highp float; 

uniform sampler2D input_tex;
uniform sampler2D lut_tex;  
uniform float diverging;  
varying vec2 tex_coord;     
void main(){
	float val = texture2D( input_tex, tex_coord ).r+0.5*diverging;
	vec4 color = texture2D( lut_tex, vec2(val, 0.5) );
	gl_FragColor = vec4(color.rgb,1.0);
}
`,ll=`

attribute vec2 vertex;   
attribute vec2 texCoord; 
uniform mat4 uMVMatrix;  
uniform mat4 uPMatrix;   
varying vec2 tex_coord;  
void main(){
	tex_coord = texCoord; 
	gl_Position = uPMatrix * uMVMatrix * vec4( vertex, 0.0, 1.0 ); 
}

`,ul=`precision highp float;

varying vec2 quad_coord; 
varying float v_kernel_weight; 
uniform float kernel_weightScale; 
void main(void) { 
	float len = length( quad_coord ); 
	float nrm = v_kernel_weight * kernel_weightScale * 0.3989422804014327 * exp( -0.5*25.0*len*len ); 
	// gl_FragColor = vec4(1,1,1,1.0);//vec4(nrm,nrm,nrm, nrm );	
	gl_FragColor = vec4(nrm,nrm,nrm, nrm );
	// gl_FragColor = vec4(1,1,1, 1.0 ); 
}

`,fl=`

attribute vec3 position;
attribute float kernel_weight;

attribute vec2 offset;
// attribute vec3 normal;

uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;

uniform mat4 uMVMatrix; 
uniform mat4 uPMatrix; 
uniform float bandwidthScale; 
uniform vec2 bandwidth; 
varying vec2 quad_coord; 
varying float v_kernel_weight; 

void main(void) { 
	// vec4 viewCenters = viewMatrix*vec4(position,1.0);
	// vec2 pos = (viewCenters).xy; 
	// quad_coord = offset.xy;  
	// pos += bandwidthScale * bandwidth * quad_coord; 
	// gl_Position = uPMatrix * uMVMatrix * vec4( pos, 0.0, 1.0); 
	


	float BoxCorrection = 1.5;
	float fullSize = bandwidthScale * 5.5;
	vec3 cameraRight = normalize(vec3(viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0]));
	vec3 cameraUp = normalize(vec3(viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1]));
	// vec4 viewCenters = viewMatrix*vec4(position+BoxCorrection*fullSize*(cameraRight*offset.x + cameraUp*offset.y),1.0);
	vec4 viewCenters = viewMatrix*vec4(position,1.0);
	viewCenters.xy += bandwidthScale * bandwidth * offset.xy;
	quad_coord = offset.xy; 
	v_kernel_weight = kernel_weight;
	gl_Position = projectionMatrix * viewCenters;
} 
`;function Ct(t,e,n){let r=t.createShader(n);return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.log(t.getShaderInfoLog(r)),null)}function hl(t){let e=Ct(t,ul,t.FRAGMENT_SHADER),n=Ct(t,fl,t.VERTEX_SHADER),r=t.createProgram();return t.attachShader(r,n),t.attachShader(r,e),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)||alert("Could not initialise shaders"),t.useProgram(r),r.vertexPositionAttribute=t.getAttribLocation(r,"position"),r.vertexKernelWeightAttribute=t.getAttribLocation(r,"kernel_weight"),r.vertexOffsetAttribute=t.getAttribLocation(r,"offset"),r.pMatrixUniform=t.getUniformLocation(r,"uPMatrix"),r.mvMatrixUniform=t.getUniformLocation(r,"uMVMatrix"),r.projectionMatrixUniform=t.getUniformLocation(r,"projectionMatrix"),r.viewMatrixUniform=t.getUniformLocation(r,"viewMatrix"),r.bandwidthUniform=t.getUniformLocation(r,"bandwidth"),r.bandwidthScaleUniform=t.getUniformLocation(r,"bandwidthScale"),r.kernel_weightScaleUniform=t.getUniformLocation(r,"kernel_weightScale"),r}function cl(t){let e=Ct(t,ol,t.FRAGMENT_SHADER),n=Ct(t,ll,t.VERTEX_SHADER),r=t.createProgram();return t.attachShader(r,n),t.attachShader(r,e),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)||alert("Could not initialise shaders"),t.useProgram(r),r.vertexAttribute=t.getAttribLocation(r,"vertex"),r.texCoordAttribute=t.getAttribLocation(r,"texCoord"),r.pMatrixUniform=t.getUniformLocation(r,"uPMatrix"),r.mvMatrixUniform=t.getUniformLocation(r,"uMVMatrix"),r.input_texUniform=t.getUniformLocation(r,"input_tex"),r.lut_texUniform=t.getUniformLocation(r,"lut_tex"),r.divergingUniform=t.getUniformLocation(r,"diverging"),r}function de(t){console.log(t)}class dl{constructor(e,n,r,i=.1){this.gl=e,this.FBO,this.lutShader,this.shaderProgram,this.mvMatrix,this.pMatrix,this.qualityScale=i,this._divergingColormap=!1,this.bandwidth=[5.5,5.5],this.bandwidthScale=5,this.kernel_weightScale=.5,this.triangleVertexPositionBuffer,this.squareVertexPositionBuffer,this.PANEL_TEX_COORDS=[0,0,1,0,0,1,1,0,1,1,0,1],this.PANEL_TEX_POS=[0,0,1,0,0,1,1,0,1,1,0,1],this.QUAD_POS_BUFFER,this.QUAD_COORD_BUFFER,this.LUT_TEX,this.DATA=null,this.kernel_weights=null,this.resize(n,r),this.shaderProgram=hl(this.gl),this.lutShader=cl(this.gl),this.initBuffers(),this.setColormap()}loadIdentity(){this.mvMatrix=mt.Matrix.I(4)}multMatrix(e){this.mvMatrix=this.mvMatrix.x(e)}mvScale(e){this.mvMatrix.elements[0][0]*=e[0],this.mvMatrix.elements[0][1]*=e[0],this.mvMatrix.elements[0][2]*=e[0],this.mvMatrix.elements[0][3]*=e[0],this.mvMatrix.elements[1][0]*=e[1],this.mvMatrix.elements[1][1]*=e[1],this.mvMatrix.elements[1][2]*=e[1],this.mvMatrix.elements[1][3]*=e[1],this.mvMatrix.elements[2][0]*=e[2],this.mvMatrix.elements[2][1]*=e[2],this.mvMatrix.elements[2][2]*=e[2],this.mvMatrix.elements[2][3]*=e[2]}mvTranslate(e){var n=mt.Matrix.Translation($V([e[0],e[1],e[2]])).ensure4x4();this.multMatrix(n)}perspective(e,n,r,i){this.pMatrix=makePerspective(e,n,r,i)}ortho(e,n,r,i){this.pMatrix=mt.makeOrtho(e,n,r,i,-1,1)}setMatrixUniforms(e){this.gl.uniformMatrix4fv(e.pMatrixUniform,!1,new Float32Array(this.pMatrix.flatten())),this.gl.uniformMatrix4fv(e.mvMatrixUniform,!1,new Float32Array(this.mvMatrix.flatten()))}initBuffers(){let e=this.gl;this.triangleVertexPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.triangleVertexPositionBuffer);var n=[0,1,0,-1,-1,0,1,-1,0];e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW),this.triangleVertexPositionBuffer.itemSize=3,this.triangleVertexPositionBuffer.numItems=3,this.squareVertexPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.squareVertexPositionBuffer),n=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW),this.squareVertexPositionBuffer.itemSize=3,this.squareVertexPositionBuffer.numItems=4,this.QUAD_POS_BUFFER=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.QUAD_POS_BUFFER),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.PANEL_TEX_POS),e.STATIC_DRAW),this.QUAD_POS_BUFFER.itemSize=2,this.QUAD_POS_BUFFER.numItems=6,this.QUAD_COORD_BUFFER=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.QUAD_COORD_BUFFER),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.PANEL_TEX_COORDS),e.STATIC_DRAW),this.QUAD_COORD_BUFFER.itemSize=2,this.QUAD_COORD_BUFFER.numItems=6,this.nodesGeometry=ir(e,!1,!1)}drawScene(e,n){let r=this.width,i=this.height,a=this.gl,o=a.getExtension("ANGLE_instanced_arrays"),s=a.getParameter(a.FRAMEBUFFER_BINDING),u=a.getParameter(a.VIEWPORT);a.viewport(0,0,r*this.qualityScale,i*this.qualityScale),this.ortho(0,r,i,0),this.loadIdentity(),this.projectionMatrix=e,this.viewMatrix=n,a.bindFramebuffer(a.FRAMEBUFFER,this.FBO.id),a.clearColor(0,0,0,1),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE),a.useProgram(this.shaderProgram),this.setMatrixUniforms(this.shaderProgram),a.uniform1f(this.shaderProgram.bandwidthScaleUniform,this.bandwidthScale),a.uniformMatrix4fv(this.shaderProgram.viewMatrixUniform,!1,this.viewMatrix),a.uniformMatrix4fv(this.shaderProgram.projectionMatrixUniform,!1,this.projectionMatrix),a.uniform2f(this.shaderProgram.bandwidthUniform,this.bandwidth[0],this.bandwidth[1]),a.uniform1f(this.shaderProgram.kernel_weightScaleUniform,this.kernel_weightScale),a.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),a.enableVertexAttribArray(this.shaderProgram.vertexKernelWeightAttribute),a.enableVertexAttribArray(this.shaderProgram.vertexOffsetAttribute),a.bindBuffer(a.ARRAY_BUFFER,this.nodesGeometry.vertexObject),a.vertexAttribPointer(this.shaderProgram.vertexOffsetAttribute,3,a.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(this.shaderProgram.vertexOffsetAttribute,0),a.bindBuffer(a.ARRAY_BUFFER,this.kernelWeightsBuffer),a.vertexAttribPointer(this.shaderProgram.vertexKernelWeightAttribute,1,a.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(this.shaderProgram.vertexKernelWeightAttribute,1),a.bindBuffer(a.ARRAY_BUFFER,this.positionsBuffer),a.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,this.positionsBuffer.itemSize,a.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(this.shaderProgram.vertexPositionAttribute,1),this.nodesGeometry.indexObject?o.drawElementsInstancedANGLE(a.TRIANGLES,this.nodesGeometry.numIndices,this.nodesGeometry.indexType,0,this.positionsBuffer.numItems):o.drawArraysInstancedANGLE(a.TRIANGLE_STRIP,0,this.nodesGeometry.numIndices,this.positionsBuffer.numItems),o.vertexAttribDivisorANGLE(this.shaderProgram.vertexPositionAttribute,0),o.vertexAttribDivisorANGLE(this.shaderProgram.vertexKernelWeightAttribute,0),a.bindFramebuffer(a.FRAMEBUFFER,s),a.disableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),a.disableVertexAttribArray(this.shaderProgram.vertexKernelWeightAttribute),a.disableVertexAttribArray(this.shaderProgram.vertexOffsetAttribute),a.disable(a.BLEND),a.viewport(u[0],u[1],u[2],u[3]),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.FBO.tex),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this.LUT_TEX),a.useProgram(this.lutShader),a.enableVertexAttribArray(this.lutShader.vertexAttribute),a.enableVertexAttribArray(this.lutShader.texCoordAttribute),a.uniform1i(this.lutShader.input_texUniform,0),a.uniform1i(this.lutShader.lut_texUniform,1),a.uniform1f(this.lutShader.divergingUniform,+this._divergingColormap),this.ortho(0,1,0,1),this.loadIdentity(),this.setMatrixUniforms(this.lutShader),a.bindBuffer(a.ARRAY_BUFFER,this.QUAD_POS_BUFFER),a.vertexAttribPointer(this.lutShader.vertexAttribute,this.QUAD_POS_BUFFER.itemSize,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.QUAD_COORD_BUFFER),a.vertexAttribPointer(this.lutShader.texCoordAttribute,this.QUAD_COORD_BUFFER.itemSize,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLES,0,this.QUAD_POS_BUFFER.numItems),a.disableVertexAttribArray(this.lutShader.vertexAttribute),a.disableVertexAttribArray(this.lutShader.texCoordAttribute)}resize(e,n,r=!1){(this.width!==e||this.height!==n||r)&&(e>0&&(this.width=e),n>0&&(this.height=n),this.deleteFBO(),this.create_FBO())}create_FBO(){let e=this.width*this.qualityScale,n=this.height*this.qualityScale,r=this.gl;try{var i=r.getExtension("OES_texture_float"),a=r.getExtension("OES_texture_float_linear")}catch{var i=!1,a=!1}let o={};o.id=r.createFramebuffer(),o.tex=r.createTexture(),r.bindTexture(r.TEXTURE_2D,o.tex),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),i&&a?(de("[ OK ] Floating point textures (OES_texture_float) is supported"),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,n,0,r.RGBA,r.FLOAT,null)):(de("[FAIL] Floating point textures (OES_texture_float) is <B>NOT</B> supported, falling back to 8 bit blending. OES_texture_float is supported in Chrome dev version."),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,n,0,r.RGBA,r.UNSIGNED_BYTE,null)),r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,o.id),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o.tex,0);let s=r.checkFramebufferStatus(r.FRAMEBUFFER);s==r.FRAMEBUFFER_COMPLETE?de("[ OK ] Framebuffer Initialization"):s==r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT?de("[FAIL] Framebuffer Creation FAIL GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT <br/>               Not all framebuffer attachment points are framebuffer attachment complete."):s==r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS?de("[FAIL] Framebuffer Creation FAIL GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS <br/>               Not all attached images have the same width and height. "):s==r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT?de("[FAIL] Framebuffer Creation FAIL GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT <br/> No images are attached to the framebuffer. "):s==r.FRAMEBUFFER_INCOMPLETE_UNSUPPORTED?de("[FAIL] Framebuffer Creation FAIL GL_FRAMEBUFFER_INCOMPLETE_UNSUPPORTED <br/> The combination of internal formats of the attached images violates an implementation-dependent set of restrictions."):s==r.FRAMEBUFFER_UNSUPPORTED?de("[FAIL] Framebuffer Creation FAIL GL_FRAMEBUFFER_UNSUPPORTED <br/>             The combination of internal formats of the attached images violates an implementation-dependent set of restrictions."):de("[FAIL] Framebuffer Creation FAIL Unknown Error"),r.bindFramebuffer(r.FRAMEBUFFER,null),this.FBO=o}deleteFBO(){if(this.FBO){let e=this.gl;e.deleteFramebuffer(this.FBO.id),e.deleteTexture(this.FBO.tex)}}setBandwidth(e){this.bandwidthScale=e}setKernelWeightScale(e){this.kernel_weightScale=e}setColormap(e,n=0){self=this;let r=this.gl,i=r.createTexture();r.bindTexture(r.TEXTURE_2D,i),n<=0&&(n=1024),e||(e=sl);var a=new Uint8Array(n*4);for(let o=0;o<n;o++){let s=o/(n-1),u=ze(e(s));a[o*4+0]=u.r,a[o*4+1]=u.g,a[o*4+2]=u.b,a[o*4+3]=.1}r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n,1,0,r.RGBA,r.UNSIGNED_BYTE,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.bindTexture(r.TEXTURE_2D,null),this.LUT_TEX=i}setData(e){this.DATA=e,this.updateTheDatabuffer()}setWeights(e){this.kernel_weights=e,this.updateTheKernelWeightsBuffer()}update_span(){for(let e=0;e<this.DATA.length;e+=1)this.DATA[e][0],this.DATA[e][1]}updateTheDatabuffer(){let e=this.gl;this.positionsBuffer||(this.positionsBuffer=e.createBuffer(),this.positionsBuffer.itemSize=3),e.bindBuffer(e.ARRAY_BUFFER,this.positionsBuffer),e.bufferData(e.ARRAY_BUFFER,this.DATA,e.DYNAMIC_DRAW),this.positionsBuffer.numItems=this.DATA.length/3,this.update_span()}updateTheKernelWeightsBuffer(){let e=this.gl;this.kernelWeightsBuffer||(this.kernelWeightsBuffer=e.createBuffer(),this.kernelWeightsBuffer.itemSize=1),e.bindBuffer(e.ARRAY_BUFFER,this.kernelWeightsBuffer),e.bufferData(e.ARRAY_BUFFER,this.kernel_weights,e.DYNAMIC_DRAW),this.kernelWeightsBuffer.numItems=this.kernel_weights.length}qualityScale(e){return e===void 0?this.quality_scale:(this.quality_scale!=e&&(this.quality_scale=e,this.resize(0,0,!0)),this)}divergingColormap(e){return e===void 0?this._divergingColormap:(this._divergingColormap!=e&&(this._divergingColormap=e,console.log("DIVERGING COLORMAP",e)),this)}cleanup(){let e=this.gl;e.deleteBuffer(this.positionsBuffer),e.deleteBuffer(this.kernelWeightsBuffer),e.deleteTexture(this.LUT_TEX),e.deleteProgram(this.program),e.deleteFramebuffer(this.framebuffer),e.deleteRenderbuffer(this.renderbuffer),e.deleteTexture(this.texture),this.positionsBuffer=null,this.kernelWeightsBuffer=null,this.LUT_TEX=null,this.program=null,this.framebuffer=null,this.renderbuffer=null,this.texture=null,this.DATA=null,this.kernel_weights=null,this.BUFFER_LIST=null,this.gl=null}}function gl(t,e=n=>n.key){var n=[];return sn(t,"",!0,r=>n.push(r),e),n.join("")}function sn(t,e,n,r,i){if(t){r(`${e}${n?" ":" "}${i(t)}
`);const a=e+(n?"    ":"   ");t.left&&sn(t.left,a,!1,r,i),t.right&&sn(t.right,a,!0,r,i)}}function on(t){if(t===null)return!0;var e=It(t.left),n=It(t.right);return!!(Math.abs(e-n)<=1&&on(t.left)&&on(t.right))}function It(t){return t?1+Math.max(It(t.left),It(t.right)):0}function ln(t,e,n,r,i){const a=i-r;if(a>0){const o=r+Math.floor(a/2),s=e[o],u=n[o],f={key:s,data:u,parent:t};return f.left=ln(f,e,n,r,o),f.right=ln(f,e,n,o+1,i),f}return null}function un(t){if(t===null)return 0;const e=un(t.left),n=un(t.right);return t.balanceFactor=e-n,Math.max(e,n)+1}function fn(t,e,n,r,i){if(n>=r)return;const a=t[n+r>>1];let o=n-1,s=r+1;for(;;){do o++;while(i(t[o],a)<0);do s--;while(i(t[s],a)>0);if(o>=s)break;let u=t[o];t[o]=t[s],t[s]=u,u=e[o],e[o]=e[s],e[s]=u}fn(t,e,n,s,i),fn(t,e,s+1,r,i)}function vl(t,e){return t>e?1:t<e?-1:0}function Bt(t){var e=t.right;return t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent,e.parent&&(e.parent.left===t?e.parent.left=e:e.parent.right=e),t.parent=e,e.left=t,t.balanceFactor+=1,e.balanceFactor<0&&(t.balanceFactor-=e.balanceFactor),e.balanceFactor+=1,t.balanceFactor>0&&(e.balanceFactor+=t.balanceFactor),e}function Ft(t){var e=t.left;return t.left=e.right,t.left&&(t.left.parent=t),e.parent=t.parent,e.parent&&(e.parent.left===t?e.parent.left=e:e.parent.right=e),t.parent=e,e.right=t,t.balanceFactor-=1,e.balanceFactor>0&&(t.balanceFactor-=e.balanceFactor),e.balanceFactor-=1,t.balanceFactor<0&&(e.balanceFactor+=t.balanceFactor),e}class St{constructor(e,n=!1){this._comparator=e||vl,this._root=null,this._size=0,this._noDuplicates=!!n}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(e){if(this._root)for(var n=this._root,r=this._comparator;n;){var i=r(e,n.key);if(i===0)return!0;i<0?n=n.left:n=n.right}return!1}next(e){var n=e;if(n)if(n.right)for(n=n.right;n.left;)n=n.left;else for(n=e.parent;n&&n.right===e;)e=n,n=n.parent;return n}prev(e){var n=e;if(n)if(n.left)for(n=n.left;n.right;)n=n.right;else for(n=e.parent;n&&n.left===e;)e=n,n=n.parent;return n}forEach(e){for(var n=this._root,r=[],i=!1,a=0;!i;)n?(r.push(n),n=n.left):r.length>0?(n=r.pop(),e(n,a++),n=n.right):i=!0;return this}range(e,n,r,i){const a=[],o=this._comparator;let s=this._root,u;for(;a.length!==0||s;)if(s)a.push(s),s=s.left;else{if(s=a.pop(),u=o(s.key,n),u>0)break;if(o(s.key,e)>=0&&r.call(i,s))return this;s=s.right}return this}keys(){for(var e=this._root,n=[],r=[],i=!1;!i;)e?(n.push(e),e=e.left):n.length>0?(e=n.pop(),r.push(e.key),e=e.right):i=!0;return r}values(){for(var e=this._root,n=[],r=[],i=!1;!i;)e?(n.push(e),e=e.left):n.length>0?(e=n.pop(),r.push(e.data),e=e.right):i=!0;return r}at(e){for(var n=this._root,r=[],i=!1,a=0;!i;)if(n)r.push(n),n=n.left;else if(r.length>0){if(n=r.pop(),a===e)return n;a++,n=n.right}else i=!0;return null}minNode(){var e=this._root;if(!e)return null;for(;e.left;)e=e.left;return e}maxNode(){var e=this._root;if(!e)return null;for(;e.right;)e=e.right;return e}min(){var e=this._root;if(!e)return null;for(;e.left;)e=e.left;return e.key}max(){var e=this._root;if(!e)return null;for(;e.right;)e=e.right;return e.key}isEmpty(){return!this._root}pop(){var e=this._root,n=null;if(e){for(;e.left;)e=e.left;n={key:e.key,data:e.data},this.remove(e.key)}return n}popMax(){var e=this._root,n=null;if(e){for(;e.right;)e=e.right;n={key:e.key,data:e.data},this.remove(e.key)}return n}find(e){for(var n=this._root,r=n,i,a=this._comparator;r;){if(i=a(e,r.key),i===0)return r;i<0?r=r.left:r=r.right}return null}insert(e,n){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:e,data:n},this._size++,this._root;var r=this._comparator,i=this._root,a=null,o=0;if(this._noDuplicates)for(;i;){if(o=r(e,i.key),a=i,o===0)return null;o<0?i=i.left:i=i.right}else for(;i;)o=r(e,i.key),a=i,o<=0?i=i.left:i=i.right;var s={left:null,right:null,balanceFactor:0,parent:a,key:e,data:n},u;for(o<=0?a.left=s:a.right=s;a&&(o=r(a.key,e),o<0?a.balanceFactor-=1:a.balanceFactor+=1,a.balanceFactor!==0);){if(a.balanceFactor<-1){a.right.balanceFactor===1&&Ft(a.right),u=Bt(a),a===this._root&&(this._root=u);break}else if(a.balanceFactor>1){a.left.balanceFactor===-1&&Bt(a.left),u=Ft(a),a===this._root&&(this._root=u);break}a=a.parent}return this._size++,s}remove(e){if(!this._root)return null;for(var n=this._root,r=this._comparator,i=0;n&&(i=r(e,n.key),i!==0);)i<0?n=n.left:n=n.right;if(!n)return null;var a=n.key,o,s;if(n.left){for(o=n.left;o.left||o.right;){for(;o.right;)o=o.right;n.key=o.key,n.data=o.data,o.left&&(n=o,o=o.left)}n.key=o.key,n.data=o.data,n=o}if(n.right){for(s=n.right;s.left||s.right;){for(;s.left;)s=s.left;n.key=s.key,n.data=s.data,s.right&&(n=s,s=s.right)}n.key=s.key,n.data=s.data,n=s}for(var u=n.parent,f=n,l;u&&(u.left===f?u.balanceFactor-=1:u.balanceFactor+=1,u.balanceFactor<-1?(u.right.balanceFactor===1&&Ft(u.right),l=Bt(u),u===this._root&&(this._root=l),u=l):u.balanceFactor>1&&(u.left.balanceFactor===-1&&Bt(u.left),l=Ft(u),u===this._root&&(this._root=l),u=l),!(u.balanceFactor===-1||u.balanceFactor===1));)f=u,u=u.parent;return n.parent&&(n.parent.left===n?n.parent.left=null:n.parent.right=null),n===this._root&&(this._root=null),this._size--,a}load(e=[],n=[],r){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const i=e.length;return r&&fn(e,n,0,i-1,this._comparator),this._root=ln(null,e,n,0,i),un(this._root),this._size=i,this}isBalanced(){return on(this._root)}toString(e){return gl(this._root,e)}}St.default=St;class ml{constructor(e=!0){this.map=new Map,this.ascending=e,this.ascending?this.tree=new St((n,r)=>n.key===r.key?0:n.value===r.value?n.key<r.key?-1:1:n.value-r.value):this.tree=new St((n,r)=>n.key===r.key?0:n.value===r.value?n.key<r.key?-1:1:r.value-n.value)}set(e,n){if(this.map.has(e)){const r=this.map.get(e);this.tree.remove({key:e,value:r})}this.map.set(e,n),this.tree.insert({key:e,value:n})}delete(e){if(this.map.has(e)){const n=this.map.get(e);this.map.delete(e),this.tree.remove({key:e,value:n})}}get(e){return this.map.get(e)}getSortedKeys(){return this.tree.keys().map(e=>e.key)}getSortedPairs(){return this.tree.keys().map(e=>[e.key,e.value])}}let pl=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);function _l(t,e=250){let n=!1;return(...r)=>{n||(t(...r),n=!0,setTimeout(()=>{n=!1},e))}}class Al{constructor({element:e=null,elementID:n=null,density:r=!1,nodes:i={},edges:a=[],network:o=null,use2D:s=!1,orthographic:u=!1,hyperbolic:f=!1,fastEdges:l=!1,tracking:h=!0,fieldOfView:c=70,forceSupersample:d=!1,autoStartLayout:v=!0,autoCleanup:g=!0,webglOptions:m={},behaviors:y={}}){if(this._element=null,e==null?this._element=document.getElementById(n):this._element=e,this._element.innerHTML="",getComputedStyle(this._element).position==="static"&&(this._element.style.position="relative"),this._setupLayers(),o==null?this.network=new bo(i,a):this.network=o,this._settings={},this._camera={},this._status={},this._tracking={},this._behaviors=y,this._settings.autoCleanup=g,this._status.hasCleanup=!1,this._camera.rotationMatrix=Ve(),this._camera.translatePosition=gt(),this._camera.lastTranslatePosition=gt(),this._camera.targetTranslatePosition=gt(),this._camera.lastPanX=0,this._camera.lastPanY=0,this._camera.panX=0,this._camera.panY=0,this._camera.fieldOfView=c,this._camera.targetPanX=0,this._camera.targetPanY=0,this._camera.translateTime=0,this._camera.translateDuration=0,this._camera.cameraDistance=500,this._camera.zoomFactor=1,this._status.mouseDown=!1,this._status.lastMouseX=null,this._status.lastMouseY=null,this._status.redrawingFromMouseWheelEvent=!1,this._status.interacting=!1,this._settings.fastEdges=l,this._settings.shadedNodes=!1,this._settings.forceSupersample=d,this._settings.pickingResolutionRatio=.25,this._tracking.maxPixels=2e4,this._tracking.bufferEnabled=h,this._tracking.buffer=null,this._tracking.bufferTexture=null,this._tracking.bufferPixels=null,this._tracking.nodeDataMinimumUpdateInterval=200,this._tracking.nodeMinimumUpdateInterval=1e3/30,this._tracking.trackers={},this._updateTrackerNodesDataThrottle=_l(()=>{this._updateTrackerNodesData()},this._tracking.nodeDataMinimumUpdateInterval),this._lastCanvasDimensions=[this._canvasElement.clientWidth,this._canvasElement.clientHeight],this._settings.semanticZoomExponent=.25,this._settings.nodesGlobalOpacityScale=1,this._settings.nodesGlobalOpacityBase=0,this._settings.nodesGlobalSizeScale=1,this._settings.nodesGlobalSizeBase=0,this._settings.edgesGlobalOpacityScale=1,this._settings.edgesGlobalOpacityBase=0,this._settings.edgesGlobalWidthScale=.25,this._settings.edgesGlobalWidthBase=0,this._settings.nodesGlobalOutlineWidthScale=1,this._settings.nodesGlobalOutlineWidthBase=0,this._settings.edgesColorsFromNodes=!0,this._settings.edgesWidthFromNodes=!0,this._settings.backgroundColor=[.5,.5,.5,1],this._settings.use2D=s||f,this._settings.orthographic=u||s,this._settings.hyperbolic=f,this._settings.autoStartLayout=v,this._settings.useAdditiveBlending=!1,this._settings.pickeableEdges=new Set,this._settings.webglOptions=m,this._scheduler=new xo(this,{throttle:!1}),this._settings.use2D)for(let x=0;x<this.network.positions.length;x++)this.network.positions[x*3+2]=0;this._status.edgeIndicesUpdate=!0,Zt(this._camera.rotationMatrix),this.gl=uo(this._canvasElement,this._settings.webglOptions),r&&(this.densityMap=new dl(this.gl,this._canvasElement.clientWidth,this._canvasElement.clientHeight),this.densityMap.setBandwidth(10),this.densityMap.setKernelWeightScale(.01),this.densityPlot=!0),this._centerNodes=[],this._centerNodesTransition=null,this.onNodeClickCallback=null,this.onNodeDoubleClickCallback=null,this.onNodeHoverStartCallback=null,this.onNodeHoverMoveCallback=null,this.onNodeHoverEndCallback=null,this.onEdgeClickCallback=null,this.onEdgeDoubleClickCallback=null,this.onEdgeHoverStartCallback=null,this.onEdgeHoverMoveCallback=null,this.onEdgeHoverEndCallback=null,this.onZoomCallback=null,this.onRotationCallback=null,this.onResizeCallback=null,this.onLayoutStartCallback=null,this.onLayoutStopCallback=null,this.onDrawCallback=null,this.onReadyCallback=null,this.onCleanupCallback=null,this._isReady=!1,this._onresizeEvent=x=>{if(this._canvasElement)for(let p of x)this._willResizeEvent(p)},this.resizeObserver=new ResizeObserver(this._onresizeEvent),this.resizeObserver.observe(this._canvasElement),this._initialize()}_setupLayers(){this._canvasElement=document.createElement("canvas"),this._canvasElement.style.position="absolute",this._canvasElement.style.width="100%",this._canvasElement.style.height="100%",this._canvasElement.style.display="block",this._canvasElement.style.boxSizing="border-box",this._element.appendChild(this._canvasElement),this._svgLayer=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svgLayer.style.position="absolute",this._svgLayer.style.width="100%",this._svgLayer.style.height="100%",this._svgLayer.style.display="block",this._svgLayer.style.boxSizing="border-box",this._svgLayer.style.pointerEvents="none",this._element.appendChild(this._svgLayer),this._canvasMargins={top:0,bottom:0,left:0,right:0},this._overlay=document.createElement("div"),this._overlay.style.position="absolute",this._overlay.style.width="100%",this._overlay.style.height="100%",this._overlay.style.display="block",this._overlay.style.boxSizing="border-box",this._overlay.style.pointerEvents="none",this._element.appendChild(this._overlay)}get scheduler(){return this._scheduler}get svgLayer(){return this._svgLayer}get overlay(){return this._overlay}get element(){return this._element}get canvasElement(){return this._canvasElement}_initialize(){this._setupDensity(),this._setupShaders(),this._buildNodesGeometry(),this._buildPickingBuffers(),this._buildTrackingBuffers(),this._buildEdgesGeometry(),this._willResizeEvent(0),this._setupCamera(),this._setupEvents(),this._setupLayout(),this._setupBehaviors(),this._scheduler.start(),this.onReadyCallback?.(this),this.onReadyCallback=null,this._isReady=!0}_setupLayout(){this._layoutLastUpdate=null,this._alpha=.001,this.newPositions=this.network.positions.slice(0);let e=i=>{this.newPositions=i.positions,this._layoutLastUpdate||(this._layoutLastUpdate=performance.now());let a=performance.now()-this._layoutLastUpdate;a<200?a=200:a>2500&&(a=2500),this._alpha=1/a;let o={name:"1.1.positionInterpolator",callback:(s,u)=>{let f=0;const l=this._alpha,h=this.network.positions.length,c=this.newPositions,d=this.network.positions;for(let v=0;v<h;v++){const g=c[v]-d[v];d[v]+=l*g*s,f=Math.max(Math.abs(g),f)}this._updateCenterNodesPosition(),this._updateCameraInterpolation(!0),f<1&&this._scheduler.unschedule("1.1.positionInterpolator")},delay:0,repeat:!0,synchronized:!0,immediateUpdates:!1,redraw:!0,updateNodesGeometry:!0,updateEdgesGeometry:!0};this._scheduler.schedule({name:"1.0.positionChange",callback:(s,u)=>{this._scheduler.schedule(o)},delay:0,repeat:!1,synchronized:!0,immediateUpdates:!1,redraw:!1,updateNodesGeometry:!1,updateEdgesGeometry:!1})},n=()=>{this.onLayoutStopCallback?.()},r=()=>{this._layoutLastUpdate=null,this.onLayoutStartCallback?.()};this.layoutWorker=new Bo({network:this.network,onUpdate:e,onStop:n,onStart:r,use2D:this._settings.use2D}),console.log("Set layout worker",this.layoutWorker),this._settings.autoStartLayout&&(this.layoutWorker.start(),console.log("Start",this.layoutWorker))}_setupDensity(){if(this.densityMap){this.densityWeights=new Float32Array(this.network.nodeCount);let e=1;for(let n=0;n<this.network.nodeCount;n++){let r=this.network.nodes[n].edges.length;this.densityWeights[n]=r,e=Math.max(e,r)}for(let n=0;n<this.network.nodeCount;n++)this.densityWeights[n]/=e}}_setupBehaviors(){for(let e in this.behaviors){const n=this.behaviors[e];typeof n=="function"?n(this):n.setup?.(this)}}pauseLayout(){return this.layoutWorker.pause(),console.log("Pause",this.layoutWorker),this}resumeLayout(){return this.layoutWorker.resume(),console.log("Resume",this.layoutWorker),this}_callEventFromPickID(e,n,r){let i=null,a=!0;if(e>=0){if(e<this.network.nodeCount)a=!0,i=this.network.indexedNodes[e];else if(e>=this.network.nodeCount){let o=e-this.network.nodeCount;if(o<this.network.indexedEdges.length/2){let s={source:this.network.indexedNodes[this.network.indexedEdges[2*o]],target:this.network.indexedNodes[this.network.indexedEdges[2*o+1]],index:o};a=!1,i=s}}}if(i)switch(n){case"click":{a?this.onNodeClickCallback?.(i,r):this.onEdgeClickCallback?.(i,r);break}case"doubleClick":{a?this.onNodeDoubleClickCallback?.(i,r):this.onEdgeDoubleClickCallback?.(i,r);break}case"hoverStart":{a?this.onNodeHoverStartCallback?.(i,r):this.onEdgeHoverStartCallback?.(i,r);break}case"hoverMove":{a?this.onNodeHoverMoveCallback?.(i,r):this.onEdgeHoverMoveCallback?.(i,r);break}case"hoverEnd":{a?this.onNodeHoverEndCallback?.(i,r):this.onEdgeHoverEndCallback?.(i,r);break}}}_setupEvents(){this._status.lastMouseX=-1,this._status.lastMouseY=-1,this.currentHoverIndex=-1,this._settings.autoCleanup&&(this._mutationObserver=new MutationObserver(e=>{for(let n=0;n<e.length;n++){let r=e[n];if(r.type=="childList"&&r.removedNodes.length>0)for(let i=0;i<r.removedNodes.length;i++){let a=r.removedNodes[i];if(a==this._canvasElement||a==this._element){this._mutationObserver.disconnect(),this.cleanup();return}}}}),this._mutationObserver.observe(this._element,{childList:!0}),this._mutationObserver.observe(this._element.parentNode,{childList:!0})),this._clickEventListener=e=>{const n=this._canvasElement.getBoundingClientRect();this._status.lastMouseX=e.clientX,this._status.lastMouseY=e.clientY;const r=this.pickPoint(this._status.lastMouseX-n.left,this._status.lastMouseY-n.top);r>=0?this._callEventFromPickID(r,"click",e):(this.onNodeClickCallback?.(null,e),this.onEdgeClickCallback?.(null,e))},this._doubleClickEventListener=e=>{const n=this._canvasElement.getBoundingClientRect();this._status.lastMouseX=e.clientX,this._status.lastMouseY=e.clientY;const r=this.pickPoint(this._status.lastMouseX-n.left,this._status.lastMouseY-n.top);r>=0?this._callEventFromPickID(r,"doubleClick",e):(this.onNodeDoubleClickCallback?.(null,e),this.onEdgeDoubleClickCallback?.(null,e))},this._hoverMoveEventListener=e=>{this._status.lastMouseX=e.clientX,this._status.lastMouseY=e.clientY,this.triggerHoverEvents(e)},this._hoverLeaveEventListener=e=>{this.currentHoverIndex>=0&&(this._callEventFromPickID(this.currentHoverIndex,"hoverEnd",e),this.currentHoverIndex=-1,this._status.lastMouseX=-1,this._status.lastMouseY=-1)},this._hoverLeaveWindowEventListener=e=>{!e.relatedTarget&&!e.toElement&&this.currentHoverIndex>=0&&(this._callEventFromPickID(this.currentHoverIndex,"hoverEnd",e),this.currentHoverIndex=-1,this._status.lastMouseX=-1,this._status.lastMouseY=-1)},this._canvasElement.addEventListener("click",this._clickEventListener),this._canvasElement.addEventListener("dblclick",this._doubleClickEventListener),this._canvasElement.addEventListener("mousemove",this._hoverMoveEventListener),this._canvasElement.addEventListener("mouseleave",this._hoverLeaveEventListener),document.body.addEventListener("mouseout",this._hoverLeaveWindowEventListener)}async _downloadImageData(e,n,r,i=1){let a=new ko({}),o=document.createElement("canvas"),s=document.createElement("canvas"),u=o.getContext("2d"),f=s.getContext("2d");s.width=e.width,s.height=e.height,console.log(e.width,e.height,r,i),o.width=e.width/r,o.height=e.height/r,u.imageSmoothingEnabled=!0,f.imageSmoothingEnabled=!0,typeof u.imageSmoothingQuality<"u"&&(u.imageSmoothingQuality="high"),typeof f.imageSmoothingQuality<"u"&&(f.imageSmoothingQuality="high"),f.putImageData(e,0,0),f.transform(1,0,0,-1,0,s.height),f.globalCompositeOperation="copy",f.drawImage(f.canvas,0,0),f.globalCompositeOperation="source-over",await a.resize(s,o,{alpha:!0});let l=document.createElement("a");pl&&o.toDataURL(),l.setAttribute("download",n);let h=await a.toBlob(o,"image/png");if(h)if(n.endsWith("svg")){let c=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="${o.width/i}" height="${o.height/i}" viewBox="0 0 ${o.width/i} ${o.height/i}" ><image width="${o.width/i}" height="${o.height/i}" xlink:href="${o.toDataURL()}" />`,d=this._svgLayer.innerHTML;c+=d,c+="</svg>",l.setAttribute("download",n);let v=new Blob([c],{type:"image/svg+xml"}),g=URL.createObjectURL(v);l.setAttribute("href",g),l.click()}else{let c=URL.createObjectURL(h);l.setAttribute("href",c),l.click()}else window.alert("An error occured while trying to download the image. Please try again. (Error: blob is null.)")}_framebufferImage(e){const n=e.size.width,r=e.size.height,i=new Uint8ClampedArray(4*n*r),a=this.gl;return a.bindFramebuffer(a.FRAMEBUFFER,e),a.readPixels(0,0,n,r,a.RGBA,a.UNSIGNED_BYTE,i),new ImageData(i,n,r)}exportFigure(e,{scale:n,supersampleFactor:r,width:i=null,height:a=null,backgroundColor:o=null}){typeof n>"u"&&(n=1),typeof r>"u"&&(r=2);let s=this._createOffscreenFramebuffer();i==null&&a==null?(i=this._canvasElement.clientWidth,a=this._canvasElement.clientHeight):i?a||(a=Math.round(i*this._canvasElement.height/this._canvasElement.width)):i=Math.round(a*this._canvasElement.width/this._canvasElement.height),o||(o=this.backgroundColor),s.setSize(Math.round(i*n*r),Math.round(a*n*r)),s.backgroundColor=o,this._redrawAll(s);let u=this._framebufferImage(s);this._downloadImageData(u,e,r,n),s.discard()}triggerHoverEvents(e,n){if(!this._isReady||this._status.lastMouseX==-1||this._status.lastMouseY==-1)return;let r=-1;if(!this._status.interacting){const i=this._canvasElement.getBoundingClientRect();r=this.pickPoint(this._status.lastMouseX-i.left,this._status.lastMouseY-i.top)}r>=0&&this.currentHoverIndex==-1?(this.currentHoverIndex=r,this._callEventFromPickID(r,"hoverStart",e)):r>=0&&this.currentHoverIndex==r?this._callEventFromPickID(r,"hoverMove",e):r>=0&&this.currentHoverIndex!=r?(this._callEventFromPickID(this.currentHoverIndex,"hoverEnd",e),this.currentHoverIndex=r,this._callEventFromPickID(r,"hoverStart",e)):r==-1&&this.currentHoverIndex!=r&&(this._callEventFromPickID(this.currentHoverIndex,"hoverEnd",e),this.currentHoverIndex=-1)}_setupShaders(){const e=this.gl;this.edgesShaderProgram=new Se(J(e,this._settings.hyperbolic?fr:ur,e.VERTEX_SHADER),J(e,Fo,e.FRAGMENT_SHADER),["viewMatrix","projectionMatrix","nearFar","globalOpacityScale","globalWidthScale","globalSizeScale","globalOpacityBase","globalWidthBase","globalSizeBase"],["fromVertex","toVertex","vertexType","fromColor","toColor","fromSize","toSize","encodedIndex"],this.gl),this.edgesFastShaderProgram=new Se(J(e,this._settings.hyperbolic?Ro:Mo,e.VERTEX_SHADER),J(e,To,e.FRAGMENT_SHADER),["projectionViewMatrix","nearFar","globalOpacityScale","globalOpacityBase"],["vertex","color"],this.gl),this.edgesPickingShaderProgram=new Se(J(e,this._settings.hyperbolic?fr:ur,e.VERTEX_SHADER),J(e,So,e.FRAGMENT_SHADER),["viewMatrix","projectionMatrix","nearFar","globalOpacityScale","globalWidthScale","globalSizeScale","globalOpacityBase","globalWidthBase","globalSizeBase"],["fromVertex","toVertex","vertexType","fromColor","toColor","fromSize","toSize","encodedIndex"],this.gl),this.nodesShaderProgram=new Se(J(e,this._settings.hyperbolic?tn:en,e.VERTEX_SHADER),J(e,No,e.FRAGMENT_SHADER),["viewMatrix","projectionMatrix","normalMatrix","globalOpacityScale","globalSizeScale","globalOutlineWidthScale","globalOpacityBase","globalSizeBase","globalOutlineWidthBase"],["vertex","position","color","size","outlineWidth","outlineColor","encodedIndex"],this.gl),this.nodesFastShaderProgram=new Se(J(e,this._settings.hyperbolic?tn:en,e.VERTEX_SHADER),J(e,Po,e.FRAGMENT_SHADER),["viewMatrix","projectionMatrix","normalMatrix","globalOpacityScale","globalSizeScale","globalOutlineWidthScale","globalOpacityBase","globalSizeBase","globalOutlineWidthBase"],["vertex","position","color","size","outlineWidth","outlineColor","encodedIndex"],this.gl),this.nodesPickingShaderProgram=new Se(J(e,this._settings.hyperbolic?tn:en,e.VERTEX_SHADER),J(e,Oo,e.FRAGMENT_SHADER),["viewMatrix","projectionMatrix","normalMatrix","globalOpacityScale","globalSizeScale","globalOutlineWidthScale","globalOpacityBase","globalSizeBase","globalOutlineWidthBase"],["vertex","position","color","size","outlineWidth","outlineColor","encodedIndex"],this.gl)}_buildPickingBuffers(){this.gl,this.pickingFramebuffer=this._createOffscreenFramebuffer()}_buildTrackingBuffers(){this.gl,this._tracking.bufferEnabled&&(this._trackingFramebuffer=this._createOffscreenFramebuffer())}_createOffscreenFramebuffer(){const e=this.gl;let n=e.createFramebuffer();n.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,n.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n.depthBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,n.depthBuffer),e.bindFramebuffer(e.FRAMEBUFFER,n),n.size={width:0,height:0},n.setSize=(a,o)=>{e.bindTexture(e.TEXTURE_2D,n.texture);const s=0,u=e.RGBA,f=0,l=e.RGBA,h=e.UNSIGNED_BYTE,c=null,d=a,v=o;e.texImage2D(e.TEXTURE_2D,s,u,d,v,f,l,h,c),e.bindRenderbuffer(e.RENDERBUFFER,n.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,d,v),n.size.width=a,n.size.height=o},n.discard=()=>{e.deleteRenderbuffer(n.depthBuffer),e.deleteTexture(n.texture),e.deleteFramebuffer(n)};const r=e.COLOR_ATTACHMENT0,i=0;return e.framebufferTexture2D(e.FRAMEBUFFER,r,e.TEXTURE_2D,n.texture,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,n.depthBuffer),n}_buildNodesGeometry(){const e=this.gl;this.nodesGeometry=ir(e,!1,!1),this.nodesPositionBuffer=e.createBuffer(),this.nodesColorBuffer=e.createBuffer(),this.nodesSizeBuffer=e.createBuffer(),this.nodesOutlineWidthBuffer=e.createBuffer(),this.nodesOutlineColorBuffer=e.createBuffer(),this.nodesIndexBuffer=e.createBuffer(),this.nodesIndexArray=new Float32Array(this.network.indexedNodes.length*4);for(let n=0;n<this.network.indexedNodes.length;n++)this.nodesIndexArray[4*n]=(n+1>>0&255)/255,this.nodesIndexArray[4*n+1]=(n+1>>8&255)/255,this.nodesIndexArray[4*n+2]=(n+1>>16&255)/255,this.nodesIndexArray[4*n+3]=(n+1>>24&255)/255;e.bindBuffer(e.ARRAY_BUFFER,this.nodesIndexBuffer),e.bufferData(e.ARRAY_BUFFER,this.nodesIndexArray,e.STATIC_DRAW),this.updateNodesGeometry()}updateDensityMap(){let e=this.network.positions;return this.densityMap?.setData(e),this.densityMap?.setWeights(this.densityWeights),this}updateNodesGeometry(){const e=this.gl;let n=this.network.positions;this.updateDensityMap(),e.bindBuffer(e.ARRAY_BUFFER,this.nodesPositionBuffer),e.bufferData(e.ARRAY_BUFFER,n,e.DYNAMIC_DRAW);let r=this.network.colors;e.bindBuffer(e.ARRAY_BUFFER,this.nodesColorBuffer),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW);let i=this.network.sizes;e.bindBuffer(e.ARRAY_BUFFER,this.nodesSizeBuffer),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW);let a=this.network.outlineWidths;e.bindBuffer(e.ARRAY_BUFFER,this.nodesOutlineWidthBuffer),e.bufferData(e.ARRAY_BUFFER,a,e.STATIC_DRAW);let o=this.network.outlineColors;return e.bindBuffer(e.ARRAY_BUFFER,this.nodesOutlineColorBuffer),e.bufferData(e.ARRAY_BUFFER,o,e.STATIC_DRAW),this}_buildFastEdgesGeometry(){const e=this.gl;let n=this.network.indexedEdges,r=this.network.positions;this.network.colors;let i;this.fastEdgesGeometry=null,this.fastEdgesIndicesArray=null;let a=new Object;if(r.length<65535)i=new Uint16Array(n),a.indexType=e.UNSIGNED_SHORT;else{var o=e.getExtension("OES_element_index_uint");o==null?(i=new Uint16Array(n),a.indexType=e.UNSIGNED_SHORT):(i=new Uint32Array(n),a.indexType=e.UNSIGNED_INT)}a.vertexObject=e.createBuffer(),a.colorObject=e.createBuffer(),a.numIndices=i.length,a.indexObject=e.createBuffer(),this.fastEdgesGeometry=a,this.fastEdgesIndicesArray=i}_buildAdvancedEdgesGeometry(){const e=this.gl;let n=[0,1,0,0,1,1,1,0],r=new Object;r.edgeVertexTypeBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r.edgeVertexTypeBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW),r.verticesBuffer=e.createBuffer(),r.colorBuffer=e.createBuffer(),r.sizeBuffer=e.createBuffer(),r.indexBuffer=e.createBuffer(),this.edgesGeometry=r,this.edgesGeometry.count=this.network.indexedEdges.length/2,this.edgesGeometry.edgesIndexArray=new Float32Array(this.network.indexedEdges.length*4/2),this._status.edgeIndicesUpdate=!0}_buildEdgesGeometry(){this._settings.fastEdges?this._buildFastEdgesGeometry():this._buildAdvancedEdgesGeometry(),this.updateEdgesGeometry()}_updateEdgeIndices(){if(this._status.edgeIndicesUpdate){const e=this.gl;for(let n=0;n<this.network.indexedEdges.length/2;n++){let r=this.network.indexedNodes.length+n;this._settings.pickeableEdges.has(n)?(this.edgesGeometry.edgesIndexArray[4*n]=(r+1>>0&255)/255,this.edgesGeometry.edgesIndexArray[4*n+1]=(r+1>>8&255)/255,this.edgesGeometry.edgesIndexArray[4*n+2]=(r+1>>16&255)/255,this.edgesGeometry.edgesIndexArray[4*n+3]=(r+1>>24&255)/255):(this.edgesGeometry.edgesIndexArray[4*n]=0,this.edgesGeometry.edgesIndexArray[4*n+1]=0,this.edgesGeometry.edgesIndexArray[4*n+2]=0,this.edgesGeometry.edgesIndexArray[4*n+3]=0)}e.bindBuffer(e.ARRAY_BUFFER,this.edgesGeometry.indexBuffer),e.bufferData(e.ARRAY_BUFFER,this.edgesGeometry.edgesIndexArray,e.DYNAMIC_DRAW),this._status.edgeIndicesUpdate=!1}}updateEdgesGeometry(){const e=this.gl;this.network.indexedEdges;let n=this.network.positions,r=this.network.colors;if(this._settings.fastEdges)this.fastEdgesGeometry||this._buildEdgesGeometry(),e.bindBuffer(e.ARRAY_BUFFER,this.fastEdgesGeometry.vertexObject),e.bufferData(e.ARRAY_BUFFER,n,e.STREAM_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.fastEdgesGeometry.colorObject),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.fastEdgesGeometry.indexObject),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.fastEdgesIndicesArray,e.STREAM_DRAW);else{const i=this.gl;this.network.updateEdgePositions(),this._settings.edgesColorsFromNodes&&this.network.updateEdgeColors(),this._settings.edgesWidthFromNodes&&this.network.updateEdgeSizes(),this._updateEdgeIndices(),this.network.positions,i.bindBuffer(i.ARRAY_BUFFER,this.edgesGeometry.verticesBuffer),i.bufferData(i.ARRAY_BUFFER,this.network.edgePositions,i.DYNAMIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this.edgesGeometry.colorBuffer),i.bufferData(i.ARRAY_BUFFER,this.network.edgeColors,i.DYNAMIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this.edgesGeometry.sizeBuffer),i.bufferData(i.ARRAY_BUFFER,this.network.edgeSizes,i.DYNAMIC_DRAW)}return this}_resizeGL(e,n){this._canvasElement.width=e,this._canvasElement.height=n,this.pickingFramebuffer.setSize(Math.round(e*this._settings.pickingResolutionRatio),Math.round(n*this._settings.pickingResolutionRatio)),this._lastCanvasDimensions=[this._canvasElement.clientWidth,this._canvasElement.clientHeight];let r=e/n;if(this._tracking.bufferEnabled){let i,a;r>1?(i=Math.sqrt(this._tracking.maxPixels*r),a=this._tracking.maxPixels/i):(a=Math.sqrt(this._tracking.maxPixels/r),i=this._tracking.maxPixels/a),this._trackingFramebuffer.setSize(Math.round(i),Math.round(a));let o=this._trackingFramebuffer.size.width*this._trackingFramebuffer.size.height;this._pixelXYOnScreen=Array(o),this._tracking.bufferPixels=new Uint8Array(4*o),this._nodesOnScreen=Array(o),this._nodesOnScreen.fill(-1);for(let s=0;s<this._pixelXYOnScreen.length;s++){let u=s%this._trackingFramebuffer.size.width/this._trackingFramebuffer.size.width*this._canvasElement.clientWidth,f=Math.floor(s/this._trackingFramebuffer.size.width)/this._trackingFramebuffer.size.height*this._canvasElement.clientHeight;this._pixelXYOnScreen[s]=[u,f]}}return this.densityPlot&&this.densityMap.resize(e,n),this.render(!0),this}_setupCamera(){this.zoom=eo().on("zoom",e=>{this._status.interacting=!0,this._camera.zoomFactor=e.transform.k,this.triggerHoverEvents(e),this.prevK===void 0&&(this.prevK=e.transform.k);let n=0,r=0;(this.prevK==e.transform.k||this._settings.use2D)&&(this.prevX===void 0||this._settings.use2D?this._settings.use2D?(n=e.transform.x-this._canvasElement.clientWidth/2,r=e.transform.y-this._canvasElement.clientHeight/2):(n=e.transform.x,r=e.transform.y):(n=e.transform.x-this.prevX*this._camera.zoomFactor,r=e.transform.y-this.prevY*this._camera.zoomFactor)),this._settings.use2D||(this.prevX=e.transform.x/this._camera.zoomFactor,this.prevY=e.transform.y/this._camera.zoomFactor),this.prevK=e.transform.k;let i=Ve();if(this._settings.use2D||e.sourceEvent?.shiftKey){const a=this._canvasElement.clientHeight,o=Math.PI*2/360*this._camera.fieldOfView,u=2*(this._camera.cameraDistance/this._camera.zoomFactor)*Math.tan(o/2)/a;this._centerNodes.length==0&&(this._settings.use2D?(this._camera.panX=n*u,this._camera.panY=-r*u):(this._camera.panX=this._camera.panX+n*u,this._camera.panY=this._camera.panY-r*u))}else Zt(i),nr(i,i,ar(n/2),[0,1,0]),nr(i,i,ar(r/2),[1,0,0]),Kt(this._camera.rotationMatrix,i,this._camera.rotationMatrix);this.update(),this.render(),e?.sourceEvent?.preventDefault(),e?.sourceEvent?.stopPropagation()}).on("end",e=>{this._status.interacting=!1,e?.sourceEvent?.preventDefault(),e?.sourceEvent?.stopPropagation()}),Z(this._canvasElement).call(this.zoom).on("dblclick.zoom",null)}zoomFactor(e,n){return e!==void 0?(n===void 0?this._settings.use2D?Z(this._canvasElement).call(this.zoom.transform,be.translate(this._canvasElement.clientWidth/2,this._canvasElement.clientHeight/2).scale(e)):Z(this._canvasElement).call(this.zoom.transform,be.translate(0,0).scale(e)):this._settings.use2D?Z(this._canvasElement).transition().ease(Ce).duration(n).call(this.zoom.transform,be.translate(this._canvasElement.clientWidth/2,this._canvasElement.clientHeight/2).scale(e)):Z(this._canvasElement).transition().ease(Ce).duration(n).call(this.zoom.transform,be.translate(0,0).scale(e)),this):this._camera.zoomFactor}semanticZoomExponent(e){return e!==void 0?(this._settings.semanticZoomExponent=e,this):this._settings.semanticZoomExponent}_willResizeEvent(e){let n=window.devicePixelRatio||1;(n<2||this._settings.forceSupersample)&&(n=n*2);let r=n*this._canvasElement.clientWidth,i=n*this._canvasElement.clientHeight;i==0&&(i=1),r==0&&(r=1),console.log(r,i),requestAnimationFrame(()=>{this._resizeGL(r,i)}),this._updateCameraInteraction(),this.onResizeCallback?.(e)}_updateCameraInteraction(){if(this.zoom&&this._settings.use2D){const e=this._canvasElement.clientHeight,n=Math.PI*2/360*this._camera.fieldOfView,i=2*(this._camera.cameraDistance/this._camera.zoomFactor)*Math.tan(n/2)/e;Z(this._canvasElement).property("__zoom",be.translate(this._camera.panX/i+this._lastCanvasDimensions[0]/2,-this._camera.panY/i+this._lastCanvasDimensions[1]/2).scale(this._camera.zoomFactor))}}redraw(){return this._redrawAll(null,"normal"),this._redrawAll(this.pickingFramebuffer,"picking"),this._tracking.bufferEnabled&&this._redrawAll(this._trackingFramebuffer,"tracking"),this.triggerHoverEvents(null),this._tracking.bufferEnabled&&this._updateTrackerNodesDataThrottle(),this.onDrawCallback?.(),this}update(e=!1,n=!0,r=!0){return this._scheduler.schedule({name:"9.0.update",callback:null,delay:0,repeat:!1,synchronized:!0,immediateUpdates:e,updateNodesGeometry:n,updateEdgesGeometry:r}),this}render(e=!1){return this._scheduler.schedule({name:"9.1.render",callback:null,delay:0,repeat:!1,synchronized:!0,immediateUpdates:e,redraw:!0}),this}_redrawPrepare(e,n,r){typeof n>"u"&&(n="normal");const i=this.gl,a=e?.size.width||this._canvasElement.width,o=e?.size.height||this._canvasElement.height;e==null?(i.bindFramebuffer(i.FRAMEBUFFER,null),i.clearColor(...this._settings.backgroundColor)):n!="normal"?(i.bindFramebuffer(i.FRAMEBUFFER,e),i.clearColor(0,0,0,0)):(i.bindFramebuffer(i.FRAMEBUFFER,e),typeof e.backgroundColor>"u"?i.clearColor(...this._settings.backgroundColor):i.clearColor(...e.backgroundColor)),typeof r>"u"?i.viewport(0,0,a,o):i.viewport(r),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.depthFunc(i.LEQUAL),this.projectionMatrix=Ve(),this.viewMatrix=Ve(),this.projectionViewMatrix=Ve();let s=Math.PI*2/360*this._camera.fieldOfView,u=a/o;if(this._settings.use2D||this._settings.orthographic){const f=this._camera.cameraDistance/this._camera.zoomFactor,l=2*f*Math.tan(s/2),h=l*u,c=-h/2,d=h/2,v=-l/2,g=l/2;oo(this.projectionMatrix,c,d,v,g,-100+f,1e4+f)}else ao(this.projectionMatrix,s,u,1,null);Zt(this.viewMatrix),tr(this.viewMatrix,this.viewMatrix,[this._camera.panX,this._camera.panY,-this._camera.cameraDistance/this._camera.zoomFactor]),Kt(this.viewMatrix,this.viewMatrix,this._camera.rotationMatrix),tr(this.viewMatrix,this.viewMatrix,this._camera.translatePosition),Kt(this.projectionViewMatrix,this.projectionMatrix,this.viewMatrix)}_redrawNodes(e,n){typeof n>"u"&&(n="normal");const r=this.gl;let i=r.getExtension("ANGLE_instanced_arrays"),a=1/Math.pow(this._camera.zoomFactor,this._settings.semanticZoomExponent);n!="normal"&&(a=1/Math.pow(this._camera.zoomFactor,.75*this._settings.semanticZoomExponent));let o;n=="normal"?(r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this._settings.shadedNodes?o=this.nodesShaderProgram:o=this.nodesFastShaderProgram):(r.disable(r.BLEND),o=this.nodesPickingShaderProgram),o.use(r),o.attributes.enable("vertex"),o.attributes.enable("position"),o.attributes.enable("size"),o.attributes.enable("outlineWidth"),o.attributes.enable("outlineColor"),o.attributes.enable("encodedIndex"),r.bindBuffer(r.ARRAY_BUFFER,this.nodesGeometry.vertexObject),r.vertexAttribPointer(o.attributes.vertex,3,r.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(o.attributes.vertex,0),this.nodesGeometry.indexObject&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.nodesGeometry.indexObject),r.uniformMatrix4fv(o.uniforms.projectionMatrix,!1,this.projectionMatrix),r.uniformMatrix4fv(o.uniforms.viewMatrix,!1,this.viewMatrix),r.uniform1f(o.uniforms.globalOpacityScale,this._settings.nodesGlobalOpacityScale),r.uniform1f(o.uniforms.globalOpacityBase,this._settings.nodesGlobalOpacityBase),r.uniform1f(o.uniforms.globalSizeScale,this._settings.nodesGlobalSizeScale*a),r.uniform1f(o.uniforms.globalSizeBase,this._settings.nodesGlobalSizeBase*a),r.uniform1f(o.uniforms.globalOutlineWidthScale,this._settings.nodesGlobalOutlineWidthScale*a),r.uniform1f(o.uniforms.globalOutlineWidthBase,this._settings.nodesGlobalOutlineWidthBase*a);let s=no();ro(s,this.viewMatrix),r.uniformMatrix3fv(o.uniforms.normalMatrix,!1,s),this.network.colors,this.network.positions,this.network.sizes,this.network.outlineWidths,r.bindBuffer(r.ARRAY_BUFFER,this.nodesPositionBuffer),r.enableVertexAttribArray(o.attributes.position),r.vertexAttribPointer(o.attributes.position,3,r.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(o.attributes.position,1),r.bindBuffer(r.ARRAY_BUFFER,this.nodesColorBuffer),r.enableVertexAttribArray(o.attributes.color),r.vertexAttribPointer(o.attributes.color,4,r.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(o.attributes.color,1),r.bindBuffer(r.ARRAY_BUFFER,this.nodesSizeBuffer),r.enableVertexAttribArray(o.attributes.size),r.vertexAttribPointer(o.attributes.size,1,r.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(o.attributes.size,1),r.bindBuffer(r.ARRAY_BUFFER,this.nodesOutlineColorBuffer),r.enableVertexAttribArray(o.attributes.outlineColor),r.vertexAttribPointer(o.attributes.outlineColor,4,r.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(o.attributes.outlineColor,1),r.bindBuffer(r.ARRAY_BUFFER,this.nodesOutlineWidthBuffer),r.enableVertexAttribArray(o.attributes.outlineWidth),r.vertexAttribPointer(o.attributes.outlineWidth,1,r.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(o.attributes.outlineWidth,1),r.bindBuffer(r.ARRAY_BUFFER,this.nodesIndexBuffer),r.enableVertexAttribArray(o.attributes.encodedIndex),r.vertexAttribPointer(o.attributes.encodedIndex,4,r.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(o.attributes.encodedIndex,1),this.nodesGeometry.indexObject?i.drawElementsInstancedANGLE(r.TRIANGLES,this.nodesGeometry.numIndices,this.nodesGeometry.indexType,0,this.network.positions.length/3):i.drawArraysInstancedANGLE(r.TRIANGLE_STRIP,0,this.nodesGeometry.numIndices,this.network.positions.length/3),o.attributes.disable("vertex"),o.attributes.disable("position"),o.attributes.disable("size"),o.attributes.disable("outlineWidth"),o.attributes.disable("outlineColor"),o.attributes.disable("encodedIndex")}_redrawEdges(e,n){typeof n>"u"&&(n="normal");let r=this.onEdgeClickCallback||this.onEdgeHoverMoveCallback||this.onEdgeHoverStartCallback||this.onEdgeHoverEndCallback||this.onEdgeDoubleClickCallback||this.onEdgeClickCallback;if(n!="normal"&&(this._settings.fastEdges||!r))return;let i=1/Math.pow(this._camera.zoomFactor,this._settings.semanticZoomExponent);n!="normal"&&(i=1/Math.pow(this._camera.zoomFactor,.5*this._settings.semanticZoomExponent));const a=this.gl;let o=a.getExtension("ANGLE_instanced_arrays"),s;n=="normal"?(a.enable(a.BLEND),this._settings.useAdditiveBlending?a.blendFunc(a.SRC_ALPHA,a.ONE):a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE),this._settings.fastEdges?s=this.edgesFastShaderProgram:s=this.edgesShaderProgram):(a.disable(a.BLEND),s=this.edgesPickingShaderProgram),this._settings.fastEdges?(s.use(a),s.attributes.enable("vertex"),s.attributes.enable("color"),a.bindBuffer(a.ARRAY_BUFFER,this.fastEdgesGeometry.vertexObject),a.vertexAttribPointer(s.attributes.vertex,3,a.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(s.attributes.vertex,0),a.bindBuffer(a.ARRAY_BUFFER,this.fastEdgesGeometry.colorObject),a.vertexAttribPointer(s.attributes.color,4,a.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(s.attributes.color,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.fastEdgesGeometry.indexObject),a.uniformMatrix4fv(s.uniforms.projectionViewMatrix,!1,this.projectionViewMatrix),a.uniform1f(s.uniforms.globalOpacityScale,this._settings.edgesGlobalOpacityScale),a.uniform1f(s.uniforms.globalOpacityBase,this._settings.edgesGlobalOpacityBase),a.drawElements(a.LINES,this.fastEdgesGeometry.numIndices,this.fastEdgesGeometry.indexType,0),s.attributes.disable("vertex"),s.attributes.disable("color")):(s.use(a),s.attributes.enable("fromVertex"),s.attributes.enable("toVertex"),s.attributes.enable("vertexType"),s.attributes.enable("fromColor"),s.attributes.enable("toColor"),s.attributes.enable("fromSize"),s.attributes.enable("toSize"),s.attributes.enable("encodedIndex"),a.bindBuffer(a.ARRAY_BUFFER,this.edgesGeometry.edgeVertexTypeBuffer),a.vertexAttribPointer(s.attributes.vertexType,2,a.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(s.attributes.vertexType,0),a.bindBuffer(a.ARRAY_BUFFER,this.edgesGeometry.verticesBuffer),a.vertexAttribPointer(s.attributes.fromVertex,3,a.FLOAT,!1,4*3*2,0),o.vertexAttribDivisorANGLE(s.attributes.fromVertex,1),a.bindBuffer(a.ARRAY_BUFFER,this.edgesGeometry.verticesBuffer),a.vertexAttribPointer(s.attributes.toVertex,3,a.FLOAT,!1,4*3*2,4*3),o.vertexAttribDivisorANGLE(s.attributes.toVertex,1),a.bindBuffer(a.ARRAY_BUFFER,this.edgesGeometry.colorBuffer),a.vertexAttribPointer(s.attributes.fromColor,4,a.FLOAT,!1,4*4*2,0),o.vertexAttribDivisorANGLE(s.attributes.fromColor,1),a.vertexAttribPointer(s.attributes.toColor,4,a.FLOAT,!1,4*4*2,4*4),o.vertexAttribDivisorANGLE(s.attributes.toColor,1),a.bindBuffer(a.ARRAY_BUFFER,this.edgesGeometry.sizeBuffer),a.vertexAttribPointer(s.attributes.fromSize,1,a.FLOAT,!1,4*2,0),o.vertexAttribDivisorANGLE(s.attributes.fromSize,1),a.vertexAttribPointer(s.attributes.toSize,1,a.FLOAT,!1,4*2,4),o.vertexAttribDivisorANGLE(s.attributes.toSize,1),a.bindBuffer(a.ARRAY_BUFFER,this.edgesGeometry.indexBuffer),a.enableVertexAttribArray(s.attributes.encodedIndex),a.vertexAttribPointer(s.attributes.encodedIndex,4,a.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(s.attributes.encodedIndex,1),a.uniformMatrix4fv(s.uniforms.projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(s.uniforms.viewMatrix,!1,this.viewMatrix),a.uniform1f(s.uniforms.globalOpacityScale,this._settings.edgesGlobalOpacityScale),a.uniform1f(s.uniforms.globalOpacityBase,this._settings.edgesGlobalOpacityBase),a.uniform1f(s.uniforms.globalWidthScale,this._settings.edgesGlobalWidthScale),a.uniform1f(s.uniforms.globalWidthBase,this._settings.edgesGlobalWidthBase),a.uniform1f(s.uniforms.globalSizeScale,this._settings.nodesGlobalSizeScale*i),a.uniform1f(s.uniforms.globalSizeBase,this._settings.nodesGlobalSizeBase*i),o.drawArraysInstancedANGLE(a.TRIANGLE_STRIP,0,4,this.edgesGeometry.count),s.attributes.disable("fromVertex"),s.attributes.disable("toVertex"),s.attributes.disable("vertexType"),s.attributes.disable("fromColor"),s.attributes.disable("toColor"),s.attributes.disable("fromSize"),s.attributes.disable("toSize"),s.attributes.disable("encodedIndex"))}_redrawAll(e,n){typeof n>"u"&&(n="normal");const r=this.gl;this._redrawPrepare(e,n),n=="normal"&&this.densityPlot&&(r.disable(this.gl.DEPTH_TEST),e?.size.width||this._canvasElement.width,e?.size.height||this._canvasElement.height,this.densityMap.drawScene(this.projectionMatrix,this.viewMatrix)),r.depthMask(!0),this._settings.use2D?(r.disable(r.DEPTH_TEST),r.depthMask(!1),n!="tracking"&&this._settings.edgesGlobalOpacityScale>0&&this._redrawEdges(e,n),this._redrawNodes(e,n)):(r.enable(r.DEPTH_TEST),this._redrawNodes(e,n),r.depthMask(!1),n!="tracking"&&this._settings.edgesGlobalOpacityScale>0&&this._redrawEdges(e,n),r.depthMask(!0))}_updateCenterNodesPosition(){if(this._camera.targetTranslatePosition[0]=0,this._camera.targetTranslatePosition[1]=0,this._camera.targetTranslatePosition[2]=0,this._centerNodes&&this._centerNodes.length>0){for(let n=0;n<this._centerNodes.length;n++){let i=this._centerNodes[n].position;this._camera.targetTranslatePosition[0]-=i[0],this._camera.targetTranslatePosition[1]-=i[1],this._camera.targetTranslatePosition[2]-=i[2]}let e=this._centerNodes.length;this._camera.targetTranslatePosition[0]/=e,this._camera.targetTranslatePosition[1]/=e,this._camera.targetTranslatePosition[2]/=e}}centerOnNodes(e,n){this._centerNodes=[];for(let r=0;r<e.length;r++){let i=e[r];i.ID===void 0&&(i=this.network.nodes[i]),this._centerNodes.push(i)}return this._updateCameraInteraction(),this._camera.lastTranslatePosition[0]=this._camera.translatePosition[0],this._camera.lastTranslatePosition[1]=this._camera.translatePosition[1],this._camera.lastTranslatePosition[2]=this._camera.translatePosition[2],this._camera.lastPanX=this._camera.panX,this._camera.lastPanY=this._camera.panY,n===void 0||n<=0?(this._camera.translateDuration=0,this.translateStartTime=null):(this._camera.translateDuration=n,this.translateStartTime=performance.now()),this._scheduleCameraInterpolation(),this}centeredNodes(){return this._centerNodes}_updateCameraInterpolation(e=!1){if(this._camera.translateDuration==0)return e||(this._camera.translatePosition[0]=this._camera.targetTranslatePosition[0],this._camera.translatePosition[1]=this._camera.targetTranslatePosition[1],this._camera.translatePosition[2]=this._camera.targetTranslatePosition[2],this._camera.panX=0,this._camera.panY=0,this._settings.use2D),!1;{let r=(performance.now()-this.translateStartTime)/this._camera.translateDuration;return r>1&&(r=1),this._camera.translatePosition[0]=(1-r)*this._camera.lastTranslatePosition[0],this._camera.translatePosition[1]=(1-r)*this._camera.lastTranslatePosition[1],this._camera.translatePosition[2]=(1-r)*this._camera.lastTranslatePosition[2],this._camera.translatePosition[0]+=r*this._camera.targetTranslatePosition[0],this._camera.translatePosition[1]+=r*this._camera.targetTranslatePosition[1],this._camera.translatePosition[2]+=r*this._camera.targetTranslatePosition[2],this._camera.panX=(1-r)*this._camera.lastPanX,this._camera.panY=(1-r)*this._camera.lastPanY,this._camera.panX+=r*this._camera.targetPanX,this._camera.panY+=r*this._camera.targetPanY,this._settings.use2D,!(r>=1)}}_scheduleCameraInterpolation(){let e={name:"1.1.cameraInterpolator",callback:(n,r)=>{this._updateCenterNodesPosition(),this._updateCameraInterpolation()||this._scheduler.unschedule("1.1.cameraInterpolator")},delay:0,repeat:!0,synchronized:!0,immediateUpdates:!1,redraw:!0,updateNodesGeometry:!1,updateEdgesGeometry:!1};this._scheduler.schedule({name:"1.0.cameraInterpolator",callback:(n,r)=>{this._scheduler.schedule(e)},delay:0,repeat:!1,synchronized:!0,immediateUpdates:!1,redraw:!1,updateNodesGeometry:!1,updateEdgesGeometry:!1})}onResize(e){return this.onResizeCallback=e,this}onNodeClick(e){return this.onNodeClickCallback=e,this}onNodeDoubleClick(e){return this.onNodeDoubleClickCallback=e,this}onNodeHoverStart(e){return this.onNodeHoverStartCallback=e,this}onNodeHoverEnd(e){return this.onNodeHoverEndCallback=e,this}onNodeHoverMove(e){return this.onNodeHoverMoveCallback=e,this}onEdgeClick(e){return this.onEdgeClickCallback=e,this}onEdgeDoubleClick(e){return this.onEdgeDoubleClickCallback=e,this}onEdgeHoverStart(e){return this.onEdgeHoverStartCallback=e,this}onEdgeHoverEnd(e){return this.onEdgeHoverEndCallback=e,this}onEdgeHoverMove(e){return this.onEdgeHoverMoveCallback=e,this}onZoom(e){return this.onZoomCallback=e,this}onRotation(e){return this.onRotationCallback=e,this}onLayoutStart(e){return console.log("On start",this.layoutWorker),this.onLayoutStartCallback=e,this?.layoutWorker.onStart(()=>{this.onLayoutStartCallback?.()}),this}onLayoutStop(e){return console.log("Stop",this.layoutWorker),this.onLayoutStopCallback=e,this?.layoutWorker.onStop(()=>{this.onLayoutStopCallback?.()}),this}onDraw(e){return this.onDrawCallback=e,this}onReady(e){this._isReady?e?.(this):this.onReadyCallback=e}onCleanup(e){this.isCleanedUp?e?.(this):this.onCleanupCallback=e}backgroundColor(e){return typeof e>"u"?this._settings.backgroundColor:(this._settings.backgroundColor=e,this)}nodeColor(e,n){if(typeof n>"u"){if(typeof e>"u")return this.network.colors;if(typeof e=="function"){let r=this.network.indexedNodes;for(let i=0;i<r.length;i++){let a=r[i],o=e(a,i,this.network);this.network.colors[i*4+0]=o[0],this.network.colors[i*4+1]=o[1],this.network.colors[i*4+2]=o[2],o.length>3&&(this.network.colors[i*4+3]=o[3])}}else{if(typeof e=="number")return this.network.colors[this.network.ID2index[e]];{let r=this.network.indexedNodes;for(let i=0;i<r.length;i++)this.network.colors[i*4+0]=e[0],this.network.colors[i*4+1]=e[1],this.network.colors[i*4+2]=e[2],e.length>3&&(this.network.colors[i*4+3]=e[3])}}}else if(typeof e=="function"){let r=this.network.ID2index[n],i=e(n,r,this.network);this.network.colors[r*4+0]=i[0],this.network.colors[r*4+1]=i[1],this.network.colors[r*4+2]=i[2],i.length>3&&(this.network.colors[r*4+3]=i[3])}else{let r=this.network.ID2index[n];this.network.colors[r*4+0]=e[0],this.network.colors[r*4+1]=e[1],this.network.colors[r*4+2]=e[2],e.length>3&&(this.network.colors[r*4+3]=e[3])}return this}nodeSize(e,n){if(typeof n>"u"){if(typeof e>"u")return this.network.sizes;if(typeof e=="function"){let r=this.network.indexedNodes;for(let i=0;i<r.length;i++){let a=r[i],o=e(a,this.network);this.network.sizes[i]=o}}else{let r=this.network.indexedNodes;for(let i=0;i<r.length;i++)this.network.sizes[i]=e}}else if(typeof e=="function"){let r=e(n,this.network),i=this.network.ID2index[n];this.network.sizes[i]=r}else{let r=this.network.ID2index[n];this.network.sizes[r]=e}return this}nodeOutlineColor(e,n){if(typeof n>"u"){if(typeof e>"u")return this.network.outlineColors;if(typeof e=="function"){let r=this.network.indexedNodes;for(let i=0;i<r.length;i++){let a=r[i],o=e(a,i,this.network);this.network.outlineColors[i*4+0]=o[0],this.network.outlineColors[i*4+1]=o[1],this.network.outlineColors[i*4+2]=o[2],o.length>3&&(this.network.outlineColors[i*4+3]=o[3])}}else{if(typeof e=="number")return this.network.outlineColors[this.network.ID2index[e]];{let r=this.network.indexedNodes;for(let i=0;i<r.length;i++)this.network.outlineColors[i*4+0]=e[0],this.network.outlineColors[i*4+1]=e[1],this.network.outlineColors[i*4+2]=e[2],e.length>3&&(this.network.outlineColors[i*4+3]=e[3])}}}else if(typeof e=="function"){let r=this.network.ID2index[n],i=e(n,r,this.network);this.network.outlineColors[r*4+0]=i[0],this.network.outlineColors[r*4+1]=i[1],this.network.outlineColors[r*4+2]=i[2],i.length>3&&(this.network.outlineColors[r*4+3]=i[3])}else{let r=this.network.ID2index[n];this.network.outlineColors[r*4+0]=e[0],this.network.outlineColors[r*4+1]=e[1],this.network.outlineColors[r*4+2]=e[2],e.length>3&&(this.network.outlineColors[r*4+3]=e[3])}return this}nodeOutlineWidth(e,n){if(typeof n>"u"){if(typeof e>"u")return this.network.outlineWidths;if(typeof e=="function"){let r=this.network.indexedNodes;for(let i=0;i<r.length;i++){let a=r[i],o=e(a,this.network);this.network.outlineWidths[a.index]=o}}else{let r=this.network.indexedNodes;for(let i=0;i<r.length;i++)this.network.outlineWidths[i]=e}}else if(typeof e=="function"){let r=e(n,this.network),i=this.network.ID2index[n];this.network.outlineWidths[i]=r}else{let r=this.network.ID2index[n];this.network.outlineWidths[r]=e}return this}edgeColor(e,n){if(typeof n>"u"){if(typeof e>"u")return this.network.edgeColors;if(typeof e=="function"){let r=this.network.indexedNodes,i=this.network.indexedEdges;for(let a=0;a<i.length/2;a++){let o=r[i[a*2]],s=r[i[a*2+1]],u=e(a,o,s,this.network);u.length==2?(this.network.edgeColors[a*2*4+0]=u[0][0],this.network.edgeColors[a*2*4+1]=u[0][1],this.network.edgeColors[a*2*4+2]=u[0][2],this.network.edgeColors[(a*2+1)*4+0]=u[1][0],this.network.edgeColors[(a*2+1)*4+1]=u[1][1],this.network.edgeColors[(a*2+1)*4+2]=u[1][2],u[0].length>3&&(this.network.edgeColors[a*2*4+3]=u[0][3]),u[1].length>3&&(this.network.edgeColors[(a*2+1)*4+3]=u[1][3])):(this.network.edgeColors[a*2*4+0]=u[0],this.network.edgeColors[a*2*4+1]=u[1],this.network.edgeColors[a*2*4+2]=u[2],this.network.edgeColors[(a*2+1)*4+0]=u[0],this.network.edgeColors[(a*2+1)*4+1]=u[1],this.network.edgeColors[(a*2+1)*4+2]=u[2],u.length>3&&(this.network.edgeColors[a*2*4+3]=u[3],this.network.edgeColors[(a*2+1)*4+3]=u[3]))}}else{if(typeof e=="number")return[this.network.edgeColors[e*2+0],this.network.edgeColors[e*2+1]];{this.network.indexedNodes;let r=this.network.indexedEdges;for(let i=0;i<r.length/2;i++){let a=e(i,sourceNode,targetNode,this.network);e.length==2?(this.network.edgeColors[i*2*4+0]=a[0][0],this.network.edgeColors[i*2*4+1]=a[0][1],this.network.edgeColors[i*2*4+2]=a[0][2],this.network.edgeColors[(i*2+1)*4+0]=a[1][0],this.network.edgeColors[(i*2+1)*4+1]=a[1][1],this.network.edgeColors[(i*2+1)*4+2]=a[1][2],a[0].length>3&&(this.network.edgeColors[i*2*4+3]=a[0][3]),a[1].length>3&&(this.network.edgeColors[(i*2+1)*4+3]=a[1][3])):(this.network.edgeColors[i*2*4+0]=a[0],this.network.edgeColors[i*2*4+1]=a[1],this.network.edgeColors[i*2*4+2]=a[2],this.network.edgeColors[(i*2+1)*4+0]=a[0],this.network.edgeColors[(i*2+1)*4+1]=a[1],this.network.edgeColors[(i*2+1)*4+2]=a[2],a.length>3&&(this.network.edgeColors[i*2*4+3]=a[3],this.network.edgeColors[(i*2+1)*4+3]=a[3]))}}}}else{let r=e;typeof e=="function"&&(r=e(nodeID,nodeIndex,this.network));let i=+n;e.length==2?(this.network.edgeColors[i*2*4+0]=r[0][0],this.network.edgeColors[i*2*4+1]=r[0][1],this.network.edgeColors[i*2*4+2]=r[0][2],this.network.edgeColors[(i*2+1)*4+0]=r[1][0],this.network.edgeColors[(i*2+1)*4+1]=r[1][1],this.network.edgeColors[(i*2+1)*4+2]=r[1][2],e[0].length>3&&(this.network.edgeColors[i*2*4+3]=r[0][3]),e[1].length>3&&(this.network.edgeColors[(i*2+1)*4+3]=e[1][3])):(this.network.edgeColors[i*2*4+0]=e[0],this.network.edgeColors[i*2*4+1]=e[1],this.network.edgeColors[i*2*4+2]=e[2],this.network.edgeColors[(i*2+1)*4+0]=e[0],this.network.edgeColors[(i*2+1)*4+1]=e[1],this.network.edgeColors[(i*2+1)*4+2]=e[2],e.length>3&&(this.network.edgeColors[i*2*4+3]=e[3],this.network.edgeColors[(i*2+1)*4+3]=e[3]))}return this}edgeWidth(e,n){if(typeof n>"u"){if(typeof e>"u")return this.network.edgeColors;if(typeof e=="function"){let r=this.network.indexedNodes,i=this.network.indexedEdges;for(let a=0;a<i.length/2;a++){let o=r[i[a*2]],s=r[i[a*2+1]],u=e(o,s,a,this.network);typeof u=="number"?(this.network.edgeSizes[a*2]=u,this.network.edgeSizes[a*2+1]=u):(this.network.edgeSizes[a*2]=u[0],this.network.edgeSizes[a*2+1]=u[1])}}else{let r=this.network.indexedEdges;for(let i=0;i<r.length/2;i++)typeof e=="number"?(this.network.edgeSizes[i*2]=e,this.network.edgeSizes[i*2+1]=e):(this.network.edgeSizes[i*2]=e[0],this.network.edgeSizes[i*2+1]=e[1])}}else if(typeof e=="function"){let r=this.network.indexedNodes,i=this.network.indexedEdges,a=r[i[n*2]],o=r[i[n*2+1]],s=e(a,o,n,this.network);typeof s=="number"?(this.network.edgeSizes[n*2]=s,this.network.edgeSizes[n*2+1]=s):(this.network.edgeSizes[n*2]=s[0],this.network.edgeSizes[n*2+1]=s[1])}else typeof e=="number"?(this.network.edgeSizes[n*2]=e,this.network.edgeSizes[n*2+1]=e):(this.network.edgeSizes[n*2]=e[0],this.network.edgeSizes[n*2+1]=e[1]);return this}getProjectedPositions(e){if(e===void 0&&(e=this.network.nodes),e.length>0){this.gl;let n=new Uint32Array(e.length);if(typeof e[0]=="number")for(let s=0;s<e.length;s++)n[s]=e[s];else{n=new Uint32Array(e.length);for(let s=0;s<e.length;s++)n[s]=e[s].index}let r=this.network.positions,i=new Float32Array(e.length*4),[a,o]=this._lastCanvasDimensions;for(let s=0;s<e.length;s++){let u=n[s],f=[r[u*3],r[u*3+1],r[u*3+2],1],l=rr();lo(l,f,this.projectionViewMatrix);let h=1/l[3],c=a/2+l[0]*a*.5*h,d=o/2-l[1]*o*.5*h;i[s*4]=c,i[s*4+1]=d,i[s*4+2]=l[2],i[s*4+3]=l[3]}return i}else return Float32Array(0)}pickPoint(e,n){const r=this._canvasElement.width*this._settings.pickingResolutionRatio,i=this._canvasElement.height*this._settings.pickingResolutionRatio,a=Math.round(e*r/this._canvasElement.clientWidth-.5),o=Math.round(i-n*i/this._canvasElement.clientHeight-.5),s=new Uint8Array(4),u=this.gl;return u.bindFramebuffer(u.FRAMEBUFFER,this.pickingFramebuffer),u.readPixels(a,o,1,1,u.RGBA,u.UNSIGNED_BYTE,s),s[0]+(s[1]<<8)+(s[2]<<16)+(s[3]<<24)-1}_consolidateCentroids(e,n){for(const[r,i]of e){const a=n.get(r);i[0]/=a,i[1]/=a}}_calculateCentroidForAttribute(e,n,r,i){r.has(e)||(r.set(e,[0,0]),i.set(e,0));const a=r.get(e);a[0]+=n[0],a[1]+=n[1];const o=i.get(e);i.set(e,o+1)}_updateTrackerNodesData(){const e=this.gl,n=this._tracking.bufferPixels,r=this._nodesOnScreen;e.bindFramebuffer(e.FRAMEBUFFER,this._trackingFramebuffer),e.readPixels(0,0,this._trackingFramebuffer.size.width,this._trackingFramebuffer.size.height,e.RGBA,e.UNSIGNED_BYTE,n);for(let i=0;i<n.length;i+=4){const a=n[i]+(n[i+1]<<8)+(n[i+2]<<16)+(n[i+3]<<24)-1;r[i/4]=a}}updateAttributeTrackers(e=!1){if(!this._tracking.bufferEnabled||Object.keys(this._tracking.trackers).length===0)return this;const n=this._tracking.trackers,r=this._trackingFramebuffer.size.width*this._trackingFramebuffer.size.height,i=this._nodesOnScreen,a=this._pixelXYOnScreen;e||this._updateTrackerNodesData();const o=performance.now();let s=o-this._trackingLastTime||o;s>1e3&&(s=1e3),this._trackingLastTime=o;for(let u in n){const f=n[u],l=f.pixelCounter,h=l.getSortedKeys(),c=f.smoothness,d=f.minProportion,v=f.calculateCentroid,g=f.centroidPositions,m=f.attribute,y=f.maxLabels,w=new Map,x=new Map,p=Math.exp(-s/(100*c));for(let A=0;A<h.length;A++){h[A];const _=l.get(h[A])*p;if(_>d){if(l.set(h[A],_),v&&g.has(h[A])){const C=g.get(h[A]);C&&(C[0]*=p,C[1]*=p)}}else l.delete(h[A]),v&&g.delete(h[A])}if(m=="index")for(let A=0;A<i.length;A++){const _=i[A];if(_>=0){const C=(l.get(_)||0)+1/r*(1-p);l.set(_,C),v&&this._calculateCentroidForAttribute(_,a[A],w,x)}}else if(m=="node")for(let A=0;A<i.length;A++){const _=this.network.indexedNodes;if(nodeIndex>=0){const C=_[nodeIndex],k=(l.get(C)||0)+1/r*(1-p);l.set(C,k),v&&this._calculateCentroidForAttribute(C,a[A],w,x)}}else if(typeof m=="function"){const A=this.network.indexedNodes;for(let _=0;_<i.length;_++){const C=i[_];if(C>=0){const k=A[C],S=m(k,C),N=(l.get(S)||0)+1/r*(1-p);l.set(S,N),v&&this._calculateCentroidForAttribute(S,a[_],w,x)}}}else{const A=this.network.indexedNodes;for(let _=0;_<i.length;_++){const C=i[_];if(C>=0){const S=A[C][m],N=(l.get(S)||0)+1/r*(1-p);l.set(S,N),v&&this._calculateCentroidForAttribute(S,a[_],w,x)}}}if(v){this._consolidateCentroids(w,x);for(let[A,_]of w){const C=g.get(A),k=_;C?(C[0]+=k[0]*(1-p),C[1]+=k[1]*(1-p)):g.set(A,k)}}if(y>=0){let A=l.getSortedKeys(),_=A.slice(y,A.length);for(let C=0;C<_.length;C++)l.delete(_[C]),g.delete(_[C])}}return this}trackedAttributesOnScreen(e){if(this._tracking.bufferEnabled&&this._tracking.trackers[e]){const n=this._tracking.trackers[e],r=n.pixelCounter;if(n.calculateCentroid){const i=n.centroidPositions,a=r.getSortedPairs();for(let o=0;o<a.length;o++){const s=a[o][0],u=a[o][1],f=i.get(s);a[o]=[s,u,f[0],f[1]]}return a}else return r.getSortedPairs()}}trackedAttributesCentroids(e){if(this._tracking.bufferEnabled&&this._tracking.trackers[e])return this._tracking.trackers[e].centroidPositions}_updateTrackerScheduleTask(){const e="9.5.tracker_update";!this._tracking.bufferEnabled||Object.keys(this._tracking.trackers).length===0?this._scheduler.hasTask(e)&&this._scheduler.unschedule(e):this._scheduler.hasTask(e)||this._scheduler.schedule({name:e,callback:(n,r)=>{this.updateAttributeTrackers(!0);for(let i in this._tracking.trackers){const a=this._tracking.trackers[i];a.onTrack&&a.onTrack(this.trackedAttributesOnScreen(i),a)}},delay:0,repeatInterval:this._tracking.nodeMinimumUpdateInterval,repeat:!0,synchronized:!0,afterRedraw:!0,immediateUpdates:!1,redraw:!1,updateNodesGeometry:!1,updateEdgesGeometry:!1})}trackAttribute(e,n,{minProportion:r=.001,smoothness:i=.8,maxLabels:a=20,calculateCentroid:o=!1,onTrack:s=null}={}){return e in this._tracking.trackers&&this.untrackAttribute(e),this._tracking.trackers[e]={attribute:n,pixelCounter:new ml(!1),minProportion:r,smoothness:i,maxLabels:a,calculateCentroid:o,centroidPositions:new Map,onTrack:s},this._updateTrackerScheduleTask(),this}untrackAttribute(e){return this._tracking.trackers=this._tracking.trackers.filter(n=>n.attribute!==e),this._updateTrackerScheduleTask(),this}attributesTrackers(){return Object.assign({},this._tracking.trackers)}trackingBufferUpdateInterval(e){return typeof e>"u"?this._trackingBufferUpdateInterval:(this._trackingBufferUpdateInterval=e,this._updateTrackerScheduleTask(),this)}trackingUpdateInterval(e){return typeof e>"u"?this._trackingUpdateInterval:(this._trackingUpdateInterval=e,this._updateTrackerScheduleTask(),this)}edgesGlobalOpacityScale(e){return typeof e>"u"?this._settings.edgesGlobalOpacityScale:(this._settings.edgesGlobalOpacityScale=e,this)}edgesGlobalOpacityBase(e){return typeof e>"u"?this._settings.edgesGlobalOpacityBase:(this._settings.edgesGlobalOpacityBase=e,this)}edgesGlobalWidthScale(e){return typeof e>"u"?this._settings.edgesGlobalWidthScale:(this._settings.edgesGlobalWidthScale=e,this)}edgesGlobalWidthBase(e){return typeof e>"u"?this._settings.edgesGlobalWidthBase:(this._settings.edgesGlobalWidthBase=e,this)}nodesGlobalOpacityScale(e){return typeof e>"u"?this._settings.nodesGlobalOpacityScale:(this._settings.nodesGlobalOpacityScale=e,this)}nodesGlobalOpacityBase(e){return typeof e>"u"?this._settings.nodesGlobalOpacityBase:(this._settings.nodesGlobalOpacityBase=e,this)}nodesGlobalSizeScale(e){return typeof e>"u"?this._settings.nodesGlobalSizeScale:(this._settings.nodesGlobalSizeScale=e,this)}nodesGlobalSizeBase(e){return typeof e>"u"?this._settings.nodesGlobalSizeBase:(this._settings.nodesGlobalSizeBase=e,this)}nodesGlobalOutlineWidthScale(e){return typeof e>"u"?this._settings.nodesGlobalOutlineWidthScale:(this._settings.nodesGlobalOutlineWidthScale=e,this)}nodesGlobalOutlineWidthBase(e){return typeof e>"u"?this._settings.nodesGlobalOutlineWidthBase:(this._settings.nodesGlobalOutlineWidthBase=e,this)}nodeOpacity(e){if(typeof e>"u")return this.network.colors.map(n=>n[3]);if(typeof e=="function"){let n=this.network.indexedNodes;for(let r=0;r<n.length;r++){let i=n[r],a=e(i,r,this.network);this.network.colors[r*4+3]=a}}else for(let n=0;n<allNodes.length;n++)this.network.colors[n*4+3]=e;return this}edgesColorsFromNodes(e){return typeof e>"u"?this._settings.edgesColorsFromNodes:(this._settings.edgesColorsFromNodes=e,this)}edgesWidthFromNodes(e){return typeof e>"u"?this._settings.edgesWidthFromNodes:(this._settings.edgesWidthFromNodes=e,this)}additiveBlending(e){return typeof e>"u"?this._settings.useAdditiveBlending:(this._settings.useAdditiveBlending=e,this)}shadedNodes(e){return typeof e>"u"?this._settings.shadedNodes:(this._settings.shadedNodes=e,this)}pickeableEdges(e){if(typeof e>"u")return this._settings.pickeableEdges;if(this._settings.pickeableEdges=new Set(e),e=="all"){for(let n=0;n<this.network.edges.length;n++)this._settings.pickeableEdges.add(n);this._status.edgeIndicesUpdate=!0,this.update()}else this._status.edgeIndicesUpdate=!0,this.update();return this}labelsMaxPixels(e){return typeof e>"u"?this._tracking.maxPixels:(this._tracking.maxPixels=e,_willResizeEvent(0),this)}behavior(e,n){return arguments.length===1?this.behaviors[e]:n===null?(this._isReady&&this.behaviors[e]?.teardown(this),delete this.behaviors[e],this):(this.behaviors[e]=n,this._isReady&&(typeof n=="function"?n(this):n.setup?.(this)),this)}cleanup(e){this._isReady=!1,console.log("Cleanup",this.layoutWorker),this.layoutWorker?.cleanup(),this._scheduler?.stop(),console.log("Null",this.layoutWorker),this.layoutWorker=null;const n=this.gl;if(this.onReadyCallback=null,this.onNodeClickCallback=null,this.onNodeDoubleClickCallback=null,this.onNodeHoverStartCallback=null,this.onNodeHoverMoveCallback=null,this.onNodeHoverEndCallback=null,this.onEdgeClickCallback=null,this.onEdgeDoubleClickCallback=null,this.onEdgeHoverStartCallback=null,this.onEdgeHoverMoveCallback=null,this.onEdgeHoverEndCallback=null,this.onZoomCallback=null,this.onRotationCallback=null,this.onResizeCallback=null,this.onLayoutStartCallback=null,this.onLayoutStopCallback=null,this.onDrawCallback=null,this.onReadyCallback=null,this._isReady=!1,this._resizeObserver&&(console.log("disconnecting resize observer"),this._resizeObserver.disconnect(),this._resizeObserver=null,delete this._resizeObserver),this._canvasElement&&(this._canvasElement.removeEventListener("click",this._clickEventListener),this._canvasElement.removeEventListener("dblclick",this._doubleClickEventListener),this._canvasElement.removeEventListener("mousemove",this._hoverMoveEventListener),this._canvasElement.removeEventListener("mouseleave",this._hoverLeaveEventListener),document.body.removeEventListener("mouseout",this._hoverLeaveWindowEventListener)),!e&&n){let r=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);this.pickingFramebuffer?.discard(),this._trackingFramebuffer?.discard();for(let i=0;i<r;++i)n.activeTexture(n.TEXTURE0+i),n.bindTexture(n.TEXTURE_2D,null),n.bindTexture(n.TEXTURE_CUBE_MAP,null);n.bindBuffer(n.ARRAY_BUFFER,null),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),n.bindRenderbuffer(n.RENDERBUFFER,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteBuffer(this.nodesPositionBuffer),n.deleteBuffer(this.nodesColorBuffer),n.deleteBuffer(this.nodesSizeBuffer),n.deleteBuffer(this.nodesSizeBuffer),n.deleteBuffer(this.nodesOutlineWidthBuffer),n.deleteBuffer(this.nodesOutlineColorBuffer),n.deleteBuffer(this.nodesIndexBuffer),this.edgesGeometry&&(n.deleteBuffer(this.edgesGeometry.edgeVertexTypeBuffer),n.deleteBuffer(this.edgesGeometry.verticesBuffer),n.deleteBuffer(this.edgesGeometry.colorBuffer),n.deleteBuffer(this.edgesGeometry.sizeBuffer)),this.fastEdgesGeometry&&(n.deleteBuffer(this.fastEdgesGeometry.indexBuffer),n.deleteBuffer(this.fastEdgesGeometry.vertexObject),n.deleteBuffer(this.fastEdgesGeometry.colorObject),n.deleteBuffer(this.fastEdgesGeometry.indexObject))}this.densityMap&&this.densityMap.cleanup(),this._settings.autoCleanup&&(this._mutationObserver.disconnect(),this._mutationObserver=null),this._canvasElement&&(this._canvasElement.remove(),this._canvasElement=null),this._svgLayer&&(this._svgLayer.remove(),this._svgLayer=null),this._overlay&&(this._overlay.remove(),this._overlay=null),this.onCleanupCallback?.(),this._status.hasCleanup=!0}isReady(){return this._isReady}destroy(){this._status.hasCleanup||this.cleanup()}}let yl=t=>{let e=t.split(/\s/);return e.length<2?null:[+e[0],+e[1]]},bl=t=>{let e=t.split(/\s/);return e.length<3?null:[+e[0],+e[1],+e[2]]},xl=t=>isNaN(t)?0:+t,wl=/#([ve]) \"(.+)\" ([sn]|v2|v3)/,El={s:String,n:xl,v2:yl,v3:bl},kl=t=>{for(;t.lineIndex+1<t.lines.length&&t.lines[t.lineIndex].length==0;)t.lineIndex++;let n=t.lines[t.lineIndex].split(/\s/),r=0;if(n.length==0||n[0].toLowerCase()!="#vertices"||isNaN(n[1])||!Number.isInteger(+n[1]))throw`Malformed xnet data (Reading Vertices Header)[line: ${t.lineIndex}]
	> ${t.lines[t.lineIndex]}`;return r=+n[1],t.lineIndex++,r},Cl=t=>{let e=[];for(;t.lineIndex<t.lines.length;){let r=t.lines[t.lineIndex],i=r.length;if(i==0){t.lineIndex++;continue}if(r[0]=="#")break;var n=r;r[0]=='"'&&r[i-1]=='"'&&(n=r.slice(1,-1)),e.push(n),t.lineIndex++}return e},Il=t=>{for(;t.lineIndex+1<t.lines.length&&t.lines[t.lineIndex].length==0;)t.lineIndex++;let n=t.lines[t.lineIndex].split(/\s/),r=!1,i=!1;if(n.length==0||n[0].toLowerCase()!="#edges")throw`Malformed xnet data (Reading Edges Header)[line: ${t.lineIndex}]
	> ${t.lines[t.lineIndex]}`;return n.forEach(a=>{a.toLowerCase()=="weighted"&&(r=!0),a.toLowerCase()=="nonweighted"&&(r=!1),a.toLowerCase()=="directed"&&(i=!0),a.toLowerCase()=="undirected"&&(i=!1)}),t.lineIndex++,{weighted:r,directed:i}},Bl=t=>{let e=[],n=[];for(;t.lineIndex<t.lines.length;){let r=t.lines[t.lineIndex];if(r.length==0){t.lineIndex++;continue}if(r[0]=="#")break;let a=r.split(/\s/),o=1;if(a.length<2)throw`Malformed xnet data (Reading Edges)[line: ${t.lineIndex}]
	> ${t.lines[t.lineIndex]}`;a.length>2&&(o=+a[2]),e.push([+a[0],+a[1]]),n.push(o),t.lineIndex++}return{edges:e,weights:n}},Fl=t=>{for(;t.lineIndex+1<t.lines.length&&t.lines[t.lineIndex].length==0;)t.lineIndex++;let e=wl.exec(t.lines[t.lineIndex]);if(e.length!=4)throw`Malformed xnet data [line: ${t.lineIndex}]
	> ${t.lines[t.lineIndex]}`;let n=e[1],r=e[2],i=e[3];return t.lineIndex++,{type:n,key:r,format:i}},Sl=(t,e)=>{let n=[],r=El[e.format];for(;t.lineIndex<t.lines.length;){let i=t.lines[t.lineIndex],a=i.length;if(a==0){t.lineIndex++;continue}if(i[0]=="#")break;let o=i;o[0]=='"'&&o[a-1]=='"'&&(o=o.slice(1,-1)),n.push(r(o)),t.lineIndex++}return n},wr=t=>{let e={lineIndex:0,lines:t.split(`
`)},n=kl(e),r=Cl(e),i={nodesCount:n,verticesProperties:{},edgesProperties:{}};if(r.length>0){if(r.length<n)throw`Malformed xnet data [line: ${e.lineIndex}]
	> ${e.lines[e.lineIndex]}`;i.labels=r}let a=Il(e);i.directed=a.directed,i.weighted=a.weighted;let o=Bl(e);i.edges=o.edges,i.weighted&&(i.weights=o.weights);do{for(;e.lineIndex<e.lines.length&&e.lines[e.lineIndex].length==0;)e.lineIndex++;if(!(e.lineIndex<e.lines.length))break;let s=Fl(e),u=Sl(e,s);s.type=="e"?i.edgesProperties[s.key]=u:s.type=="v"&&(i.verticesProperties[s.key]=u)}while(e.lineIndex<e.lines.length);return i};async function Ml(t){let e=await fetch(t).then(n=>n.text());return wr(e)}function Rl(t){let e=t.nodesCount,n={},r=[];for(let i=0;i<e;i++)n[""+i]={ID:""+i},t.labels&&(n[""+i].Label=t.labels[i]);for(const[i,a]of Object.entries(t.verticesProperties))for(let o=0;o<e;o++)n[""+o][i]=a[o];for(let i=0;i<t.edges.length;i++)r.push({source:""+t.edges[i][0],target:""+t.edges[i][1]});return{nodes:n,edges:r}}const Tl=Object.freeze(Object.defineProperty({__proto__:null,convertXNET2JSON:Rl,loadXNET:wr,loadXNETFile:Ml},Symbol.toStringTag,{value:"Module"}));let Y={getModelTags:function(t){let e=t.getElementsByTagName("attributes"),n={},r=e.length,i;for(i=0;i<r;i++)n[e[i].getAttribute("class")]=e[i].childNodes;return n},nodeListToArray:function(t){let e=[];for(let n=0,r=t.length;n<r;++n)t[n].nodeName!=="#text"&&e.push(t[n]);return e},nodeListEach:function(t,e){for(let n=0,r=t.length;n<r;++n)t[n].nodeName!=="#text"&&e(t[n])},nodeListToHash:function(t,e){let n={};for(let r=0;r<t.length;r++)if(t[r].nodeName!=="#text"){let i=e(t[r]);n[i.key]=i.value}return n},namedNodeMapToObject:function(t){let e={};for(let n=0;n<t.length;n++)e[t[n].name]=t[n].value;return e},getFirstElementByTagNS:function(t,e,n){let r=t.getElementsByTagName(e+":"+n)[0];return r||(r=t.getElementsByTagNameNS(e,n)[0]),r||(r=t.getElementsByTagName(n)[0]),r},getAttributeNS:function(t,e,n){let r=t.getAttribute(e+":"+n);return r===void 0&&(r=t.getAttributeNS(e,n)),r===void 0&&(r=t.getAttribute(n)),r},enforceType:function(t,e){switch(t){case"boolean":e=e==="true";break;case"integer":case"long":case"float":case"double":e=+e;break;case"liststring":e=e?e.split("|"):[];break}return e},getRGB:function(t){return t[3]?"rgba("+t.join(",")+")":"rgb("+t.slice(0,-1).join(",")+")"}};function Nl(t){let e={id:t.id,label:t.label};return t.viz&&(e.viz=t.viz),t.attributes&&(e.attributes=t.attributes),e}function Ol(t){let e={id:t.id,type:t.type||"undirected",label:t.label||"",source:t.source,target:t.target,weight:+t.weight||1};return t.viz&&(e.viz=t.viz),t.attributes&&(e.attributes=t.attributes),e}function Pl(t){let n=new DOMParser().parseFromString(t,"text/xml"),r={};console.log(n),r.els={root:n.getElementsByTagName("gexf")[0],graph:n.getElementsByTagName("graph")[0],meta:n.getElementsByTagName("meta")[0],nodes:n.getElementsByTagName("node"),edges:n.getElementsByTagName("edge"),model:Y.getModelTags(n)},r.hasViz=!!Y.getAttributeNS(r.els.root,"xmlns","viz"),r.version=r.els.root.getAttribute("version")||"1.0",r.mode=r.els.graph.getAttribute("mode")||"static";let i=r.els.graph.getAttribute("defaultedgetype");r.defaultEdgetype=i||"undirected";function a(){let g={};return r.els.meta&&(g.lastmodifieddate=r.els.meta.getAttribute("lastmodifieddate"),Y.nodeListEach(r.els.meta.childNodes,function(m){g[m.tagName.toLowerCase()]=m.textContent})),g}function o(g){let m=[];return r.els.model[g]&&Y.nodeListEach(r.els.model[g],function(y){let w={id:y.getAttribute("id")||y.getAttribute("for"),type:y.getAttribute("type")||"string",title:y.getAttribute("title")||""},x=Y.nodeListToArray(y.childNodes);x.length>0&&(w.defaultValue=x[0].textContent),m.push(w)}),m.length>0?m:!1}function s(g,m){let y={},w=m.getElementsByTagName("attvalue"),x=Y.nodeListToHash(w,function(p){let A=Y.namedNodeMapToObject(p.attributes);return{key:A.id||A.for,value:A.value}});return g.map(function(p){y[p.id]=!(p.id in x)&&"defaultValue"in p?Y.enforceType(p.type,p.defaultValue):Y.enforceType(p.type,x[p.id])}),y}function u(g){let m=[];return Y.nodeListEach(r.els.nodes,function(y){let w={id:y.getAttribute("id"),label:y.getAttribute("label")||""};g&&(w.attributes=s(g,y)),r.hasViz&&(w.viz=f(y)),m.push(Nl(w))}),m}function f(g){let m={},y=Y.getFirstElementByTagNS(g,"viz","color");if(y){let A=["r","g","b","a"].map(function(_){return y.getAttribute(_)});m.color=Y.getRGB(A)}let w=Y.getFirstElementByTagNS(g,"viz","position");w&&(m.position={},["x","y","z"].map(function(A){m.position[A]=+w.getAttribute(A)}));let x=Y.getFirstElementByTagNS(g,"viz","size");x&&(m.size=+x.getAttribute("value"));let p=Y.getFirstElementByTagNS(g,"viz","shape");return p&&(m.shape=p.getAttribute("value")),m}function l(g,m){let y=[];return Y.nodeListEach(r.els.edges,function(w){let x=Y.namedNodeMapToObject(w.attributes);"type"in x||(x.type=m),g&&(x.attributes=s(g,w)),r.hasViz&&(x.viz=h(w)),y.push(Ol(x))}),y}function h(g){let m={},y=Y.getFirstElementByTagNS(g,"viz","color");if(y){let p=["r","g","b","a"].map(function(A){return y.getAttribute(A)});m.color=Y.getRGB(p)}let w=Y.getFirstElementByTagNS(g,"viz","shape");w&&(m.shape=w.getAttribute("value"));let x=Y.getFirstElementByTagNS(g,"viz","thickness");return x&&(m.thickness=+x.getAttribute("value")),m}let c=o("node"),d=o("edge"),v={version:r.version,mode:r.mode,defaultEdgeType:r.defaultEdgetype,meta:a(),model:{},nodes:u(c),edges:l(d,r.defaultEdgetype)};return c&&(v.model.node=c),d&&(v.model.edge=d),v}function zl(t){return Pl(t)}let Er={parse:zl,version:"0.2.5"};function Dl(t){return Er.parse(t)}async function Ll(t){let e=await fetch(t).then(n=>n.text());return Er.parse(e)}function Ul(t){let e={},n=[];for(let r of t.nodes){let i=r.id;if(e[i]={},r.attributes)for(const[a,o]of Object.entries(r.attributes||{}))e[i][a]=o;if(r.label?e[i].Label=r.label:r?.attributes.name?e[i].Label=r.attributes.name:e[i].Label=i,r.viz?.position){let a=r.viz?.position;e[i].Position=[a?.x||0,a?.y||0,a?.z||0]}if(r.viz?.color){let a=ze(r.viz?.color);e[i].Color=[a.r/255,a.g/255,a.b/255]}}for(let r of t.edges||[]){let i={};i.source=r.source,i.target=r.target;for(const[a,o]of Object.entries(r.attributes||{}))i[a]=o;n.push(i)}return{nodes:e,edges:n}}const Ql=Object.freeze(Object.defineProperty({__proto__:null,convertGEXF2JSON:Ul,loadGEXF:Dl,loadGEXFFile:Ll},Symbol.toStringTag,{value:"Module"}));function Gl(t){var e=(`{
`+t+`
}`).replace(/^(\s*)(\w+)\s*\[/gm,'$1"$2": {').replace(/^(\s*)\]/gm,"$1},").replace(/^(\s*)(\w+)\s+(.+)$/gm,'$1"$2": $3,').replace(/,(\s*)\}/g,"$1}"),n={},r=[],i=[],a=0,o;e=e.replace(/^(\s*)"node"/gm,function(u,f){return f+'"node['+a+++']"'}),a=0,e=e.replace(/^(\s*)"edge"/gm,function(u,f){return f+'"edge['+a+++']"'}),e=e.replace(/: NaN/g,": null");try{o=JSON.parse(e)}catch{throw new SyntaxError("bad format")}if(!kr(o.graph))throw new SyntaxError("no graph tag");Mt(o.graph,function(u,f){var l=u.match(/^(\w+)\[(\d+)\]$/),h,c;l?(h=l[1],c=parseInt(l[2],10),h==="node"?r[c]=f:h==="edge"?i[c]=f:n[u]=f):n[u]=f});let s={};return r.forEach(function(u){s[u.id]=u}),n.nodes=s,n.edges=i,n}function Vl(t,e){typeof t.toJSON=="function"&&(t=t.toJSON()),e=e||{};var n=t.nodes||[],r=t.edges||[],i=typeof e.indent=="string"?e.indent:"  ",a=i+i,o=e.graphAttributes||null,s=e.nodeAttributes||null,u=e.edgeAttributes||null,f=["graph ["];function l(h,c,d){kr(c)?(f.push(d+h+" ["),Mt(c,function(v,g){l(v,g,d+i)}),f.push(d+"]")):f.push(d+Wl(h,c))}return Mt(t,function(h,c){h!=="nodes"&&h!=="edges"&&l(h,c,i)}),o&&Mt(o(t),function(h,c){l(h,c,i)}),n.forEach(function(h){f.push(i+"node ["),s&&s.forEach(function(c){l(c,h[c],a)}),f.push(i+"]")}),r.forEach(function(h){f.push(i+"edge ["),l("source",h.source,a),l("target",h.target,a),u&&u.forEach(function(c){l(c,h[c],a)}),f.push(i+"]")}),f.push("]"),f.join(`
`)}function kr(t){return t&&Object.prototype.toString.call(t)==="[object Object]"}function Mt(t,e){Object.keys(t).forEach(function(n){e(n,t[n])})}function Wl(t,e){return typeof e=="boolean"?e=Number(e):e=JSON.stringify(e),t+" "+e}function Cr(t){return Gl(t)}async function Hl(t){let e=await fetch(t).then(n=>n.text());return Cr(e)}const Yl=Object.freeze(Object.defineProperty({__proto__:null,GMLStringify:Vl,loadGML:Cr,loadGMLFile:Hl},Symbol.toStringTag,{value:"Module"}));class ql{constructor(e){this._filters={},this._updatedNodes=new Set,this._helios=e}get filters(){return this._filters}setFilter(e,n){this._filters[e]=n}removeFilter(e){delete this._filters[e]}applyFilters(){for(let e of this._helios.network.indexedNodes){let n=!1;for(let r in this._filters)n=n||this._filters[r](e);n!=e._filtered&&this._updatedNodes.add(e),e._filtered=n}}updatedNodes(e=!0){let n=new Set(this._updatedNodes);return e&&this._updatedNodes.clear(),n}}H.BehaviorFilter=ql,H.Helios=Al,H.gexf=Ql,H.gml=Yl,H.xnet=Tl,Object.defineProperty(H,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=helios.umd.cjs.map
